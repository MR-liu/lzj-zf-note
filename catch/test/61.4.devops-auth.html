
        <h2 id="t01. 文件权限">1. 文件权限 <a href="#t01. 文件权限"> # </a></h2>
<h3 id="t11.1 文件基本权限">1.1 文件基本权限 <a href="#t11.1 文件基本权限"> # </a></h3>
<p><code>-rw-r--r--</code></p>
<ul>
<li>文件类型<ul>
<li><code>-</code> 文件 </li>
<li><code>d</code> 目录 </li>
<li><code>l</code> 软链接文件</li>
</ul>
</li>
<li>所有者 所属组 其它人</li>
<li>r读 w写 x执行</li>
</ul>
<h3 id="t21.2 基本权限的修改">1.2 基本权限的修改 <a href="#t21.2 基本权限的修改"> # </a></h3>
<p>chmod [选项] 模式 文件名</p>
<ul>
<li>选项<ul>
<li><code>-R</code>  递归</li>
</ul>
</li>
<li>模式<ul>
<li>[ugoa][+-=][rwx]  </li>
</ul>
</li>
<li>权限数字<ul>
<li>r 4</li>
<li>w 2</li>
<li>x 1</li>
</ul>
</li>
</ul>
<pre><code class="lang-js">chmod <span class="hljs-number">000</span> <span class="hljs-number">1.</span>txt
chmod u+w <span class="hljs-number">1.</span>txt
chmod g+x <span class="hljs-number">1.</span>txt
chmod o+r <span class="hljs-number">1.</span>txt

chmod g+x,o+x <span class="hljs-number">1.</span>txt

chmod u-w <span class="hljs-number">1.</span>txt

chmod u=rwx <span class="hljs-number">1.</span>txt

chmod <span class="hljs-number">777</span> <span class="hljs-number">1.</span>txt
</code></pre>
<h3 id="t31.3 权限的作用">1.3 权限的作用 <a href="#t31.3 权限的作用"> # </a></h3>
<ul>
<li>对文件来说最高权限是<code>x</code></li>
<li>对目录来讲最高权限是<code>w</code>,只有读权限没有意义，对目录有了写权限，里面可以做任何事情</li>
</ul>
<h4 id="t41.3.1 文件权限">1.3.1 文件权限 <a href="#t41.3.1 文件权限"> # </a></h4>
<table>
<thead>
<tr>
<th style="text-align:left">权限</th>
<th style="text-align:left">含义</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">r</td>
<td style="text-align:left">读取文件内容</td>
<td style="text-align:left">cat more head tail</td>
</tr>
<tr>
<td style="text-align:left">w</td>
<td style="text-align:left">编辑、新增、修改文件内容,不能删除文件,除非对目录有写权限</td>
<td style="text-align:left">vi echo</td>
</tr>
<tr>
<td style="text-align:left">x</td>
<td style="text-align:left">可执行</td>
</tr>
</tbody>
</table>
<h4 id="t51.3.2 目录权限">1.3.2 目录权限 <a href="#t51.3.2 目录权限"> # </a></h4>
<table>
<thead>
<tr>
<th style="text-align:left">权限</th>
<th style="text-align:left">含义</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">r</td>
<td style="text-align:left">可以查看目录下的文件名</td>
<td style="text-align:left">ls</td>
</tr>
<tr>
<td style="text-align:left">w</td>
<td style="text-align:left">具有修改目录结构的权限。如新建、删除和重命名此目录下的文件和目录</td>
<td style="text-align:left">touch rm mv cp</td>
</tr>
<tr>
<td style="text-align:left">x</td>
<td style="text-align:left">进入目录</td>
<td style="text-align:left">cd</td>
</tr>
</tbody>
</table>
<pre><code class="lang-js">useradd zf1
passwd zf1

cd /home/zf1
mkdir folder
touch folder/<span class="hljs-number">1.</span>txt 默认<span class="hljs-number">755</span>
chmod <span class="hljs-number">750</span> folder 
chmod <span class="hljs-number">640</span> folder/<span class="hljs-number">1.</span>txt
chmod <span class="hljs-number">754</span> folder 
chmod <span class="hljs-number">755</span> folder  
chmod <span class="hljs-number">644</span> folder/<span class="hljs-number">1.</span>txt
chmod <span class="hljs-number">646</span> folder/<span class="hljs-number">1.</span>txt
chmod <span class="hljs-number">757</span> folder
</code></pre>
<h4 id="t61.1.3 其它权限命令">1.1.3 其它权限命令 <a href="#t61.1.3 其它权限命令"> # </a></h4>
<h5 id="t71.1.3.1 chown">1.1.3.1 chown <a href="#t71.1.3.1 chown"> # </a></h5>
<ul>
<li>chown 用户名 文件名</li>
<li>如果想让一个用户拥有7权限，可以把这个文件的所有者改成这个用户名<pre><code class="lang-js">chmod <span class="hljs-number">755</span> folder
chown zf1 folder
</code></pre>
</li>
</ul>
<h5 id="t81.1.3.2 chgrp">1.1.3.2 chgrp <a href="#t81.1.3.2 chgrp"> # </a></h5>
<ul>
<li>chgrp 组名 文件名</li>
<li>创建用户名的时候会为它创建一个所属组</li>
</ul>
<pre><code class="lang-js">chgrp zf1 folder
chown root:root folder
</code></pre>
<h2 id="t92.默认权限">2.默认权限 <a href="#t92.默认权限"> # </a></h2>
<h3 id="t102.1 umask">2.1 umask <a href="#t102.1 umask"> # </a></h3>
<ul>
<li>查看默认权限 </li>
<li>0022<ul>
<li>第一位0 文件特殊权限</li>
<li>022 文件默认权限</li>
</ul>
</li>
</ul>
<h3 id="t112.2 文件权限">2.2 文件权限 <a href="#t112.2 文件权限"> # </a></h3>
<ul>
<li>默认权限就是文件一创建后就拥有的权限</li>
<li>文件默认不能建立可执行文件，必须手工赋予执行权限</li>
<li>文件默认权限最大为<code>666</code></li>
<li>默认权限需要换算成字母再相减</li>
<li>建立文件之后的默认权限，为666减去umask值</li>
</ul>
<p>666 - 022 =  744</p>
<h3 id="t122.3 目录">2.3 目录 <a href="#t122.3 目录"> # </a></h3>
<ul>
<li>目录默认权限最大为777</li>
<li>建立目录之后的默认权限，为777减去umask值</li>
</ul>
<p>777 - 022 =  755</p>
<h3 id="t132.4 修改umask值">2.4 修改umask值 <a href="#t132.4 修改umask值"> # </a></h3>
<p>临时修改</p>
<pre><code class="lang-js">umask <span class="hljs-number">0002</span>
</code></pre>
<p>永久修改</p>
<pre><code class="lang-js">vi /etc/profile
</code></pre>
<h2 id="t143. ACL">3. ACL <a href="#t143. ACL"> # </a></h2>
<ul>
<li>一个文件或文件夹只能有一个所有者和所属组，无法适应某些应用场景</li>
<li>访问控制(Access Control List，ACL)就是为特定的用户和组分配特定权限</li>
</ul>
<h3 id="t153.1 查看分区ACL权限是否开启">3.1 查看分区ACL权限是否开启 <a href="#t153.1 查看分区ACL权限是否开启"> # </a></h3>
<ul>
<li>dumpe2fs 命令是查询指定分区详细文件系统信息的命令<ul>
<li>-h 仅显示块中的信息，而不显示磁盘块组的详细信息</li>
</ul>
</li>
</ul>
<pre><code class="lang-js">dumpe2fs -h /dev/sda1

Default mount options:    user_xattr acl
</code></pre>
<h4 id="t163.1.1 临时开启分区的ACL权限">3.1.1 临时开启分区的ACL权限 <a href="#t163.1.1 临时开启分区的ACL权限"> # </a></h4>
<p>重新挂载根分区，并挂载加入ACL权限</p>
<pre><code class="lang-js">mount -o remount,acl /dev/sda1
</code></pre>
<h4 id="t173.1.2  永久开启分区的ACL权限">3.1.2  永久开启分区的ACL权限 <a href="#t173.1.2  永久开启分区的ACL权限"> # </a></h4>
<pre><code class="lang-js">vi /etc/fstab
UUID /  ext4 defaults,acl  <span class="hljs-number">1</span> <span class="hljs-number">1</span>
mount -o remount /dev/sda1
</code></pre>
<h3 id="t183.2 读写ACL权限">3.2 读写ACL权限 <a href="#t183.2 读写ACL权限"> # </a></h3>
<h4 id="t193.2.1 setfacl">3.2.1 setfacl <a href="#t193.2.1 setfacl"> # </a></h4>
<ul>
<li><code>setfacl 选项 文件名</code></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">选项</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-m</td>
<td style="text-align:left">设定ACL权限</td>
</tr>
<tr>
<td style="text-align:left">-x</td>
<td style="text-align:left">删除指定的ACL权限</td>
</tr>
<tr>
<td style="text-align:left">-b</td>
<td style="text-align:left">删除所有的ACL权限</td>
</tr>
<tr>
<td style="text-align:left">-d</td>
<td style="text-align:left">设定默认ACL权限</td>
</tr>
<tr>
<td style="text-align:left">-k</td>
<td style="text-align:left">删除默认的ACL权限</td>
</tr>
<tr>
<td style="text-align:left">-R</td>
<td style="text-align:left">递归设定ACL权限</td>
</tr>
</tbody>
</table>
<h4 id="t203.2.2 setfacl">3.2.2 setfacl <a href="#t203.2.2 setfacl"> # </a></h4>
<ul>
<li>给用户<code>guest</code>赋予rx权限</li>
<li>格式 "u:用户名:权限"<pre><code class="lang-js">useradd guest
mkdir /home/guest/folder
useradd teacher
groupadd students
mkdir folder
chown teacher:students /home/guest/folder
chmod <span class="hljs-number">770</span> /home/guest/folder
</code></pre>
<h4 id="t213.2.2 设置最大权限">3.2.2 设置最大权限 <a href="#t213.2.2 设置最大权限"> # </a></h4>
</li>
<li>mask是最大有效权限，如果给用户赋予了ACL权限，是需要和mask的权限做与运算后才能得到真正权限</li>
<li>如果mask值是777，那么任何数与它相与，得到的是权限本身</li>
<li>如果允许自定义ACL，又不想让它超出最大权限</li>
</ul>
<pre><code class="lang-js">setfacl -m m:r folder
[root@localhost someone]# getfacl folder
# file: folder
# owner: teach
# group: stus
user::rwx
user:someone:r-x        #effective:r--
group::rwx            #effective:r--
mask::r--
other::---
</code></pre>
<h4 id="t223.2.3 删除ACL权限">3.2.3 删除ACL权限 <a href="#t223.2.3 删除ACL权限"> # </a></h4>
<h5 id="t233.2.3.1 删除指定用户的ACL权限">3.2.3.1 删除指定用户的ACL权限 <a href="#t233.2.3.1 删除指定用户的ACL权限"> # </a></h5>
<p><code>setfacl -x u:用户名 文件名</code></p>
<pre><code class="lang-js">setfacl -x u:someone folder
</code></pre>
<h5 id="t243.2.3.2 删除文件所有用户的ACL权限">3.2.3.2 删除文件所有用户的ACL权限 <a href="#t243.2.3.2 删除文件所有用户的ACL权限"> # </a></h5>
<p><code>setfacl -b  文件名</code></p>
<pre><code class="lang-js">setfacl -b folder
</code></pre>
<h5 id="t253.2.3.3 删除指定用户组的ACL权限">3.2.3.3 删除指定用户组的ACL权限 <a href="#t253.2.3.3 删除指定用户组的ACL权限"> # </a></h5>
<p><code>setfacl -x g:组名 文件名</code></p>
<pre><code class="lang-js">setfacl -x g:students folder
</code></pre>
<h4 id="t263.2.4 递归权限">3.2.4 递归权限 <a href="#t263.2.4 递归权限"> # </a></h4>
<ul>
<li>向下一级一级传递权限</li>
<li>父目录设定ACL权限的时候，所有的子文件和子目录也会拥有相同的ACL权限</li>
<li>递归仅能赋给目录不能赋给文件</li>
</ul>
<pre><code class="lang-js">setfacl -m u:someone:rx folder
setfacl -m u:someone:rx -R folder
</code></pre>
<h4 id="t273.2.5 默认权限">3.2.5 默认权限 <a href="#t273.2.5 默认权限"> # </a></h4>
<ul>
<li>默认ACL权限是指如果给父目录设置了默认ACL权限，那么父目录里所有新建的子文件都会继承父目录的ACL权限</li>
<li>setfacl -m d:u:用户名:权限 目录名</li>
</ul>
<pre><code class="lang-js">setfacl -m d:u:someone:rw folder
</code></pre>
<h2 id="t284. sudo权限">4. sudo权限 <a href="#t284. sudo权限"> # </a></h2>
<ul>
<li>root把本来只有超级管理员可以使用的命令赋予普通用户来使用</li>
<li>sudo操作的对象是系统命令</li>
</ul>
<h3 id="t294.1 visudo">4.1 visudo <a href="#t294.1 visudo"> # </a></h3>
<ul>
<li>通过<code>visudo</code>可以由超级用户赋权</li>
<li>实际修改的是<code>/etc/sudoers</code>文件</li>
<li>命令必须写绝对路径 </li>
</ul>
<pre><code class="lang-js">root    ALL=(ALL) ALL
用户名 被管理主机地址=(可使用的身份) 授权命令(绝对路径)

somethone ALL=(root) /usr/sbin/useradd         <span class="hljs-comment">//新增加用户行</span>
</code></pre>
<pre><code class="lang-js">%wheel ALL=(ALL) ALL
%组名 被管理主机地址(IP)=(可使用的身份) 授权命令(绝对路径)
</code></pre>
<pre><code class="lang-js">sudo -l  查看目前的sudo权限

</code></pre>
<h2 id="t306. 特殊权限">6. 特殊权限 <a href="#t306. 特殊权限"> # </a></h2>
<h3 id="t316.1 SetUID">6.1 SetUID <a href="#t316.1 SetUID"> # </a></h3>
<ul>
<li><code>set User ID</code></li>
<li>只有可以执行的二进制程序才能设置SUID权限</li>
<li>命令执行者要对该程序有x(执行)权限</li>
<li>命令执行者在执行该程序的时候身份会变成文件的所有者</li>
<li>SetUID权限只在该程序执行过程中有效，也就是说身份改变在程序执行过程中有效</li>
<li>文件属主的x权限,用s代替.表示被设置了SUID,如果属主位没有x权限,会显示为大写S,表示有故障(权限无效) </li>
</ul>
<p>字母表示法</p>
<pre><code class="lang-js">chmod u+s 文件
chmod u-s 文件
</code></pre>
<p>数字表示法,在普通三位数字权限位之前,用4代表添加的SUID位
<code>chmod 4755 文件</code> 添加<code>SUID</code>权限到二进制程序文件(添加到目录无意义)</p>
<pre><code class="lang-js">chmod <span class="hljs-number">4755</span> 文件
chmod <span class="hljs-number">0</span>xxx 可以删除文件的 SUID(无法删除目录的SUID)  
</code></pre>
<pre><code class="lang-js">chmod <span class="hljs-number">4755</span> hello.sh

ll /etc/shadow
ll /user/bin/passwd
</code></pre>
<h4 id="t326.1.1 设置SUID">6.1.1 设置SUID <a href="#t326.1.1 设置SUID"> # </a></h4>
<pre><code class="lang-js">chmod <span class="hljs-number">4755</span> 文件名
chmod u+s 文件名 给所有者加suid权限
chmod g+s 文件名 给所属组加suid权限
chmod o+s 文件名 给其它人加suid权限
</code></pre>
<h4 id="t336.1.2 取消SUID">6.1.2 取消SUID <a href="#t336.1.2 取消SUID"> # </a></h4>
<pre><code class="lang-js">chmod <span class="hljs-number">0755</span> 文件名
chmod u-x 文件名 给所有者减去suid权限
</code></pre>
<h4 id="t346.1.3 安全设置">6.1.3 安全设置 <a href="#t346.1.3 安全设置"> # </a></h4>
<ul>
<li>关键目录应该严格控制写权限</li>
<li>用户的密码要正确设置</li>
<li>不能轻易给文件赋SetUID权限</li>
</ul>
<pre><code class="lang-js">chmod <span class="hljs-number">4755</span> /bin/vi
/bin/vi /etc/shadow
</code></pre>
<h3 id="t356.2 SetGID">6.2 SetGID <a href="#t356.2 SetGID"> # </a></h3>
<p>Set Group ID</p>
<h4 id="t366.2.1 设置方法">6.2.1 设置方法 <a href="#t366.2.1 设置方法"> # </a></h4>
<p>字母表示法</p>
<pre><code class="lang-js">chmod g+s 文件

chmod g-s 文件
</code></pre>
<p>数字表示法</p>
<pre><code class="lang-js">chmod <span class="hljs-number">2755</span>  文件/目录 添加SGID到目录或文件
在普通数字权限位前,用<span class="hljs-number">2</span>代表添加SGID位
chmod <span class="hljs-number">0755</span> 文件/目录 删除文件的SGID,(目录不受影响)
chmod <span class="hljs-number">755</span> 文件/目录 同上 
</code></pre>
<h4 id="t376.2.2 作用目标">6.2.2 作用目标 <a href="#t376.2.2 作用目标"> # </a></h4>
<h5 id="t386.2.2.1 针对文件">6.2.2.1 针对文件 <a href="#t386.2.2.1 针对文件"> # </a></h5>
<ul>
<li>只有可执行的二进制程序才能设置SGID权限</li>
<li>命令执行者要对该程序拥有x(执行)权限</li>
<li>命令执行在执行程序的时候，执行者的组身份升级为该程序文件的所属组</li>
<li><code>set</code>GID权限同样只在该程序执行过程中有效，也就是说组身份改变只在程序执行过程中有效</li>
</ul>
<pre><code class="lang-js">chmod <span class="hljs-number">4755</span> /bin/cat
chmod <span class="hljs-number">0755</span> /bin/cat
chmod u+s /bin/cat
chmod u-s /bin/cat

cat /root/uid.txt
</code></pre>
<ul>
<li>因为 /usr/bin/locate是可执行二进制程序，可以赋予SGID</li>
<li>执行用户对  /usr/bin/locate 命令拥有执行权限</li>
<li>执行 /usr/bin/locate 命令时组身份会升级为slocate组，而slocate组对/var/lib/mlocate/mlocate.db文件拥有读权限，所以普通用户也可以使用locate命令</li>
<li>当命令执行结束，普通用户的组身份切换回自己的组身份</li>
</ul>
<h5 id="t396.2.2.2  针对目录">6.2.2.2  针对目录 <a href="#t396.2.2.2  针对目录"> # </a></h5>
<ul>
<li>可以针对文件或者目录设置GID权限</li>
<li>普通用户必须对此目录拥有<code>r</code>和<code>x</code>权限，才能进入此目录</li>
<li>普通用户在此目录中的组会变成此目录的所属组</li>
<li>如果普通用户对此目录拥有<code>w</code>权限时，新建的文件的默认属组是这个目录的所属组</li>
</ul>
<pre><code class="lang-js">mkdir test3
<span class="hljs-comment">//设置SetGID</span>
chmod <span class="hljs-number">2755</span> test3
chmod g+s test3
ll -d test3
chmod <span class="hljs-number">777</span> test3

touch <span class="hljs-number">1.</span>txt
ll -h <span class="hljs-number">1.</span>txt

取消 SetGID
chmod <span class="hljs-number">0755</span>  文件名
chmod g-s 文件名
</code></pre>
<h3 id="t406.3 Sticky BIT">6.3 Sticky BIT <a href="#t406.3 Sticky BIT"> # </a></h3>
<ul>
<li>粘着位目前只针对目录有效</li>
<li>普通用户对该目录拥有w和x权限，即普通用户可以在此目录拥有写入权限</li>
<li>如果没有粘着位，因为普通用户拥有w权限，所以可以删除此目录下的所有文件，包括其它用户的文件。但一旦赋予了粘着位，除了root之外，普通用户就算拥有了w权限，也只能删除自己建立的文件，不能删除其它用户的文件</li>
<li>必须给其它人赋完整权限</li>
</ul>
<h4 id="t416.3.1 设置和取消">6.3.1 设置和取消 <a href="#t416.3.1 设置和取消"> # </a></h4>
<h5 id="t426.3.1.1 设置Sticky">6.3.1.1 设置Sticky <a href="#t426.3.1.1 设置Sticky"> # </a></h5>
<pre><code class="lang-js">chmod <span class="hljs-number">1755</span>  目录名
chmod o+t 目录名
</code></pre>
<h5 id="t436.3.1.2 取消Sticky">6.3.1.2 取消Sticky <a href="#t436.3.1.2 取消Sticky"> # </a></h5>
<pre><code class="lang-js">chmod <span class="hljs-number">0755</span>  目录名
chmod o-t 目录名

ll -d /tmp
</code></pre>
<h3 id="t446.4 不可改变位权限">6.4 不可改变位权限 <a href="#t446.4 不可改变位权限"> # </a></h3>
<ul>
<li>chattr [+-=] [选项] 文件或目录名</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">选项</th>
<th style="text-align:left">文件</th>
<th style="text-align:left">目录</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">+i</td>
<td style="text-align:left">不允许对文件进行删除、改名，也不能添加和修改数据</td>
<td style="text-align:left">只能修改目录下文件的数据，但不允许建立和删除文件</td>
</tr>
<tr>
<td style="text-align:left">+a</td>
<td style="text-align:left">只能在文件中增加属性，但不能删除也不能修改数据</td>
<td style="text-align:left">只允许在目录中建立和修改文件，不能删除</td>
</tr>
</tbody>
</table>
<pre><code class="lang-js">chattr +i folder
lsattr folder
</code></pre>

    