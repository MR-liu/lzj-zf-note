
        <h2 id="t01.为什么需要测试">1.为什么需要测试 <a href="#t01.为什么需要测试"> # </a></h2>
<ul>
<li>软件测试是一种实际输出与预期输出之间的审核或者比较过程</li>
<li>测试可以尽早发现<code>BUG</code></li>
<li>测试可以提高代码质量 </li>
<li>测试可以让我们自信地重构</li>
</ul>
<h3 id="t11.1 创建项目">1.1 创建项目 <a href="#t11.1 创建项目"> # </a></h3>
<pre><code class="lang-js">mkdir zhufeng_test
cd zhufeng_test
npm init -y
mkdir src
</code></pre>
<h3 id="t21.2 手工测试">1.2 手工测试 <a href="#t21.2 手工测试"> # </a></h3>
<p>src\math.js</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">return</span> a + b;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">minus</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">return</span> a - b;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">multiply</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">return</span> a * b;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">divide</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">return</span> a / b;
}

<span class="hljs-built_in">console</span>.log(add(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>));
<span class="hljs-built_in">console</span>.log(minus(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>));
<span class="hljs-built_in">console</span>.log(multiply(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>));
<span class="hljs-built_in">console</span>.log(divide(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>));
</code></pre>
<h3 id="t31.3 断言">1.3 断言 <a href="#t31.3 断言"> # </a></h3>
<ul>
<li>表达程序设计人员对于系统应达状态的一种预期</li>
<li>断言是测试的核心,很多语言都内置了断言接口</li>
</ul>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">return</span> a + b;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">minus</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">return</span> a - b;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">multiply</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">return</span> a * b;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">divide</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">return</span> a / b;
}

<span class="hljs-built_in">console</span>.assert(add(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>) == <span class="hljs-number">6</span>, <span class="hljs-literal">true</span>);
<span class="hljs-built_in">console</span>.assert(minus(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>) == <span class="hljs-number">2</span>, <span class="hljs-literal">true</span>);
<span class="hljs-built_in">console</span>.assert(multiply(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>) == <span class="hljs-number">8</span>, <span class="hljs-literal">true</span>);
<span class="hljs-built_in">console</span>.assert(divide(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>) == <span class="hljs-number">2</span>, <span class="hljs-literal">true</span>);
</code></pre>
<h3 id="t41.4 测试框架">1.4 测试框架 <a href="#t41.4 测试框架"> # </a></h3>
<ul>
<li>测试用例可用来测试程序是否正确工作</li>
<li>通常把一组相关的测试称为一个测试套件(test suite)</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">手工断言</th>
<th style="text-align:left">测试框架</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">污染源代码</td>
<td style="text-align:left">可能分离测试代码和源代码</td>
</tr>
<tr>
<td style="text-align:left">散落在各个文件中</td>
<td style="text-align:left">测试代码可以集中存放</td>
</tr>
<tr>
<td style="text-align:left">没有办法持久化保存</td>
<td style="text-align:left">放置到单独的文件中</td>
</tr>
<tr>
<td style="text-align:left">手动执行和对比麻烦不自动</td>
<td style="text-align:left">可以自动运行、显示测试结果</td>
</tr>
</tbody>
</table>
<p>math.js</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">return</span> a + b;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">minus</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">return</span> a - b;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">multiply</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">return</span> a * b;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">divide</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">return</span> a / b;
}

<span class="hljs-built_in">module</span>.exports = {
    add,
    minus,
    multiply,
    divide
}
</code></pre>
<p>math.test.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> { add, minus, multiply, divide } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./math'</span>);
describe(<span class="hljs-string">'测试add'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    test(<span class="hljs-string">'测试1+1'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        assert(add(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) == <span class="hljs-number">2</span>, <span class="hljs-string">'1+1没有等于2'</span>);
    });
    test(<span class="hljs-string">'测试2+2'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        assert(add(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>) == <span class="hljs-number">4</span>, <span class="hljs-string">'2+2没有等于4'</span>);
    });
});
describe(<span class="hljs-string">'测试minus'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    test(<span class="hljs-string">'测试1+1'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        assert(minus(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>, <span class="hljs-string">'1-1没有等于0'</span>);
    });
    test(<span class="hljs-string">'测试2+2'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        assert(minus(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>) == <span class="hljs-number">0</span>, <span class="hljs-string">'2-2没有等于0'</span>);
    });
});
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">describe</span>(<span class="hljs-params">message, testSuite</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'测试套件'</span>, message);
    testSuite();
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params">message, testCase</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'测试用例'</span>, message);
    testCase();
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assert</span>(<span class="hljs-params">assertion, message</span>) </span>{
    <span class="hljs-keyword">if</span> (!assertion) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(message);
    }
}
<span class="hljs-comment">/**
 * 1. 从源代码中抽离
 * 2. 整体设计和排列
 * 3. 放置到单独的文件中
 * 4. 可以自动运行、显示测试结果
 */</span>
</code></pre>
<h2 id="t55.Jest">5.Jest <a href="#t55.Jest"> # </a></h2>
<ul>
<li><a href="https://jestjs.io/docs/zh-Hans/getting-started">jest</a>由Facebook出品,非常适合React测试</li>
<li>零配置</li>
<li>内置代码覆盖率</li>
<li>强大的Mocks</li>
</ul>
<h3 id="t65.1 安装">5.1 安装 <a href="#t65.1 安装"> # </a></h3>
<pre><code class="lang-js">cnpm install --save-dev jest
</code></pre>
<h3 id="t75.2 初体验">5.2 初体验 <a href="#t75.2 初体验"> # </a></h3>
<p>src\math.spec.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> { add, minus, multiply, divide } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./math'</span>);
describe(<span class="hljs-string">'测试add'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    test(<span class="hljs-string">'测试1+1'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        expect(add(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)).toBe(<span class="hljs-number">2</span>);
    });
    test(<span class="hljs-string">'测试2+2'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        expect(add(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)).toBe(<span class="hljs-number">4</span>);
    });
});
describe(<span class="hljs-string">'测试minus'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    test(<span class="hljs-string">'测试1-1'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        expect(minus(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)).toBe(<span class="hljs-number">0</span>);
    });
    test(<span class="hljs-string">'测试2-2'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        expect(minus(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)).toBe(<span class="hljs-number">0</span>);
    });
});
</code></pre>
<p>package.json</p>
<pre><code class="lang-diff">  "scripts": {
<span class="hljs-addition">+    "test": "jest  --watchAll"</span>
  }
</code></pre>
<pre><code class="lang-js">npm  test
</code></pre>
<p><img src="http://img.zhufengpeixun.cn/jestresult.png" alt="jestresult"></p>
<h3 id="t85.3 测试覆盖率">5.3 测试覆盖率 <a href="#t85.3 测试覆盖率"> # </a></h3>
<ul>
<li>代码覆盖率是软件测试中的一种度量,描述程序中源代码被测试的比例和程度,所得比例称为代码覆盖率</li>
<li>尽量穷尽</li>
<li>办界考虑完整</li>
<li>简单</li>
<li>独立</li>
<li>重复执行</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">类型</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">line coverage</td>
<td style="text-align:left">行覆盖率</td>
</tr>
<tr>
<td style="text-align:left">function coverage</td>
<td style="text-align:left">函数覆盖率</td>
</tr>
<tr>
<td style="text-align:left">branch coverage</td>
<td style="text-align:left">分支覆盖率</td>
</tr>
<tr>
<td style="text-align:left">statement coverage</td>
<td style="text-align:left">语句覆盖率</td>
</tr>
</tbody>
</table>
<p>package.json</p>
<pre><code class="lang-diff">  "scripts": {
     "test": "jest",
<span class="hljs-addition">+    "coverage": "jest --coverage"</span>
  },
</code></pre>
<pre><code class="lang-js">npx jest --coverage
npm run coverage
</code></pre>
<p><img src="http://img.zhufengpeixun.cn/coveragefirst.png" alt="coveragefirst">
<img src="http://img.zhufengpeixun.cn/coveragesecond.png" alt="coveragesecond"></p>
<h3 id="t95.4 配置">5.4 配置 <a href="#t95.4 配置"> # </a></h3>
<ul>
<li>可以通过配置文件<a href="https://jestjs.io/docs/zh-Hans/configuration#defaults">configuration</a>对Jest进行配置</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/jestconfig.png" alt="jestconfig"></p>
<h4 id="t105.4.1 生成配置文件">5.4.1 生成配置文件 <a href="#t105.4.1 生成配置文件"> # </a></h4>
<ul>
<li>支持测试<code>ts</code>和<code>jsx</code></li>
</ul>
<pre><code class="lang-js">jest --init
yarn add --dev babel-jest  @types/jest @babel/core @babel/preset-env @babel/preset-react @babel/preset-typescript typescript
</code></pre>
<h4 id="t115.4.2 babel.config.js">5.4.2 babel.config.js <a href="#t115.4.2 babel.config.js"> # </a></h4>
<pre><code class="lang-js"><span class="hljs-built_in">module</span>.exports = {
    <span class="hljs-attr">presets</span>: [
        [
            <span class="hljs-string">'@babel/preset-env'</span>,
            {
                <span class="hljs-attr">targets</span>: {
                    <span class="hljs-attr">node</span>: <span class="hljs-string">'current'</span>,
                }
            }
        ],
        <span class="hljs-string">'@babel/preset-typescript'</span>,
        <span class="hljs-string">'@babel/preset-react'</span>
    ],
};
</code></pre>
<h4 id="t125.4.3 jest.config.js">5.4.3 jest.config.js <a href="#t125.4.3 jest.config.js"> # </a></h4>
<ul>
<li><a href="https://github.com/jsdom/jsdom">jsdom</a>是web标准的纯JS实现</li>
</ul>
<p>jest.config.js默认配置</p>
<pre><code class="lang-js"><span class="hljs-built_in">module</span>.exports = {
    <span class="hljs-attr">testMatch</span>: [<span class="hljs-string">"**/__tests__/**/*.[jt]s?(x)"</span>,<span class="hljs-string">"**/?(*.)+(spec|test).[tj]s?(x)"</span>],
    <span class="hljs-attr">testRegex</span>: [],
    <span class="hljs-attr">testEnvironment</span>:<span class="hljs-string">'jsdom'</span>,
    <span class="hljs-attr">rootDir</span>:<span class="hljs-literal">null</span>,<span class="hljs-comment">//可以通过&lt;rootDir&gt;引用</span>
    <span class="hljs-attr">moduleFileExtensions</span>:[<span class="hljs-string">"js"</span>,<span class="hljs-string">"json"</span>,<span class="hljs-string">"jsx"</span>,<span class="hljs-string">"ts"</span>,<span class="hljs-string">"tsx"</span>,<span class="hljs-string">"node"</span>],
    <span class="hljs-attr">clearMocks</span>:<span class="hljs-literal">true</span>
}
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left">选项</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">testMatch</td>
<td style="text-align:left">用来检测测试文件的glob模式</td>
</tr>
<tr>
<td style="text-align:left">testRegex</td>
<td style="text-align:left">用来检测测试文件的正则表达式或正则表达式数组</td>
</tr>
<tr>
<td style="text-align:left">testEnvironment</td>
<td style="text-align:left">用来跑测试的测试环境,可以选择<code>jsdom</code>或<code>node</code></td>
</tr>
<tr>
<td style="text-align:left">rootDir</td>
<td style="text-align:left">Jest用来描述测试文件或模块的根目录，默认是<code>package.json</code>所在的目录</td>
</tr>
<tr>
<td style="text-align:left">moduleFileExtensions</td>
<td style="text-align:left">使用的模块的文件扩展名数组</td>
</tr>
<tr>
<td style="text-align:left">clearMocks</td>
<td style="text-align:left">在每一次测试时自动清除mock调用和实例</td>
</tr>
<tr>
<td style="text-align:left">coverageDirectory</td>
<td style="text-align:left">输出代码覆盖率的目录</td>
</tr>
</tbody>
</table>
<h4 id="t135.4.4 tsconfig.json">5.4.4 tsconfig.json <a href="#t135.4.4 tsconfig.json"> # </a></h4>
<pre><code class="lang-js">tsx --init
</code></pre>
<p>tsconfig.json</p>
<pre><code class="lang-diff">{
  "compilerOptions": {
<span class="hljs-addition">+   "target": "ES2015", </span>
    "module": "commonjs", 
<span class="hljs-addition">+    "jsx": "preserve", </span>
<span class="hljs-addition">+    "strict": false, </span>
<span class="hljs-addition">+    "noImplicitAny": false,</span>
<span class="hljs-addition">+    "strictNullChecks": false, </span>
    "esModuleInterop": true
  }
}
</code></pre>
<h3 id="t145.5 Matchers">5.5 Matchers <a href="#t145.5 Matchers"> # </a></h3>
<ul>
<li>Jest使用<a href="https://jestjs.io/docs/zh-Hans/using-matchers">匹配器</a>让你可以用各种方式测试你的代码</li>
<li><a href="https://jestjs.io/docs/zh-Hans/expect">完整的匹配器API</a></li>
<li><code>Matchers</code>也可以称之为断言库</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/allmatchers.png" alt="allmatchers"></p>
<h4 id="t155.5.1 matches.tsx">5.5.1 matches.tsx <a href="#t155.5.1 matches.tsx"> # </a></h4>
<p><strong>tests</strong>\matches.tsx</p>
<pre><code class="lang-js">declare <span class="hljs-keyword">var</span> expect;
it(<span class="hljs-string">'matchers'</span>, () =&gt; {
    expect(<span class="hljs-number">1</span>).toEqual(<span class="hljs-number">1</span>);
    expect([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]).toEqual([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
    expect(<span class="hljs-literal">null</span>).toBeNull();
    expect([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]).toContain(<span class="hljs-number">1</span>);
    expect({ <span class="hljs-attr">name</span>: <span class="hljs-string">'zhufeng'</span> }).toHaveProperty(<span class="hljs-string">'name'</span>);
    expect(<span class="hljs-string">'123'</span>).toContain(<span class="hljs-string">'2'</span>);
    expect(<span class="hljs-string">'123'</span>).toMatch(<span class="hljs-regexp">/^\d+$/</span>);
    expect([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]).not.toContain(<span class="hljs-number">4</span>);
});
</code></pre>
<h3 id="t165.6 测试DOM">5.6 测试DOM <a href="#t165.6 测试DOM"> # </a></h3>
<ul>
<li>Jest里面可以直接操作DOM,是因为内置了<a href="https://github.com/jsdom/jsdom">jsdom</a></li>
<li>jsdom是一套模拟的DOM环境,可以在浏览器上运行</li>
<li>可以修改<code>jest.config.js</code>,设置 <code>testEnvironment: "jsdom"</code></li>
</ul>
<h4 id="t175.6.1 src\domUtils.tsx">5.6.1 src\domUtils.tsx <a href="#t175.6.1 src\domUtils.tsx"> # </a></h4>
<p>src\domUtils.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span>(<span class="hljs-params">node</span>) </span>{
    node.parentNode.removeChild(node);
}
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">on</span>(<span class="hljs-params">node, type, handler</span>) </span>{
    node.addEventListener(type, handler);
}
</code></pre>
<h4 id="t185.6.2 tests\domUtils.tsx">5.6.2 tests\domUtils.tsx <a href="#t185.6.2 tests\domUtils.tsx"> # </a></h4>
<p><strong>tests</strong>\domUtils.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> { remove, on } <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/domUtils'</span>;
declare <span class="hljs-keyword">var</span> describe;
declare <span class="hljs-keyword">var</span> test;
declare <span class="hljs-keyword">var</span> expect;
describe(<span class="hljs-string">'domUtils'</span>, () =&gt; {
    test(<span class="hljs-string">'remove'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">document</span>.body.innerHTML = (
            <span class="hljs-string">`
            &lt;div id="parent"&gt;
              &lt;div id="child"&gt;儿子&lt;/div&gt;
            &lt;/div&gt;
            `</span>
        );
        <span class="hljs-keyword">let</span> parent = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'parent'</span>);
        expect(parent.nodeName.toLocaleLowerCase()).toBe(<span class="hljs-string">'div'</span>);
        <span class="hljs-keyword">const</span> child = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'child'</span>);
        expect(child.nodeName.toLocaleLowerCase()).toBe(<span class="hljs-string">'div'</span>);
        remove(child);
        expect(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'child'</span>)).toBeNull();
    });
    test(<span class="hljs-string">'on'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">document</span>.body.innerHTML = <span class="hljs-string">'&lt;div id="container"&gt;&lt;button id="clickMe"&gt;click&lt;/button&gt;&lt;/div&gt;'</span>;
        <span class="hljs-keyword">let</span> clickMe = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'clickMe'</span>);
        on(clickMe, <span class="hljs-string">'click'</span>, () =&gt; {
            clickMe.innerHTML = <span class="hljs-string">'clicked'</span>;
        });
        clickMe.click();
        expect(clickMe.innerHTML).toBe(<span class="hljs-string">'clicked'</span>);
    });
})
</code></pre>
<h3 id="t195.7 异步请求">5.7 异步请求 <a href="#t195.7 异步请求"> # </a></h3>
<ul>
<li><a href="https://jestjs.io/docs/zh-Hans/asynchronous">asynchronous</a><h4 id="t205.7.1 src\api.tsx">5.7.1 src\api.tsx <a href="#t205.7.1 src\api.tsx"> # </a></h4>
src\api.tsx<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> callCallback = <span class="hljs-function">(<span class="hljs-params">onSuccess</span>) =&gt;</span> {
  setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      onSuccess({ <span class="hljs-attr">code</span>: <span class="hljs-number">0</span> });
  }, <span class="hljs-number">3000</span>);
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> callPromise = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve</span>) </span>{
      setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
          resolve({ <span class="hljs-attr">code</span>: <span class="hljs-number">0</span> });
      }, <span class="hljs-number">3000</span>);
  });
}
</code></pre>
</li>
</ul>
<h4 id="t215.7.2 tests\api.tsx">5.7.2 tests\api.tsx <a href="#t215.7.2 tests\api.tsx"> # </a></h4>
<p><strong>tests</strong>\api.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> { callCallback, callPromise } <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/api'</span>;
declare <span class="hljs-keyword">var</span> describe;
declare <span class="hljs-keyword">var</span> it;
declare <span class="hljs-keyword">var</span> expect;
describe(<span class="hljs-string">'测试异步接口'</span>, () =&gt; {
    it(<span class="hljs-string">'测试 callCallback'</span>, (done) =&gt; {
        callCallback(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
            expect(result.code).toBe(<span class="hljs-number">0</span>);
            done();
        });
    });
    it(<span class="hljs-string">'测试 callPromise'</span>, () =&gt; {
        <span class="hljs-keyword">return</span> callPromise().then(<span class="hljs-function">(<span class="hljs-params">result: any</span>) =&gt;</span> {
            expect(result.code).toBe(<span class="hljs-number">0</span>);
        });
    });
    it(<span class="hljs-string">'测试 callAsync'</span>, <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">let</span> result: any = <span class="hljs-keyword">await</span> callPromise();
        expect(result.code).toBe(<span class="hljs-number">0</span>);
    });
    it(<span class="hljs-string">'测试 resolves'</span>, <span class="hljs-keyword">async</span> () =&gt; {
        expect(callPromise()).resolves.toMatch({ <span class="hljs-attr">code</span>: <span class="hljs-number">0</span> });
    });
});
</code></pre>
<h3 id="t225.8 钩子函数">5.8 钩子函数 <a href="#t225.8 钩子函数"> # </a></h3>
<ul>
<li><a href="https://jestjs.io/docs/en/api#afterallfn-timeout">钩子函数</a>对不同测试执行阶段提供了对应的回调接口</li>
<li>beforeAll 在所有测试用例执行之前执行</li>
<li>beforeEach 每个测试用例执行前执行</li>
<li>afterEach 每个测试用例执行结束时</li>
<li>afterAll 等所有测试用例都执行之后执行</li>
<li><a href="https://jestjs.io/docs/en/api#testonlyname-fn-timeout">only</a>的意思是只调用特定的测试用例</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> counter = <span class="hljs-number">0</span>;
declare <span class="hljs-keyword">var</span> describe;
declare <span class="hljs-keyword">var</span> beforeAll;
declare <span class="hljs-keyword">var</span> beforeEach;
declare <span class="hljs-keyword">var</span> afterEach;
declare <span class="hljs-keyword">var</span> afterAll;
declare <span class="hljs-keyword">var</span> test;
describe(<span class="hljs-string">'counter测试代码'</span>, () =&gt; {
    beforeAll(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'BeforeAll'</span>); counter++;
    })

    beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'BeforeEach'</span>); counter++;
    })

    afterEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'AfterEach'</span>); counter++;
    })

    afterAll(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'AfterAll'</span>); counter++;
        <span class="hljs-built_in">console</span>.log(counter);
    })

    describe(<span class="hljs-string">'测试用例'</span>, () =&gt; {
        test(<span class="hljs-string">'测试用例1'</span>, () =&gt; {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'测试用例1'</span>); counter++;
        });
        test(<span class="hljs-string">'测试用例2'</span>, () =&gt; {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'测试用例2'</span>); counter++;
        });
    });
});
</code></pre>
<h3 id="t235.9 mock">5.9 mock <a href="#t235.9 mock"> # </a></h3>
<ul>
<li><a href="https://jestjs.io/docs/zh-Hans/mock-functions">mock-functions</a>可以擦除函数的实际实现来测试代码</li>
<li>使用<code>mock function</code>可以查看函数的调用次数以及入参的情况</li>
<li>原生的定时器函数并不是很方便测试,我们通过<a href="https://jestjs.io/docs/zh-Hans/timer-mocks">jest.useFakeTimers()</a>来模拟定时器函数</li>
</ul>
<h4 id="t245.9.1 src\mock.tsx">5.9.1 src\mock.tsx <a href="#t245.9.1 src\mock.tsx"> # </a></h4>
<p>src\mock.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">exec</span>(<span class="hljs-params">callback</span>) </span>{
    callback(<span class="hljs-string">'123'</span>);
    callback(<span class="hljs-string">'456'</span>);
}
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createInstance</span>(<span class="hljs-params">ClassName</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ClassName();
}
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getData</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> axios.get(<span class="hljs-string">'/api/users'</span>);
}
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">delay</span>(<span class="hljs-params">callback, ms</span>) </span>{
    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        callback(ms);
    }, ms);
}
</code></pre>
<h4 id="t255.9.2 tests\mock.tsx">5.9.2 tests\mock.tsx <a href="#t255.9.2 tests\mock.tsx"> # </a></h4>
<p><strong>tests</strong>\mock.tsx</p>
<pre><code class="lang-js">jest.mock(<span class="hljs-string">'axios'</span>);
<span class="hljs-keyword">import</span> { exec, createInstance, getData, delay } <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/mock'</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
declare <span class="hljs-keyword">var</span> jest;
declare <span class="hljs-keyword">var</span> expect;
test(<span class="hljs-string">'测试exec'</span>, () =&gt; {
    <span class="hljs-comment">//let callback = jest.fn(() =&gt; Math.random());</span>
    <span class="hljs-keyword">let</span> callback = jest.fn();
    callback.mockReturnValueOnce(<span class="hljs-string">'abc'</span>);
    callback.mockReturnValueOnce(<span class="hljs-string">'def'</span>);
    exec(callback);
    expect(callback).toBeCalled();
    expect(callback).toBeCalledTimes(<span class="hljs-number">2</span>);
    expect(callback).toBeCalledWith(<span class="hljs-string">'123'</span>);
});
test(<span class="hljs-string">'测试createInstance'</span>, () =&gt; {
    <span class="hljs-comment">//let callback = jest.fn(() =&gt; Math.random());</span>
    <span class="hljs-keyword">let</span> callback = jest.fn(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">this: any</span>) </span>{
        <span class="hljs-keyword">this</span>.name = <span class="hljs-string">'zhufeng'</span>;
    });
    createInstance(callback);
});

test(<span class="hljs-string">'测试getData'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    (axios.get <span class="hljs-keyword">as</span> any).mockResolvedValue({ <span class="hljs-attr">data</span>: { <span class="hljs-attr">code</span>: <span class="hljs-number">0</span> } });
    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> getData();
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'result'</span>, result);
    expect(result.data).toEqual({ <span class="hljs-attr">code</span>: <span class="hljs-number">0</span> });
});
jest.useFakeTimers();
test(<span class="hljs-string">'测试delay'</span>, (done) =&gt; {
    delay(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
        expect(result).toBe(<span class="hljs-number">1000</span>);
        done();
    }, <span class="hljs-number">1000</span>);
    jest.runAllTimers();
});
</code></pre>
<h2 id="t266. TDD(Test-Driven-Development)">6. TDD(Test-Driven-Development) <a href="#t266. TDD(Test-Driven-Development)"> # </a></h2>
<ul>
<li>测试驱动开发模式  需求分析-&gt;拆分模块-&gt;编写测试用例-&gt;编写代码通过测试用例-&gt;重构-&gt;发布</li>
<li>重构时可以减少BUG、提高代码质量、提高可维护性</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/tddimage.jpg" alt="tddimage"></p>
<h3 id="t276.1 创建项目">6.1 创建项目 <a href="#t276.1 创建项目"> # </a></h3>
<p><img src="http://img.zhufengpeixun.cn/messagelist.png" alt="messagelist"></p>
<p><a href="http://img.zhufengpeixun.cn/msg.html">项目预览</a></p>
<pre><code class="lang-js">create-react-app  zhufeng_message_app --typescript
cd zhufeng_message_app
cnpm install --save-dev enzyme @types/enzyme enzyme-adapter-react<span class="hljs-number">-16</span> @types/enzyme-adapter-react<span class="hljs-number">-16</span> -D
yarn start
</code></pre>
<h3 id="t286.2 环境准备">6.2 环境准备 <a href="#t286.2 环境准备"> # </a></h3>
<h4 id="t296.2.1 src\react-app-env.d.ts">6.2.1 src\react-app-env.d.ts <a href="#t296.2.1 src\react-app-env.d.ts"> # </a></h4>
<p>src\react-app-env.d.ts</p>
<pre><code class="lang-js"><span class="hljs-comment">/// &lt;reference types="react-scripts" /&gt;</span>
</code></pre>
<h4 id="t306.2.2 src\setupTests.ts">6.2.2 src\setupTests.ts <a href="#t306.2.2 src\setupTests.ts"> # </a></h4>
<p>src\setupTests.ts</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> <span class="hljs-string">'@testing-library/jest-dom/extend-expect'</span>;
<span class="hljs-keyword">import</span> Enzyme <span class="hljs-keyword">from</span> <span class="hljs-string">'enzyme'</span>;
<span class="hljs-keyword">import</span> Adaptor <span class="hljs-keyword">from</span> <span class="hljs-string">'enzyme-adapter-react-16'</span>;
Enzyme.configure({ <span class="hljs-attr">adapter</span>: <span class="hljs-keyword">new</span> Adaptor() });
</code></pre>
<h4 id="t316.2.3 tsconfig.json">6.2.3 tsconfig.json <a href="#t316.2.3 tsconfig.json"> # </a></h4>
<p>tsconfig.json</p>
<pre><code class="lang-diff">{
  "compilerOptions": {
    "jsx": "react",
<span class="hljs-addition">+    "noImplicitAny": false</span>
  }
}
</code></pre>
<h3 id="t326.3 Message.tsx">6.3 Message.tsx <a href="#t326.3 Message.tsx"> # </a></h3>
<ul>
<li><a href="https://airbnb.io/enzyme/docs/api/shallow.html">shallow</a></li>
<li><a href="https://airbnb.io/enzyme/docs/api/mount.html">mount</a></li>
<li><a href="http://npm.taobao.org/package/expect-enzyme">expect-enzyme</a></li>
</ul>
<h4 id="t336.3.1 测试用例">6.3.1 测试用例 <a href="#t336.3.1 测试用例"> # </a></h4>
<p>src__tests__\components\Message.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> Message <span class="hljs-keyword">from</span> <span class="hljs-string">'../../components/Message'</span>;
<span class="hljs-keyword">import</span> { shallow } <span class="hljs-keyword">from</span> <span class="hljs-string">'enzyme'</span>;
describe(<span class="hljs-string">'测试Message'</span>, () =&gt; {
    test(<span class="hljs-string">'应该渲染出来一个li,类名list-group-item,内容是zhufeng'</span>, () =&gt; {
        <span class="hljs-keyword">let</span> message = { <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'zhufeng'</span> };
        <span class="hljs-keyword">const</span> wrapper = shallow(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Message</span> <span class="hljs-attr">message</span>=<span class="hljs-string">{message}</span> /&gt;</span></span>);
        <span class="hljs-keyword">const</span> li = wrapper.find(<span class="hljs-string">`li`</span>);
        expect(li).toHaveLength(<span class="hljs-number">1</span>);
        expect(li.prop(<span class="hljs-string">'className'</span>)).toBe(<span class="hljs-string">'list-group-item'</span>);
        expect(li.prop(<span class="hljs-string">'children'</span>)).toContain(<span class="hljs-string">'zhufeng'</span>);
    });
});
</code></pre>
<h4 id="t346.3.2 重构实现">6.3.2 重构实现 <a href="#t346.3.2 重构实现"> # </a></h4>
<p>src\components\Message.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">props</span>) </span>{
    <span class="hljs-keyword">let</span> { content } = props.message;
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"list-group-item"</span> &gt;</span>{content}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>
    )
}
</code></pre>
<h3 id="t356.4 MessageList.tsx">6.4 MessageList.tsx <a href="#t356.4 MessageList.tsx"> # </a></h3>
<h4 id="t366.4.1 测试用例">6.4.1 测试用例 <a href="#t366.4.1 测试用例"> # </a></h4>
<p>src__tests__\components\MessageList.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> MessageList <span class="hljs-keyword">from</span> <span class="hljs-string">'../../components/MessageList'</span>;
<span class="hljs-keyword">import</span> { mount } <span class="hljs-keyword">from</span> <span class="hljs-string">'enzyme'</span>;
describe(<span class="hljs-string">'测试MessageList'</span>, () =&gt; {
  test(<span class="hljs-string">'传入2个留言,应该渲染出来2个li'</span>, () =&gt; {
    <span class="hljs-keyword">let</span> messages = [{ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'zhufeng'</span> }, { <span class="hljs-attr">id</span>: <span class="hljs-string">'2'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'jiagou'</span> }];
    <span class="hljs-keyword">const</span> wrapper = mount(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MessageList</span> <span class="hljs-attr">messages</span>=<span class="hljs-string">{messages}</span> /&gt;</span></span>);
    <span class="hljs-keyword">const</span> listItems = wrapper.find(<span class="hljs-string">`li`</span>);
    expect(listItems).toHaveLength(<span class="hljs-number">2</span>);
    expect(listItems.at(<span class="hljs-number">0</span>).text()).toContain(<span class="hljs-string">'zhufeng'</span>);
    expect(listItems.at(<span class="hljs-number">1</span>).text()).toContain(<span class="hljs-string">'jiagou'</span>);
  });
});
</code></pre>
<h4 id="t376.4.2 重构实现">6.4.2 重构实现 <a href="#t376.4.2 重构实现"> # </a></h4>
<p>src\components\MessageList.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> Message <span class="hljs-keyword">from</span> <span class="hljs-string">'./Message'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">props</span>) </span>{
    <span class="hljs-keyword">let</span> messages = props.messages;
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"list-group"</span>&gt;</span>
            {
                messages.map((message) =&gt; (
                    <span class="hljs-tag">&lt;<span class="hljs-name">Message</span> <span class="hljs-attr">message</span>=<span class="hljs-string">{message}</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{message.id}</span> /&gt;</span>
                ))
            }
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
    )
}
</code></pre>
<h3 id="t386.5 MessageForm.tsx">6.5 MessageForm.tsx <a href="#t386.5 MessageForm.tsx"> # </a></h3>
<h4 id="t396.5.1 测试用例">6.5.1 测试用例 <a href="#t396.5.1 测试用例"> # </a></h4>
<p>src__tests__\components\MessageForm.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> MessageForm <span class="hljs-keyword">from</span> <span class="hljs-string">'../../components/MessageForm'</span>;
<span class="hljs-keyword">import</span> { shallow, mount } <span class="hljs-keyword">from</span> <span class="hljs-string">'enzyme'</span>;
describe(<span class="hljs-string">'测试MessageForm'</span>, () =&gt; {
    test(<span class="hljs-string">'应该渲染出来一个表单,表单里有input和button'</span>, () =&gt; {
        <span class="hljs-keyword">let</span> addMessage = jest.fn();
        <span class="hljs-keyword">const</span> wrapper = shallow(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MessageForm</span> <span class="hljs-attr">addMessage</span>=<span class="hljs-string">{addMessage}</span> /&gt;</span></span>);
        <span class="hljs-keyword">const</span> form = wrapper.find(<span class="hljs-string">`form`</span>);
        <span class="hljs-keyword">const</span> input = wrapper.find(<span class="hljs-string">`input`</span>);
        <span class="hljs-keyword">const</span> button = wrapper.find(<span class="hljs-string">`button`</span>);
        expect(form).toHaveLength(<span class="hljs-number">1</span>);
        expect(input).toHaveLength(<span class="hljs-number">1</span>);
        expect(button).toHaveLength(<span class="hljs-number">1</span>);
    });
    test(<span class="hljs-string">'在输入框里输入内容,如果内容为空点击提交按钮不会添加留言'</span>, () =&gt; {
        <span class="hljs-keyword">let</span> addMessage = jest.fn();
        <span class="hljs-keyword">const</span> wrapper = mount(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MessageForm</span> <span class="hljs-attr">addMessage</span>=<span class="hljs-string">{addMessage}</span> /&gt;</span></span>);
        <span class="hljs-keyword">const</span> input = wrapper.find(<span class="hljs-string">`input`</span>);
        <span class="hljs-keyword">const</span> button = wrapper.find(<span class="hljs-string">`button`</span>);
        <span class="hljs-keyword">const</span> newValue = <span class="hljs-string">''</span>;
        input.simulate(<span class="hljs-string">'change'</span>, { <span class="hljs-attr">target</span>: { <span class="hljs-attr">value</span>: newValue } });
        button.simulate(<span class="hljs-string">'click'</span>);
        expect(addMessage).not.toHaveBeenCalled();
    });
    test(<span class="hljs-string">'在输入框里输入内容,如果内容不为空点击提交按钮会添加留言'</span>, () =&gt; {
        <span class="hljs-keyword">let</span> addMessage = jest.fn();
        <span class="hljs-keyword">const</span> wrapper = mount(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MessageForm</span> <span class="hljs-attr">addMessage</span>=<span class="hljs-string">{addMessage}</span> /&gt;</span></span>);
        <span class="hljs-keyword">const</span> input = wrapper.find(<span class="hljs-string">`input`</span>);
        <span class="hljs-keyword">const</span> button = wrapper.find(<span class="hljs-string">`button`</span>);
        <span class="hljs-keyword">const</span> newValue = <span class="hljs-string">'新留言'</span>;
        input.simulate(<span class="hljs-string">'change'</span>, { <span class="hljs-attr">target</span>: { <span class="hljs-attr">value</span>: newValue } });
        button.simulate(<span class="hljs-string">'click'</span>);
        expect(addMessage).toHaveBeenLastCalledWith(newValue)
    });
});
</code></pre>
<h4 id="t406.5.2 重构实现">6.5.2 重构实现 <a href="#t406.5.2 重构实现"> # </a></h4>
<p>src\components\MessageForm.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { useState, useCallback } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">props</span>) </span>{
    <span class="hljs-keyword">let</span> [content, setContent] = useState(<span class="hljs-string">''</span>);
    <span class="hljs-keyword">const</span> handleSubmit = useCallback(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        event.preventDefault();
        <span class="hljs-keyword">if</span> (content) {
            props.addMessage(content);
            setContent(<span class="hljs-string">''</span>);
        }
    }, [content])
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
                    <span class="hljs-attr">value</span>=<span class="hljs-string">{content}</span>
                    <span class="hljs-attr">onChange</span>=<span class="hljs-string">{event</span> =&gt;</span> setContent(event.target.value)}
                    className="form-control"
                    placeholder="请输入内容"
                /&gt;
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"btn btn-primary"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleSubmit}</span>&gt;</span>
                    发表
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
    )
}
</code></pre>
<h3 id="t416.6 MessageApp.tsx">6.6 MessageApp.tsx <a href="#t416.6 MessageApp.tsx"> # </a></h3>
<p>src__tests__\components\MessageApp.tsx</p>
<h4 id="t426.6.1 测试用例">6.6.1 测试用例 <a href="#t426.6.1 测试用例"> # </a></h4>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> MessageApp <span class="hljs-keyword">from</span> <span class="hljs-string">'../../components/MessageApp'</span>;
<span class="hljs-keyword">import</span> MessageList <span class="hljs-keyword">from</span> <span class="hljs-string">'../../components/MessageList'</span>;
<span class="hljs-keyword">import</span> MessageForm <span class="hljs-keyword">from</span> <span class="hljs-string">'../../components/MessageForm'</span>;
<span class="hljs-keyword">import</span> { mount } <span class="hljs-keyword">from</span> <span class="hljs-string">'enzyme'</span>;
describe(<span class="hljs-string">'测试MessageApp'</span>, () =&gt; {
    test(<span class="hljs-string">'应该渲染出来一个面板'</span>, () =&gt; {
        <span class="hljs-keyword">const</span> wrapper = mount(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MessageApp</span> /&gt;</span></span>);
        <span class="hljs-keyword">const</span> container = wrapper.find(<span class="hljs-string">`.container`</span>);
        <span class="hljs-keyword">const</span> panel = wrapper.find(<span class="hljs-string">`.panel.panel-default`</span>);
        <span class="hljs-keyword">const</span> panelHeading = wrapper.find(<span class="hljs-string">`.panel-heading`</span>);
        <span class="hljs-keyword">const</span> panelBody = wrapper.find(<span class="hljs-string">`.panel-body`</span>);
        <span class="hljs-keyword">const</span> panelFooter = wrapper.find(<span class="hljs-string">`.panel-footer`</span>);
        expect(container).toHaveLength(<span class="hljs-number">1</span>);
        expect(panel).toHaveLength(<span class="hljs-number">1</span>);
        expect(panelHeading).toHaveLength(<span class="hljs-number">1</span>);
        expect(panelBody).toHaveLength(<span class="hljs-number">1</span>);
        expect(panelFooter).toHaveLength(<span class="hljs-number">1</span>);
    });
    test(<span class="hljs-string">'默认状态是空数组'</span>, () =&gt; {
        <span class="hljs-keyword">const</span> wrapper = mount(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MessageApp</span> /&gt;</span></span>);
        expect(wrapper.state()).toMatchObject({ <span class="hljs-attr">messages</span>: [] });
    });
    test(<span class="hljs-string">'MessageList组件存在，并且给MessageList传递messages属性'</span>, () =&gt; {
        <span class="hljs-keyword">const</span> wrapper = mount(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MessageApp</span> /&gt;</span></span>);
        <span class="hljs-keyword">const</span> messageList = wrapper.find(MessageList);
        expect(messageList.prop(<span class="hljs-string">'messages'</span>)).toBe((wrapper.instance() <span class="hljs-keyword">as</span> MessageApp).state.messages);
    });
    test(<span class="hljs-string">'MessageForm组件存在，并且给MessageForm传递addMessage属性'</span>, () =&gt; {
        <span class="hljs-keyword">const</span> wrapper = mount(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MessageApp</span> /&gt;</span></span>);
        <span class="hljs-keyword">const</span> messageForm = wrapper.find(MessageForm);
        expect(messageForm.prop(<span class="hljs-string">'addMessage'</span>)).toBe((wrapper.instance() <span class="hljs-keyword">as</span> MessageApp).addMessage);
    });
    test(<span class="hljs-string">'点击提交按钮添加条目的时候，应该可以改变在MessageApp的state中添加一个新条目'</span>, () =&gt; {
        <span class="hljs-keyword">let</span> wrapper = mount(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MessageApp</span> /&gt;</span></span>);
        <span class="hljs-keyword">let</span> messageList = wrapper.find(MessageList);
        <span class="hljs-keyword">let</span> messageForm = wrapper.find(MessageForm);
        expect(wrapper.state(<span class="hljs-string">'messages'</span>)).toHaveLength(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">let</span> content = <span class="hljs-string">'我想你'</span>;
        <span class="hljs-keyword">const</span> input = messageForm.find(<span class="hljs-string">`input`</span>);
        <span class="hljs-keyword">const</span> button = messageForm.find(<span class="hljs-string">`button`</span>);
        input.simulate(<span class="hljs-string">'change'</span>, { <span class="hljs-attr">target</span>: { <span class="hljs-attr">value</span>: content } });
        button.simulate(<span class="hljs-string">'click'</span>);
        expect(wrapper.state(<span class="hljs-string">'messages'</span>)).toHaveLength(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">let</span> newMessages = [{ <span class="hljs-attr">id</span>: expect.any(<span class="hljs-built_in">String</span>), content }]
        expect(wrapper.state(<span class="hljs-string">'messages'</span>)).toEqual(newMessages);
        messageList = wrapper.find(MessageList);
        expect(messageList.prop(<span class="hljs-string">'messages'</span>)).toEqual(newMessages);
    });
});
</code></pre>
<h4 id="t436.5.2 重构实现">6.5.2 重构实现 <a href="#t436.5.2 重构实现"> # </a></h4>
<p>src\components\MessageApp.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> MessageList <span class="hljs-keyword">from</span> <span class="hljs-string">'./MessageList'</span>;
<span class="hljs-keyword">import</span> MessageForm <span class="hljs-keyword">from</span> <span class="hljs-string">'./MessageForm'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessageApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    state = { <span class="hljs-attr">messages</span>: [] }
    addMessage = <span class="hljs-function">(<span class="hljs-params">content: string</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> newMessage = { <span class="hljs-attr">id</span>: <span class="hljs-built_in">Date</span>.now() + <span class="hljs-string">''</span>, content };
        <span class="hljs-keyword">this</span>.setState({ <span class="hljs-attr">messages</span>: [...this.state.messages, newMessage] });
    }
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"container"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginTop:</span> <span class="hljs-attr">50</span> }}&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"col-md-8 col-md-offset-2"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"panel panel-default"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"panel-heading"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">textAlign:</span> '<span class="hljs-attr">center</span>' }}&gt;</span>珠峰留言版<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"panel-body"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">MessageList</span> <span class="hljs-attr">messages</span>=<span class="hljs-string">{this.state.messages}</span> /&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"panel-footer"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">MessageForm</span> <span class="hljs-attr">addMessage</span>=<span class="hljs-string">{this.addMessage}</span> /&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}
</code></pre>
<h2 id="t447. BDD(Behavior Driven Development)">7. BDD(Behavior Driven Development) <a href="#t447. BDD(Behavior Driven Development)"> # </a></h2>
<ul>
<li>BDD(Behavior Driven Development)行为驱动开发是一种敏捷软件开发的技术，它鼓励软件项目中的开发者、QA和非技术人员或商业参与者之间的协作</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/bddbehavior.png" alt="bddbehavior"></p>
<h3 id="t457.1 创建项目">7.1 创建项目 <a href="#t457.1 创建项目"> # </a></h3>
<p><a href="http://img.zhufengpeixun.cn/counter.html">项目预览</a></p>
<pre><code class="lang-js">create-react-app  zhufeng_message_app --typescript
cd zhufeng_message_app
cnpm install --save-dev enzyme @types/enzyme enzyme-adapter-react<span class="hljs-number">-16</span> @types/enzyme-adapter-react<span class="hljs-number">-16</span> -D
yarn start
</code></pre>
<h3 id="t467.2 环境准备">7.2 环境准备 <a href="#t467.2 环境准备"> # </a></h3>
<h4 id="t477.2.1 src\react-app-env.d.ts">7.2.1 src\react-app-env.d.ts <a href="#t477.2.1 src\react-app-env.d.ts"> # </a></h4>
<p>src\react-app-env.d.ts</p>
<pre><code class="lang-js"><span class="hljs-comment">/// &lt;reference types="react-scripts" /&gt;</span>
</code></pre>
<h4 id="t487.2.2 src\setupTests.ts">7.2.2 src\setupTests.ts <a href="#t487.2.2 src\setupTests.ts"> # </a></h4>
<p>src\setupTests.ts</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> <span class="hljs-string">'@testing-library/jest-dom/extend-expect'</span>;
<span class="hljs-keyword">import</span> Enzyme <span class="hljs-keyword">from</span> <span class="hljs-string">'enzyme'</span>;
<span class="hljs-keyword">import</span> Adaptor <span class="hljs-keyword">from</span> <span class="hljs-string">'enzyme-adapter-react-16'</span>;
Enzyme.configure({ <span class="hljs-attr">adapter</span>: <span class="hljs-keyword">new</span> Adaptor() });
</code></pre>
<h4 id="t497.2.3 tsconfig.json">7.2.3 tsconfig.json <a href="#t497.2.3 tsconfig.json"> # </a></h4>
<p>tsconfig.json</p>
<pre><code class="lang-diff">{
  "compilerOptions": {
    "jsx": "react",
<span class="hljs-addition">+    "noImplicitAny": false</span>
  }
}
</code></pre>
<h3 id="t507.3 开发功能">7.3 开发功能 <a href="#t507.3 开发功能"> # </a></h3>
<h4 id="t517.3.1 index.tsx">7.3.1 index.tsx <a href="#t517.3.1 index.tsx"> # </a></h4>
<p>src\index.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;
<span class="hljs-keyword">import</span> App <span class="hljs-keyword">from</span> <span class="hljs-string">'./containers/App'</span>;
ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>
    , <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'root'</span>));
</code></pre>
<h4 id="t527.3.2 containers\App.tsx">7.3.2 containers\App.tsx <a href="#t527.3.2 containers\App.tsx"> # </a></h4>
<p>src\containers\App.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> Counter1 <span class="hljs-keyword">from</span> <span class="hljs-string">'../components/Counter1'</span>;
<span class="hljs-keyword">import</span> Counter2 <span class="hljs-keyword">from</span> <span class="hljs-string">'../components/Counter2'</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'../store'</span>;
<span class="hljs-keyword">import</span> { Provider } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span>;
<span class="hljs-keyword">import</span> { BrowserRouter <span class="hljs-keyword">as</span> Router, Route, Link } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> Header <span class="hljs-keyword">from</span> <span class="hljs-string">'../components/Header'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">props</span>) </span>{
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">{store}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/counter1"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Counter1}</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/counter2"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Counter2}</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span>
    )
}
</code></pre>
<h4 id="t537.3.3 components\Counter1.tsx">7.3.3 components\Counter1.tsx <a href="#t537.3.3 components\Counter1.tsx"> # </a></h4>
<p>src\components\Counter1.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> actions <span class="hljs-keyword">from</span> <span class="hljs-string">'../store/actions/counter1'</span>;
<span class="hljs-keyword">import</span> { connect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span>&lt;<span class="hljs-title">any</span>&gt; </span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Counter1:{this.props.number}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"counter1-increment"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.props.increment1}</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"counter1-decrement"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.props.decrement1}</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}

<span class="hljs-keyword">let</span> mapStateToProps = <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.counter1
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> connect(
    mapStateToProps,
    actions
)(Counter1)
</code></pre>
<h4 id="t547.3.4 components\Counter2.tsx">7.3.4 components\Counter2.tsx <a href="#t547.3.4 components\Counter2.tsx"> # </a></h4>
<p>src\components\Counter2.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> actions <span class="hljs-keyword">from</span> <span class="hljs-string">'../store/actions/counter2'</span>;
<span class="hljs-keyword">import</span> { connect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span>&lt;<span class="hljs-title">any</span>&gt; </span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Counter2:{this.props.number}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"counter2-increment"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.props.increment2}</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"counter2-decrement"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.props.decrement2}</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}

<span class="hljs-keyword">let</span> mapStateToProps = <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.counter2
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> connect(
    mapStateToProps,
    actions
)(Counter2)
</code></pre>
<h4 id="t557.3.5 components\Header.tsx">7.3.5 components\Header.tsx <a href="#t557.3.5 components\Header.tsx"> # </a></h4>
<p>src\components\Header.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { withRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Header</span>(<span class="hljs-params">props</span>) </span>{
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"counter1"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> props.history.push('/counter1')}&gt;counter1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"counter2"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> props.history.push('/counter2')}&gt;counter2<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
    )
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> withRouter(Header);
</code></pre>
<h4 id="t567.3.6 store\index.tsx">7.3.6 store\index.tsx <a href="#t567.3.6 store\index.tsx"> # </a></h4>
<p>src\store\index.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> { createStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span>;
<span class="hljs-keyword">import</span> combinedReducer <span class="hljs-keyword">from</span> <span class="hljs-string">'./reducers'</span>;
<span class="hljs-keyword">const</span> store = createStore(combinedReducer);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store;
</code></pre>
<h4 id="t577.3.7 store\action-types.tsx">7.3.7 store\action-types.tsx <a href="#t577.3.7 store\action-types.tsx"> # </a></h4>
<p>src\store\action-types.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> INCREMENT1 = <span class="hljs-string">'INCREMENT1'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> DECREMENT1 = <span class="hljs-string">'DECREMENT1'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> INCREMENT2 = <span class="hljs-string">'INCREMENT2'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> DECREMENT2 = <span class="hljs-string">'DECREMENT2'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> RESET = <span class="hljs-string">'RESET'</span>;
</code></pre>
<h4 id="t587.3.8 store\reducers\index.tsx">7.3.8 store\reducers\index.tsx <a href="#t587.3.8 store\reducers\index.tsx"> # </a></h4>
<p>src\store\reducers\index.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> counter1 <span class="hljs-keyword">from</span> <span class="hljs-string">'./counter1'</span>;
<span class="hljs-keyword">import</span> counter2 <span class="hljs-keyword">from</span> <span class="hljs-string">'./counter2'</span>;
<span class="hljs-keyword">import</span> { combineReducers } <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span>;
<span class="hljs-keyword">let</span> reducers = {
    counter1,
    counter2
}
<span class="hljs-keyword">let</span> combinedReducer = combineReducers(reducers);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> combinedReducer;
</code></pre>
<h4 id="t597.3.9 store\reducers\counter1.tsx">7.3.9 store\reducers\counter1.tsx <a href="#t597.3.9 store\reducers\counter1.tsx"> # </a></h4>
<p>src\store\reducers\counter1.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> types <span class="hljs-keyword">from</span> <span class="hljs-string">'../action-types'</span>;
<span class="hljs-keyword">let</span> initialState = { <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> }
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">state = initialState, action</span>) </span>{
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> types.INCREMENT1:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">number</span>: state.number + <span class="hljs-number">1</span> };
        <span class="hljs-keyword">case</span> types.DECREMENT1:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">number</span>: state.number - <span class="hljs-number">1</span> };
        <span class="hljs-keyword">case</span> types.RESET:
            <span class="hljs-keyword">return</span> initialState;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> state;
    }
}
</code></pre>
<h4 id="t607.3.10 store\reducers\counter2.tsx">7.3.10 store\reducers\counter2.tsx <a href="#t607.3.10 store\reducers\counter2.tsx"> # </a></h4>
<p>src\store\reducers\counter2.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> types <span class="hljs-keyword">from</span> <span class="hljs-string">'../action-types'</span>;
<span class="hljs-keyword">let</span> initialState = { <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> }
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">state = initialState, action</span>) </span>{
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> types.INCREMENT2:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">number</span>: state.number + <span class="hljs-number">1</span> };
        <span class="hljs-keyword">case</span> types.DECREMENT2:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">number</span>: state.number - <span class="hljs-number">1</span> };
        <span class="hljs-keyword">case</span> types.RESET:
            <span class="hljs-keyword">return</span> initialState;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> state;
    }
}
</code></pre>
<h4 id="t617.3.11 store\actions\counter1.tsx">7.3.11 store\actions\counter1.tsx <a href="#t617.3.11 store\actions\counter1.tsx"> # </a></h4>
<p>src\store\actions\counter1.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> types <span class="hljs-keyword">from</span> <span class="hljs-string">'../action-types'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    increment1() {
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">type</span>: types.INCREMENT1 };
    },
    decrement1() {
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">type</span>: types.DECREMENT1 };
    }
}
</code></pre>
<h4 id="t627.3.12 store\actions\counter2.tsx">7.3.12 store\actions\counter2.tsx <a href="#t627.3.12 store\actions\counter2.tsx"> # </a></h4>
<p>src\store\actions\counter2.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> types <span class="hljs-keyword">from</span> <span class="hljs-string">'../action-types'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    increment2() {
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">type</span>: types.INCREMENT2 };
    },
    decrement2() {
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">type</span>: types.DECREMENT2 };
    }
}
</code></pre>
<h4 id="t637.3.13 index.html">7.3.13 index.html <a href="#t637.3.13 index.html"> # </a></h4>
<pre><code class="lang-diff">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
  &lt;meta charset="utf-8" /&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;
  &lt;meta name="theme-color" content="#000000" /&gt;
<span class="hljs-addition">+  &lt;title&gt;CounterApp&lt;/title&gt;</span>
&lt;/head&gt;

&lt;body&gt;
  &lt;div id="root"&gt;&lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre>
<h3 id="t647.4 编写测试用例">7.4 编写测试用例 <a href="#t647.4 编写测试用例"> # </a></h3>
<h4 id="t657.4.1 reducers\counter1.spec.tsx">7.4.1 reducers\counter1.spec.tsx <a href="#t657.4.1 reducers\counter1.spec.tsx"> # </a></h4>
<p>src\store\reducers\counter1.spec.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> counter1 <span class="hljs-keyword">from</span> <span class="hljs-string">'./counter1'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> types <span class="hljs-keyword">from</span> <span class="hljs-string">'../action-types'</span>;

describe(<span class="hljs-string">'测试counter1'</span>, () =&gt; {
    it(<span class="hljs-string">'counter1存在'</span>, () =&gt; {
        expect(counter1).toBeTruthy();
    })

    it(<span class="hljs-string">'获取默认值'</span>, () =&gt; {
        expect(counter1(<span class="hljs-literal">undefined</span>, { <span class="hljs-attr">type</span>: <span class="hljs-string">'@@REDUX/INIT'</span> })).toEqual({ <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> });
    })

    it(<span class="hljs-string">'INCREMENT1可以让number加1'</span>, () =&gt; {
        expect(counter1({ <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> }, { <span class="hljs-attr">type</span>: types.INCREMENT1 })).toEqual({ <span class="hljs-attr">number</span>: <span class="hljs-number">1</span> });
    })
    it(<span class="hljs-string">'DECREMENT1可以让number加1'</span>, () =&gt; {
        expect(counter1({ <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> }, { <span class="hljs-attr">type</span>: types.DECREMENT1 })).toEqual({ <span class="hljs-attr">number</span>: <span class="hljs-number">-1</span> });
    })
})
</code></pre>
<h4 id="t667.4.2 actions\counter1.spec.tsx">7.4.2 actions\counter1.spec.tsx <a href="#t667.4.2 actions\counter1.spec.tsx"> # </a></h4>
<p>src\store\actions\counter1.spec.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> actions <span class="hljs-keyword">from</span> <span class="hljs-string">'./counter1'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> types <span class="hljs-keyword">from</span> <span class="hljs-string">'../action-types'</span>;
describe(<span class="hljs-string">'测试counter1'</span>, () =&gt; {
    it(<span class="hljs-string">'counter1存在'</span>, () =&gt; {
        expect(actions.increment1).toBeTruthy();
    })
    it(<span class="hljs-string">'counter1返回值是{ type: types.INCREMENT1 }'</span>, () =&gt; {
        <span class="hljs-keyword">let</span> mockCounter1 = jest.fn(actions.increment1);
        mockCounter1();
        expect(mockCounter1).toHaveReturnedWith({ <span class="hljs-attr">type</span>: types.INCREMENT1 });
    })
})
</code></pre>
<h4 id="t677.4.3 store\store.spec.ts">7.4.3 store\store.spec.ts <a href="#t677.4.3 store\store.spec.ts"> # </a></h4>
<p>src\store\store.spec.ts</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'./'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> types <span class="hljs-keyword">from</span> <span class="hljs-string">'./action-types'</span>;
describe(<span class="hljs-string">'测试store'</span>, () =&gt; {
    beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        store.dispatch({ <span class="hljs-attr">type</span>: types.RESET });
    });
    it(<span class="hljs-string">'store存在'</span>, () =&gt; {
        expect(store).toBeTruthy();
    })
    it(<span class="hljs-string">'store应该有默认的状态'</span>, () =&gt; {
        expect(store.getState()).toMatchObject({
            <span class="hljs-attr">counter1</span>: { <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> },
            <span class="hljs-attr">counter2</span>: { <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> }
        });
    })
    it(<span class="hljs-string">'派发INCREMENT1动作后后仓库counter1状态应该变为{ number: 1 }'</span>, () =&gt; {
        store.dispatch({ <span class="hljs-attr">type</span>: types.INCREMENT1 });
        expect(store.getState()).toMatchObject({
            <span class="hljs-attr">counter1</span>: { <span class="hljs-attr">number</span>: <span class="hljs-number">1</span> },
            <span class="hljs-attr">counter2</span>: { <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> }
        });
    })
    it(<span class="hljs-string">'派发DECREMENT1动作后后仓库counter1状态应该变为{ number: -1 }'</span>, () =&gt; {
        store.dispatch({ <span class="hljs-attr">type</span>: types.DECREMENT1 });
        expect(store.getState()).toMatchObject({
            <span class="hljs-attr">counter1</span>: { <span class="hljs-attr">number</span>: <span class="hljs-number">-1</span> },
            <span class="hljs-attr">counter2</span>: { <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> }
        });
    })
})
</code></pre>
<h4 id="t687.4.4 tests\containers\Counter1.tsx">7.4.4 tests\containers\Counter1.tsx <a href="#t687.4.4 tests\containers\Counter1.tsx"> # </a></h4>
<p>src__tests__\containers\Counter1.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> Counter1 <span class="hljs-keyword">from</span> <span class="hljs-string">'../../components/Counter1'</span>;
<span class="hljs-keyword">import</span> { shallow, mount, render } <span class="hljs-keyword">from</span> <span class="hljs-string">'enzyme'</span>;
<span class="hljs-keyword">import</span> { Link } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'../../store'</span>;
<span class="hljs-keyword">import</span> { Provider } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span>;
describe(<span class="hljs-string">'测试Counter1'</span>, () =&gt; {
    test(<span class="hljs-string">`我想要显示一个数字，点+变成1，再点-变成0`</span>, () =&gt; {
        <span class="hljs-keyword">let</span> wrapper = mount(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">{store}</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">Counter1</span> /&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span> &gt;</span>);
        let p = wrapper.find('p');
        expect(p).toHaveLength(1);
        expect(p.text()).toContain('0');

        let button = wrapper.find('button');
        expect(button).toHaveLength(2);

        button.at(0).simulate('click');
        p = wrapper.find('p');
        expect(p.text()).toContain('1');

        button.at(1).simulate('click');
        p = wrapper.find('p');
        expect(p.text()).toContain('0');
    });
});
</span></code></pre>
<h4 id="t697.4.5 tests\containers\App.tsx">7.4.5 tests\containers\App.tsx <a href="#t697.4.5 tests\containers\App.tsx"> # </a></h4>
<p>src__tests__\containers\App.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> App <span class="hljs-keyword">from</span> <span class="hljs-string">'../../containers/App'</span>;
<span class="hljs-keyword">import</span> { shallow, mount, render } <span class="hljs-keyword">from</span> <span class="hljs-string">'enzyme'</span>;
<span class="hljs-keyword">import</span> { Link } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
describe(<span class="hljs-string">'测试App'</span>, () =&gt; {
    test(<span class="hljs-string">`测试App`</span>, () =&gt; {
        <span class="hljs-keyword">let</span> wrapper = mount(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> <span class="hljs-attr">history</span>=<span class="hljs-string">{history}</span> /&gt;</span></span>);
        <span class="hljs-keyword">let</span> p = wrapper.find(<span class="hljs-string">'p'</span>);
        expect(p).toHaveLength(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">let</span> button = wrapper.find(<span class="hljs-string">'button'</span>);
        button.at(<span class="hljs-number">0</span>).simulate(<span class="hljs-string">'click'</span>);
        p = wrapper.find(<span class="hljs-string">'p'</span>);
        expect(p.text()).toContain(<span class="hljs-string">'Counter1'</span>);
        button.at(<span class="hljs-number">1</span>).simulate(<span class="hljs-string">'click'</span>);
        p = wrapper.find(<span class="hljs-string">'p'</span>);
        expect(p.text()).toContain(<span class="hljs-string">'Counter2'</span>);
    });
});
</code></pre>
<h2 id="t708. UI测试">8. UI测试 <a href="#t708. UI测试"> # </a></h2>
<ul>
<li>用puppeteer做集成测试的时候测试用例是真正在真实的浏览器上执行的</li>
</ul>
<h3 id="t718.1 puppeteer">8.1 puppeteer <a href="#t718.1 puppeteer"> # </a></h3>
<ul>
<li>使用puppeteer控制chromium</li>
<li>puppeteer是Chrome团队开发的一个node库</li>
<li>可以通过api来控制浏览器的行为，比如点击，跳转，刷新，在控制台执行js脚本等等</li>
<li>通过这个工具可以用来写爬虫，自动签到，网页截图，生成pdf，自动化测试等</li>
</ul>
<pre><code class="lang-js">cnpm install --save-dev jest-puppeteer puppeteer jest
</code></pre>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'puppeteer'</span>);
<span class="hljs-keyword">const</span> delay = <span class="hljs-function">(<span class="hljs-params">ms</span>) =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve</span>) </span>{
    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        resolve();
    }, ms);
});
<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.launch({ <span class="hljs-attr">headless</span>: <span class="hljs-literal">false</span> });
    <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> browser.newPage();
    <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">'http://localhost:3000'</span>);
    <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'button[id="counter1"]'</span>);
    <span class="hljs-keyword">await</span> delay(<span class="hljs-number">1000</span>);
    <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'button[id="counter1-increment"]'</span>);
    <span class="hljs-keyword">await</span> delay(<span class="hljs-number">1000</span>);
    <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'button[id="counter2"]'</span>);
    <span class="hljs-keyword">await</span> delay(<span class="hljs-number">1000</span>);
    <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'button[id="counter2-decrement"]'</span>);
    <span class="hljs-keyword">await</span> browser.close();
})();
</code></pre>
<h3 id="t728.2 jest-puppeteer">8.2 jest-puppeteer <a href="#t728.2 jest-puppeteer"> # </a></h3>
<ul>
<li><a href="https://github.com/smooth-code/jest-puppeteer">jest-puppeteer</a></li>
<li>切记删除<code>testEnvironment</code>配置</li>
</ul>
<h4 id="t738.2.1 jest.config.js">8.2.1 jest.config.js <a href="#t738.2.1 jest.config.js"> # </a></h4>
<pre><code class="lang-diff">{
<span class="hljs-addition">+  "preset": "jest-puppeteer"</span>
}
</code></pre>
<h4 id="t748.2.2 CounterApp.ts">8.2.2 CounterApp.ts <a href="#t748.2.2 CounterApp.ts"> # </a></h4>
<pre><code class="lang-js">declare <span class="hljs-keyword">var</span> beforeAll;
declare <span class="hljs-keyword">var</span> page;
describe(<span class="hljs-string">'测试CounterApp'</span>, () =&gt; {
    beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">'http://localhost:3000/'</span>);
    });

    it(<span class="hljs-string">'标题是CounterApp'</span>, <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">await</span> expect(page.title()).resolves.toMatch(<span class="hljs-string">'CounterApp'</span>);
    });

    it(<span class="hljs-string">'点击第一个button会跳转到/counter1'</span>, <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'button[id="counter1"]'</span>);
        <span class="hljs-keyword">let</span> text = <span class="hljs-keyword">await</span> page.$<span class="hljs-built_in">eval</span>(<span class="hljs-string">'p'</span>, el =&gt; el.innerText);
        expect(text).toBe(<span class="hljs-string">'Counter1:0'</span>);
        <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'button[id="counter2"]'</span>);
        text = <span class="hljs-keyword">await</span> page.$<span class="hljs-built_in">eval</span>(<span class="hljs-string">'p'</span>, el =&gt; el.innerText);
        expect(text).toBe(<span class="hljs-string">'Counter2:0'</span>);
    });
});
</code></pre>
<h2 id="t759.参考">9.参考 <a href="#t759.参考"> # </a></h2>
<h3 id="t769.1 jest">9.1 jest <a href="#t769.1 jest"> # </a></h3>
<ul>
<li><a href="https://jestjs.io/docs/zh-Hans/using-matchers">jest matchers</a></li>
<li><a href="https://jestjs.io/docs/zh-Hans/expect#expectanything">jest断言</a></li>
<li><a href="https://jestjs.io/docs/zh-Hans/asynchronous">jest异步</a></li>
</ul>
<h3 id="t779.2 enzyme">9.2 enzyme <a href="#t779.2 enzyme"> # </a></h3>
<ul>
<li><a href="https://airbnb.io/enzyme">enzyme</a></li>
<li><a href="https://airbnb.io/enzyme/docs/api/shallow.html">shallow</a></li>
<li><a href="https://airbnb.io/enzyme/docs/api/mount.html">mount</a></li>
<li><a href="http://npm.taobao.org/package/expect-enzyme">expect-enzyme</a></li>
<li><a href="https://airbnb.io/enzyme/docs/api/selector.html">selector</a></li>
</ul>
<h3 id="t789.3 puppeteer">9.3 puppeteer <a href="#t789.3 puppeteer"> # </a></h3>
<ul>
<li><a href="https://github.com/puppeteer/puppeteer/blob/master/docs/api.md">puppeteer api</a></li>
<li><a href="https://github.com/smooth-code/jest-puppeteer">jest-puppeteer</a></li>
<li><a href="https://github.com/smooth-code/jest-puppeteer/blob/master/packages/expect-puppeteer/README.md#api">expect-puppeteer</a></li>
<li><a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#/">puppeteer-api-zh_CN</a></li>
</ul>
<h3 id="t799.4 glob">9.4 glob <a href="#t799.4 glob"> # </a></h3>
<ul>
<li><code>glob</code>返回匹配指定模式的文件名或目录<h4 id="t809.4.1 glob规则">9.4.1 glob规则 <a href="#t809.4.1 glob规则"> # </a></h4>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">匹配符</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">星</td>
<td style="text-align:left">匹配文件路径中的0个或多个字符，但不会匹配路径分隔符</td>
</tr>
<tr>
<td style="text-align:left">**</td>
<td style="text-align:left">匹配路径中的0个或多个目录及其子目录</td>
</tr>
<tr>
<td style="text-align:left">[...]</td>
<td style="text-align:left">匹配方括号中出现的字符中的任意一个，当方括号中第一个字符为^或!时，则表示不匹配方括号中出现的其他字符中的任意一个</td>
</tr>
<tr>
<td style="text-align:left">!(pattern pattern pattern)</td>
<td style="text-align:left">匹配任何与括号中给定的任一模式都不匹配的</td>
</tr>
<tr>
<td style="text-align:left">?(pattern pattern pattern)</td>
<td style="text-align:left">匹配括号中给定的任一模式0次或1次，类似于js正则中的?</td>
</tr>
<tr>
<td style="text-align:left">+(pattern pattern pattern)</td>
<td style="text-align:left">匹配括号中给定的任一模式至少1次，类似于js正则中的+</td>
</tr>
<tr>
<td style="text-align:left">(pattern pattern pattern)</td>
<td style="text-align:left">匹配括号中给定的任一模式0次或多次，类似于js正则中的 *</td>
</tr>
<tr>
<td style="text-align:left">@(pattern pattern pattern)</td>
<td style="text-align:left">匹配括号中给定的任一模式1次，类似于js正则中的</td>
</tr>
</tbody>
</table>
<h4 id="t819.4.2 glob示例">9.4.2 glob示例 <a href="#t819.4.2 glob示例"> # </a></h4>
<table>
<thead>
<tr>
<th style="text-align:left">glob</th>
<th style="text-align:left">匹配</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">*</td>
<td style="text-align:left">能匹配 a.js,x.y,abc,abc/,但不能匹配a/b.js</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"><em>.</em></td>
<td style="text-align:left">a.js,style.css,a.b,x.y</td>
</tr>
<tr>
<td style="text-align:left"><em>/</em>/*.js</td>
<td style="text-align:left">能匹配 a/b/c.js,x/y/z.js,不能匹配a/b.js,a/b/c/d.js</td>
</tr>
<tr>
<td style="text-align:left">**</td>
<td style="text-align:left">能匹配 abc,a/b.js,a/b/c.js,x/y/z,x/y/z/a.b,能用来匹配所有的目录和文件</td>
</tr>
<tr>
<td style="text-align:left">a/**/z</td>
<td style="text-align:left">能匹配 a/z,a/b/z,a/b/c/z,a/d/g/h/j/k/z</td>
</tr>
<tr>
<td style="text-align:left">a/**b/z</td>
<td style="text-align:left">能匹配 a/b/z,a/sb/z,但不能匹配a/x/sb/z,因为只有单**单独出现才能匹配多级目录</td>
</tr>
<tr>
<td style="text-align:left">?.js</td>
<td style="text-align:left">能匹配 a.js,b.js,c.js</td>
</tr>
<tr>
<td style="text-align:left">a??</td>
<td style="text-align:left">能匹配 a.b,abc,但不能匹配ab/,因为它不会匹配路径分隔符</td>
</tr>
<tr>
<td style="text-align:left">[xyz].js</td>
<td style="text-align:left">只能匹配 x.js,y.js,z.js,不会匹配xy.js,xyz.js等,整个中括号只代表一个字符</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">[^xyz].js</td>
<td style="text-align:left">能匹配 a.js,b.js,c.js等,不能匹配x.js,y.js,z.js</td>
</tr>
</tbody>
</table>

    