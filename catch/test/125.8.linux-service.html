
        <h2 id="t01.服务简介和分类">1.服务简介和分类 <a href="#t01.服务简介和分类"> # </a></h2>
<h3 id="t11.1 运行级别">1.1 运行级别 <a href="#t11.1 运行级别"> # </a></h3>
<h4 id="t21.1.1 运行级别分类">1.1.1 运行级别分类 <a href="#t21.1.1 运行级别分类"> # </a></h4>
<table>
<thead>
<tr>
<th style="text-align:left">运行级别</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">关机</td>
</tr>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">单用户,类似于Window的安全模式，主要用于系统修复</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">不完全多用户，类似于字符界面，但不包含NFS(Linux和Window进行文件共享)服务</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">完整的命令行模式，就是标准的字符界面</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">系统保留未使用</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">图形界面</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left">重启</td>
</tr>
</tbody>
</table>
<h4 id="t31.1.2  查看上一个级别和当前级别">1.1.2  查看上一个级别和当前级别 <a href="#t31.1.2  查看上一个级别和当前级别"> # </a></h4>
<pre><code class="lang-js">runlevel 
N <span class="hljs-number">3</span>
</code></pre>
<h4 id="t41.1.3 切换运行级别">1.1.3 切换运行级别 <a href="#t41.1.3 切换运行级别"> # </a></h4>
<pre><code class="lang-js">init <span class="hljs-number">5</span>
</code></pre>
<h4 id="t51.1.4 设置默认运行级别">1.1.4 设置默认运行级别 <a href="#t51.1.4 设置默认运行级别"> # </a></h4>
<pre><code class="lang-js">vi /etc/inittab
<span class="hljs-attr">id</span>:<span class="hljs-number">3</span>:initdefault:
</code></pre>
<h3 id="t61.2 服务的分类">1.2 服务的分类 <a href="#t61.2 服务的分类"> # </a></h3>
<ul>
<li>系统开启的服务越少，服务器就会更加稳定和安全</li>
<li>服务安装方式不同，启动的方式也不同</li>
</ul>
<h4 id="t71.2.1 服务管理的方式">1.2.1 服务管理的方式 <a href="#t71.2.1 服务管理的方式"> # </a></h4>
<ul>
<li><code>RPM包</code>安装的服务,由软件包作者指定安装位置,独立的服务，绝大多数服务都是独立运行在内存中的，可以直接响应客户端的请求</li>
<li><code>源码包</code>安装的服务，由我们用户决定安装位置</li>
</ul>
<h4 id="t81.2.2 查看RPM包安装的服务">1.2.2 查看RPM包安装的服务 <a href="#t81.2.2 查看RPM包安装的服务"> # </a></h4>
<pre><code class="lang-js">chkconfig --list
</code></pre>
<h4 id="t91.2.3 查看源码包安装的服务">1.2.3 查看源码包安装的服务 <a href="#t91.2.3 查看源码包安装的服务"> # </a></h4>
<ul>
<li>查看自定义的安装位置，默认为<code>/usr/local</code>下</li>
<li>usr= Unix System Resource 系统资源</li>
</ul>
<h4 id="t101.2.4 启动和自启动">1.2.4 启动和自启动 <a href="#t101.2.4 启动和自启动"> # </a></h4>
<ul>
<li>启动服务就是指让此服务在当前系统中运行，并向客户端提供服务</li>
<li>服务自启动就是指通过设置，让此服务在开机或者重启后随着系统启动而自动启动</li>
</ul>
<h3 id="t111.3 服务与端口">1.3 服务与端口 <a href="#t111.3 服务与端口"> # </a></h3>
<p>查看系统中的运行中的进程</p>
<pre><code class="lang-js">ps -aux
</code></pre>
<p>查看常见服务端口</p>
<pre><code class="lang-js">cat /etc/services
</code></pre>
<h3 id="t121.4 查询系统中监听的端口">1.4 查询系统中监听的端口 <a href="#t121.4 查询系统中监听的端口"> # </a></h3>
<ul>
<li>netstat -tulnp</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-t</td>
<td style="text-align:left">列出tcp数据</td>
</tr>
<tr>
<td style="text-align:left">-u</td>
<td style="text-align:left">列出udp数据</td>
</tr>
<tr>
<td style="text-align:left">-l</td>
<td style="text-align:left">列出正在监听的网络服务</td>
</tr>
<tr>
<td style="text-align:left">-n</td>
<td style="text-align:left">用端口号来显示服务，而非服务名</td>
</tr>
<tr>
<td style="text-align:left">-p</td>
<td style="text-align:left">列出该服务的进程ID</td>
</tr>
</tbody>
</table>
<h2 id="t132. PRM包服务管理">2. PRM包服务管理 <a href="#t132. PRM包服务管理"> # </a></h2>
<ul>
<li>RMP 是 LINUX 下的一种软件的可执行程序，你只要安装它就可以了。这种软件安装包通常是一个RPM包（Redhat Linux Packet Manager，就是Redhat的包管理器），后缀是.rpm</li>
<li>RPM是Red Hat公司随Redhat Linux推出了一个软件包管理器，通过它能够更加轻松容易地实现软件的安装</li>
</ul>
<h3 id="t142.1 rpm命令">2.1 rpm命令 <a href="#t142.1 rpm命令"> # </a></h3>
<table>
<thead>
<tr>
<th style="text-align:left">用途</th>
<th style="text-align:left">命令</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">安装软件</td>
<td style="text-align:left">执行<code>rpm -ivh rpm</code>包名</td>
<td>其中<code>i</code>表示安装install，<code>v</code>表示显示安装过程verbose，<code>h</code>表示显示进度</td>
</tr>
<tr>
<td style="text-align:left">升级软件</td>
<td style="text-align:left">执行<code>rpm -Uvh rpm</code>包名</td>
<td>U表示升级update</td>
</tr>
<tr>
<td style="text-align:left">反安装</td>
<td style="text-align:left">执行<code>rpm -e rpm</code>包名</td>
</tr>
<tr>
<td style="text-align:left">查询软件包的详细信息</td>
<td style="text-align:left">执行<code>rpm -qpi rpm</code>包名</td>
</tr>
<tr>
<td style="text-align:left">查询某个文件是属于那个rpm包的</td>
<td style="text-align:left">执行<code>rpm -qf rpm</code>包名</td>
</tr>
<tr>
<td style="text-align:left">查该软件包会向系统里面写入哪些文件</td>
<td style="text-align:left">执行 <code>rpm -qpl rpm</code>包名</td>
</tr>
</tbody>
</table>
<h3 id="t152.2 repo">2.2 repo <a href="#t152.2 repo"> # </a></h3>
<ul>
<li>repo文件是yum源（软件仓库）的配置文件，通常一个repo文件定义了一个或者多个软件仓库的细节内容，例如我们将从哪里下载需要安装或者升级的软件包，repo文件中的设置内容将被yum读取和应用</li>
<li>服务器端：在服务器上面存放了所有的RPM软件包，然后以相关的功能去分析每个RPM文件的依赖性关系，将这些数据记录成文件存放在服务器的某特定目录内。</li>
<li>客户端：如果需要安装某个软件时，先下载服务器上面记录的依赖性关系文件(可通过WWW或FTP方式)，通过对服务器端下载的纪录数据进行分析，然后取得所有相关的软件，一次全部下载下来进行安装。</li>
</ul>
<pre><code class="lang-js">cat /etc/yum.conf
/etc/yum.repos.d
/etc/yum.repos.d/nginx.repo
</code></pre>
<h3 id="t162.3 RPM包的默认安装位置">2.3 RPM包的默认安装位置 <a href="#t162.3 RPM包的默认安装位置"> # </a></h3>
<table>
<thead>
<tr>
<th style="text-align:left">文件</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">/etc</td>
<td style="text-align:left">配置文件位置</td>
</tr>
<tr>
<td style="text-align:left">/etc/init.d</td>
<td style="text-align:left">启动脚本位置</td>
</tr>
<tr>
<td style="text-align:left">/etc/sysconfig</td>
<td style="text-align:left">初始化环境配置文件位置</td>
</tr>
<tr>
<td style="text-align:left">/var/lib</td>
<td style="text-align:left">服务产生的数据放在这里</td>
</tr>
<tr>
<td style="text-align:left">/var/log</td>
<td style="text-align:left">日志</td>
</tr>
</tbody>
</table>
<h3 id="t172.4 启动命令">2.4 启动命令 <a href="#t172.4 启动命令"> # </a></h3>
<ul>
<li>systemd是Linux系统最新的初始化系统(init),作用是提高系统的启动速度，尽可能启动较少的进程，尽可能更多进程并发启动</li>
<li>systemd对应的进程管理命令是<code>systemctl</code></li>
</ul>
<pre><code class="lang-js">rpm -ivh http:<span class="hljs-comment">//nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm</span>
yum info nginx
yum install -y nginx 
systemctl start nginx.service
netstat -ltun | grep <span class="hljs-number">80</span>
curl http:<span class="hljs-comment">//localhost</span>
</code></pre>
<h2 id="t182. 源码包服务管理">2. 源码包服务管理 <a href="#t182. 源码包服务管理"> # </a></h2>
<ul>
<li>使用绝对路径，调用启动脚本来启动。</li>
<li>不同的源码包的启动脚本不一样</li>
<li>要通过阅读源码包安装说明的方式来查看启动的方法</li>
</ul>
<h3 id="t192.1 安装nginx">2.1 安装nginx <a href="#t192.1 安装nginx"> # </a></h3>
<h4 id="t202.1.1 安装依赖">2.1.1 安装依赖 <a href="#t202.1.1 安装依赖"> # </a></h4>
<pre><code class="lang-js">yum install gcc gcc-c++ perl -y
</code></pre>
<h4 id="t212.1.2 下载源文件">2.1.2 下载源文件 <a href="#t212.1.2 下载源文件"> # </a></h4>
<h5 id="t222.1.2.1  PCRE">2.1.2.1  PCRE <a href="#t222.1.2.1  PCRE"> # </a></h5>
<ul>
<li><a href="http://www.pcre.org/">官网</a></li>
<li><a href="ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/">FTP下载</a></li>
<li><a href="http://sourceforge.net/projects/pcre/files/pcre/">HTTP下载</a></li>
</ul>
<pre><code class="lang-js">wget https:<span class="hljs-comment">//img.zhufengpeixun.com/pcre-8.44.tar.gz</span>
</code></pre>
<h5 id="t232.1.2.2 zlib">2.1.2.2 zlib <a href="#t232.1.2.2 zlib"> # </a></h5>
<ul>
<li><a href="http://www.zlib.net/">官网</a></li>
<li><a href="http://prdownloads.sourceforge.net/libpng/zlib-1.2.11.tar.gz">HTTP下载</a></li>
</ul>
<pre><code class="lang-js">wget https:<span class="hljs-comment">//img.zhufengpeixun.com/zlib-1.2.11.tar.gz</span>
</code></pre>
<h5 id="t242.1.2.3 openssl">2.1.2.3 openssl <a href="#t242.1.2.3 openssl"> # </a></h5>
<ul>
<li><a href="https://www.openssl.org/">官网</a></li>
</ul>
<pre><code class="lang-js">wget https:<span class="hljs-comment">//img.zhufengpeixun.com/openssl-1.0.2n.tar.gz</span>
</code></pre>
<h5 id="t252.1.2.4 nginx">2.1.2.4 nginx <a href="#t252.1.2.4 nginx"> # </a></h5>
<ul>
<li><a href="http://nginx.org/en/docs/configure.html">官网</a></li>
</ul>
<pre><code class="lang-js">wget https:<span class="hljs-comment">//img.zhufengpeixun.com/nginx-1.10.1.tar.gz</span>
</code></pre>
<h4 id="t262.1.3 解压文件">2.1.3 解压文件 <a href="#t262.1.3 解压文件"> # </a></h4>
<pre><code class="lang-js">mkdir /root/nginxinstall
cd  /root/nginxinstall
tar -zxvf nginx<span class="hljs-number">-1.10</span><span class="hljs-number">.1</span>.tar.gz
tar -zxvf openssl<span class="hljs-number">-1.0</span><span class="hljs-number">.2</span>h.tar.gz
tar -zxvf pcre<span class="hljs-number">-8.44</span>.tar.gz
tar -zxvf zlib<span class="hljs-number">-1.2</span><span class="hljs-number">.11</span>.tar.gz
</code></pre>
<h4 id="t272.1.3 配置和安装">2.1.3 配置和安装 <a href="#t272.1.3 配置和安装"> # </a></h4>
<pre><code class="lang-js">cd nginx-1.10.1
./configure --prefix=/usr/local/nginx \
--pid-path=/usr/local/nginx/nginx.pid \
--error-log-path=/usr/local/nginx/error.log \
--http-log-path=/usr/local/nginx/access.log \
--with-http_ssl_module \
--with-mail --with-mail_ssl_module \
--with-stream --with-threads \
--user=comex --group=comexgroup \
--with-pcre=/root/nginxinstall/pcre-8.44 \
--with-zlib=/root/nginxinstall/zlib-1.2.11 \
--with-openssl=/root/nginxinstall/openssl-1.0.2n
make &amp;&amp; make install

/usr/local/nginx/sbin/nginx  -t
nginx: [emerg] getpwnam("comex") failed

useadd nginx # 添加nginx用户
vi /usr/local/nginx/conf/nginx.conf
user  nginx;
</code></pre>
<h4 id="t282.1.4 管理命令">2.1.4 管理命令 <a href="#t282.1.4 管理命令"> # </a></h4>
<table>
<thead>
<tr>
<th style="text-align:left">功能</th>
<th style="text-align:left">命令</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">启动</td>
<td style="text-align:left">/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</td>
</tr>
<tr>
<td style="text-align:left">从容停止</td>
<td style="text-align:left">ps -ef grep nginx;kill -QUIT 2072</td>
</tr>
<tr>
<td style="text-align:left">快速停止</td>
<td style="text-align:left">ps -ef grep nginx;kill -TERM 2132; kill -INT 2132</td>
</tr>
<tr>
<td style="text-align:left">强制停止</td>
<td style="text-align:left">pkill -9 nginx</td>
</tr>
<tr>
<td style="text-align:left">验证nginx配置文件是否正确</td>
<td style="text-align:left">nginx -t</td>
</tr>
<tr>
<td style="text-align:left">重启Nginx服务</td>
<td style="text-align:left">nginx -s reload</td>
</tr>
<tr>
<td style="text-align:left">查找当前nginx进程号</td>
<td style="text-align:left">kill -HUP 进程号</td>
</tr>
</tbody>
</table>
<h4 id="t292.1.5 以服务启动service">2.1.5 以服务启动service <a href="#t292.1.5 以服务启动service"> # </a></h4>
<ul>
<li>Nginx启动、关闭、重新加载脚本</li>
<li>创建文件  <code>etc/init.d/nginx</code></li>
</ul>
<pre><code class="lang-js">/etc/init.d/nginx start
</code></pre>
<pre><code class="lang-js"><span class="hljs-meta">#! /bin/bash</span>

NAME=nginx
DAEMON=<span class="hljs-regexp">/usr/</span>local/nginx/sbin/$NAME
CONFIGFILE=<span class="hljs-regexp">/usr/</span>local/nginx/conf/$NAME.conf
PIDFILE=<span class="hljs-regexp">/usr/</span>local/nginx/logs/$NAME.pid
SCRIPTNAME=<span class="hljs-regexp">/etc/i</span>nit.d/$NAME

<span class="hljs-keyword">set</span> -e
[ -x "$DAEMON" ] || exit 0

do_start() {
 $DAEMON -c $CONFIGFILE  || echo -n <span class="hljs-string">"nginx already running"</span>
 pid=$(ps -ef | grep nginx | grep master | awk <span class="hljs-string">'{print $2}'</span>)
 echo $pid &gt; <span class="hljs-string">"$PIDFILE"</span>
}

do_stop() {
 kill -INT <span class="hljs-string">`cat $PIDFILE`</span> || echo -n <span class="hljs-string">"nginx not running"</span>
}

do_reload() {
 kill -HUP <span class="hljs-string">`cat $PIDFILE`</span> || echo -n <span class="hljs-string">"nginx can't reload"</span>
}

<span class="hljs-keyword">case</span> <span class="hljs-string">"$1"</span> <span class="hljs-keyword">in</span>
 start)
 echo -n <span class="hljs-string">"Starting  $NAME"</span>
 do_start
 echo <span class="hljs-string">"."</span>
 ;;
 stop)
 echo -n <span class="hljs-string">"Stopping  $NAME"</span>
 do_stop
 echo <span class="hljs-string">"."</span>
 ;;
 reload|graceful)
 echo -n <span class="hljs-string">"Reloading  configuration"</span>
 do_reload
 echo <span class="hljs-string">"."</span>
 ;;
 restart)
 echo -n <span class="hljs-string">"Restarting  $NAME"</span>
 do_stop
 do_start
 echo <span class="hljs-string">"."</span>
 ;;
 *)
 echo <span class="hljs-string">"Usage: $SCRIPTNAME {start|stop|reload|restart}"</span> &gt;&amp;<span class="hljs-number">2</span>
 exit <span class="hljs-number">3</span>
 ;;
esac
exit <span class="hljs-number">0</span>
</code></pre>
<h4 id="t302.1.7 chkconfig">2.1.7 chkconfig <a href="#t302.1.7 chkconfig"> # </a></h4>
<ul>
<li>指定nginx脚本可以被chkconfig命令管理</li>
</ul>
<h5 id="t312.1.7.1  开机启动">2.1.7.1  开机启动 <a href="#t312.1.7.1  开机启动"> # </a></h5>
<pre><code class="lang-js">chkconfig --add nginx
chkconfig --list 
chkconfig --level <span class="hljs-number">2345</span> nginx on 
chkconfig nginx off
</code></pre>

    