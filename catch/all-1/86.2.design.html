
        <h2 id="t01. 什么是面向对象">1. 什么是面向对象 <a href="#t01. 什么是面向对象"> # </a></h2>
<ul>
<li>以类和对象作为组织代码的基本单位，并实现封装、抽象、继承、多态四个特性</li>
<li>软件开发经历分析、设计和编码三个阶段<ul>
<li>面向对象分析(OOA) Object Oriented Analysis</li>
<li>面向对象设计(OOD) Object Oriented Design</li>
<li>面向对象编程(OOP)Object Oriented Programming</li>
</ul>
</li>
</ul>
<h3 id="t11.1 抽象(Abstraction)">1.1 抽象(Abstraction) <a href="#t11.1 抽象(Abstraction)"> # </a></h3>
<ul>
<li>抽象主要是隐藏方法的实现，让调用者只关心有哪些功能而不是关心功能的实现</li>
<li>抽象可以提高代码的可扩展性和维护性，修改实现不需要改变定义，可以减少代码的改动范围</li>
</ul>
<pre><code class="lang-js">interface IStorage {
    save(key: any, <span class="hljs-attr">value</span>: any): <span class="hljs-keyword">void</span>;
    read(key: any): <span class="hljs-keyword">void</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LocalStorage</span> <span class="hljs-title">implements</span> <span class="hljs-title">IStorage</span> </span>{
    save(key: any, <span class="hljs-attr">value</span>: any) {
        localStorage.setItem(key, value);
    }
    read(key: any) {
        <span class="hljs-keyword">return</span> localStorage.getItem(key);
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
    <span class="hljs-keyword">constructor</span>(public name: string, public storage: IStorage) {

    }
    save() {
        <span class="hljs-keyword">this</span>.storage.save(<span class="hljs-string">'userInfo'</span>, <span class="hljs-built_in">JSON</span>.stringify(<span class="hljs-keyword">this</span>));
    }
    read() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.storage.read(<span class="hljs-string">'userInfo'</span>);
    }
}
<span class="hljs-keyword">let</span> user = <span class="hljs-keyword">new</span> User(<span class="hljs-string">'张三'</span>, <span class="hljs-keyword">new</span> LocalStorage());
user.save();
user.read();
</code></pre>
<h3 id="t21.2 继承">1.2 继承 <a href="#t21.2 继承"> # </a></h3>
<ul>
<li>继承主要的要处是实现代码复用</li>
<li>继承可以把父类和子类的公共方法抽离出来，提高复用，减少冗余</li>
<li>是一种 <code>is-a</code> 关系</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> { };
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span> </span>{
    <span class="hljs-attr">name</span>: string;
    <span class="hljs-keyword">constructor</span>(name: string) {
        <span class="hljs-keyword">this</span>.name = name;
    }
    eat() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.name}</span> eat`</span>)
    }
}
<span class="hljs-keyword">let</span> animal = <span class="hljs-keyword">new</span> Animal(<span class="hljs-string">'动物'</span>);
animal.eat();

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Animal</span> </span>{
    <span class="hljs-attr">age</span>: number;
    <span class="hljs-keyword">constructor</span>(name: string, age: number) {
        <span class="hljs-keyword">super</span>(name);
        <span class="hljs-keyword">this</span>.age = age;
    }
    speak() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.name}</span> is barking!`</span>);
    }
}
<span class="hljs-keyword">let</span> dog = <span class="hljs-keyword">new</span> Dog(<span class="hljs-string">'🐶'</span>, <span class="hljs-number">5</span>);
dog.eat();
dog.speak();
</code></pre>
<blockquote>
<p>过度使用继承或者说继承层次过深会导致代码可读性、可维护性变差
子类和父类高度耦合，修改父类的代码，会直接影响到子类</p>
</blockquote>
<h3 id="t31.3 封装">1.3 封装 <a href="#t31.3 封装"> # </a></h3>
<ul>
<li>把数据封装起来</li>
<li>减少耦合，不该外部访问的不要让外部访问</li>
<li>利于数据的接口权限管理</li>
<li>仅暴露有限的必要接口，提高类的易用性</li>
<li>实现<ul>
<li>public:公有修饰符，可以在类内或者类外使用public修饰的属性或者行为，默认修饰符</li>
<li>protected:受保护的修饰符，可以本类和子类中使用protected修饰的属性和行为</li>
<li>private : 私有修饰符，只可以在类内使用private修饰的属性和行为</li>
</ul>
</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/1control.png" alt="1control">
<img src="http://img.zhufengpeixun.cn/2control.png" alt="2control"></p>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span> </span>{
    public name: string;
    protected age: number;
    private weight: number;
    <span class="hljs-keyword">constructor</span>(name: string, age: number, weight: number) {
        <span class="hljs-keyword">this</span>.name = name;
        <span class="hljs-keyword">this</span>.age = age;
        <span class="hljs-keyword">this</span>.weight = weight;
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Animal</span> </span>{
    private money: number;
    <span class="hljs-keyword">constructor</span>(name: string, age: number, weight: number, money: number) {
        <span class="hljs-keyword">super</span>(name, age, weight);
        <span class="hljs-keyword">this</span>.money = money;
    }
    getName() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.name);
    }
    getAge() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.age);
    }
    getWeight() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.weight);
    }
    getMoney() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.money);
    }
}
<span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">'zfpx'</span>, <span class="hljs-number">9</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
<span class="hljs-built_in">console</span>.log(p.name);
<span class="hljs-built_in">console</span>.log(p.age);
<span class="hljs-built_in">console</span>.log(p.weight);
</code></pre>
<h3 id="t41.4 多态">1.4 多态 <a href="#t41.4 多态"> # </a></h3>
<ul>
<li>多态是指，子类可以替换父类</li>
<li>保持子类的开放性和灵活性，可以重写父类中的方法</li>
<li>实现面向接口编程  </li>
</ul>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span> </span>{
    public name: string;
    protected age: number;
    private weight: number;
    <span class="hljs-keyword">constructor</span>(name: string, age: number, weight: number) {
        <span class="hljs-keyword">this</span>.name = name;
        <span class="hljs-keyword">this</span>.age = age;
        <span class="hljs-keyword">this</span>.weight = weight;
    }
    speak() {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'此方法必须由子类实现!'</span>);
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Animal</span> </span>{
    private money: number;
    <span class="hljs-keyword">constructor</span>(name: string, age: number, weight: number, money: number) {
        <span class="hljs-keyword">super</span>(name, age, weight);
        <span class="hljs-keyword">this</span>.money = money;
    }
    getName() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.name);
    }
    getAge() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.age);
    }
    getMoney() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.money);
    }
    speak() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'你好!'</span>);
    }

}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Animal</span> </span>{
    <span class="hljs-keyword">constructor</span>(name: string, age: number, weight: number) {
        <span class="hljs-keyword">super</span>(name, age, weight);
    }
    speak() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'汪汪汪!'</span>);
    }
}
<span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">'zfpx'</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>);
p.speak();
<span class="hljs-keyword">let</span> d = <span class="hljs-keyword">new</span> Dog(<span class="hljs-string">'zfpx'</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>);
d.speak();
</code></pre>
<h2 id="t52. 设计原则">2. 设计原则 <a href="#t52. 设计原则"> # </a></h2>
<h3 id="t62.1 什么是设计？">2.1 什么是设计？ <a href="#t62.1 什么是设计？"> # </a></h3>
<ul>
<li>按哪一种思路或者标准来实现功能</li>
<li>功能相同，可以有不同设计的方式</li>
<li>需求如果不断变化，设计的作用才能体现出来</li>
</ul>
<h3 id="t72.2 SOLID五大设计原则">2.2 SOLID五大设计原则 <a href="#t72.2 SOLID五大设计原则"> # </a></h3>
<table>
<thead>
<tr>
<th style="text-align:left">首字母</th>
<th style="text-align:left">指代</th>
<th style="text-align:left">概念</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">S</td>
<td style="text-align:left">单一职责原则</td>
<td style="text-align:left">单一功能原则认为对象应该仅具有一种<code>单一功能</code>的概念</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">开放封闭原则</td>
<td style="text-align:left">开闭原则认为<code>软件体应该是对于扩展开放的，但是对于修改封闭的</code>的概念</td>
</tr>
<tr>
<td style="text-align:left">L</td>
<td style="text-align:left">里氏替换原则</td>
<td style="text-align:left">里氏替换原则认为程序中的对象应该是可以在不改变程序正确性的前提下<code>被它的子类所替换</code>的的概念</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">接口隔离原则</td>
<td style="text-align:left">接口隔离原则认为<code>多个特定客户端接口要好于一个宽泛用途的接口</code>的概念</td>
</tr>
<tr>
<td style="text-align:left">D</td>
<td style="text-align:left">依赖反转原则</td>
<td style="text-align:left">依赖反转原则认为一个方法应该遵从<code>依赖于抽象而不是一个实例</code>的概念,依赖注入是该原则的一种实现方式。</td>
</tr>
</tbody>
</table>
<h4 id="t82.2.1 O 开放封闭原则">2.2.1 O 开放封闭原则 <a href="#t82.2.1 O 开放封闭原则"> # </a></h4>
<ul>
<li><code>Open Closed Principle</code></li>
<li>对扩展开放，对修改关闭</li>
<li>增加需求时，扩展新代码，而非修改已有代码</li>
<li>开闭原则是设计模式中的总原则</li>
<li>对近期可能会变化并且如果有变化但改动量巨大的地方要增加扩展点,扩展点过多会降低可读性</li>
</ul>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Customer</span> </span>{
    <span class="hljs-keyword">constructor</span>(public rank: string) { }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span> </span>{
    <span class="hljs-keyword">constructor</span>(public name: string, public price: number) {

    }
    cost(customer: Customer) {
        <span class="hljs-keyword">switch</span> (customer.rank) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'member'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.price * <span class="hljs-number">.8</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'vip'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.price * <span class="hljs-number">.6</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.price;
        }
    }
}
<span class="hljs-keyword">let</span> p1 = <span class="hljs-keyword">new</span> Product(<span class="hljs-string">'笔记本电脑'</span>, <span class="hljs-number">1000</span>);
<span class="hljs-keyword">let</span> member = <span class="hljs-keyword">new</span> Customer(<span class="hljs-string">'member'</span>);
<span class="hljs-keyword">let</span> vip = <span class="hljs-keyword">new</span> Customer(<span class="hljs-string">'vip'</span>);
<span class="hljs-keyword">let</span> guest = <span class="hljs-keyword">new</span> Customer(<span class="hljs-string">'guest'</span>);
<span class="hljs-built_in">console</span>.log(p1.cost(member));
<span class="hljs-built_in">console</span>.log(p1.cost(vip));
<span class="hljs-built_in">console</span>.log(p1.cost(guest));
</code></pre>
<pre><code class="lang-diff">class Customer {
<span class="hljs-addition">+    constructor(public rank: string, public discount: number = 1) { }</span>
<span class="hljs-addition">+    getDiscount() {</span>
<span class="hljs-addition">+        return this.discount;</span>
<span class="hljs-addition">+    }</span>
}
class Product {
    constructor(public name: string, public price: number) {

    }
    cost(customer: Customer) {
<span class="hljs-deletion">-        /*  switch (customer.rank) {</span>
<span class="hljs-deletion">-             case 'member':</span>
<span class="hljs-deletion">-                 return this.price * .8;</span>
<span class="hljs-deletion">-             case 'vip':</span>
<span class="hljs-deletion">-                 return this.price * .6;</span>
<span class="hljs-deletion">-             default:</span>
<span class="hljs-deletion">-                 return this.price;</span>
<span class="hljs-deletion">-         } */</span>
<span class="hljs-addition">+        return this.price * customer.getDiscount();</span>
    }
}
<span class="hljs-addition">+let p1 = new Product('笔记本电脑', 1000);</span>
<span class="hljs-addition">+let member = new Customer('member', .8);</span>
<span class="hljs-addition">+let vip = new Customer('vip', .6);</span>
let guest = new Customer('guest');
console.log(p1.cost(member));
console.log(p1.cost(vip));
console.log(p1.cost(guest));
</code></pre>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> axios, { AxiosInstance, AxiosRequestConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">let</span> instance: AxiosInstance = axios.create();
instance.interceptors.request.use(<span class="hljs-function">(<span class="hljs-params">config: AxiosRequestConfig</span>) =&gt;</span> {
    config.url = <span class="hljs-string">'http://localhost:8080'</span> + config.url;
    <span class="hljs-keyword">return</span> config;
});

instance.interceptors.response.use(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (response.status !== <span class="hljs-number">200</span> || response.data.code != <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(response);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> response.data.data;
    }
})
<span class="hljs-comment">/**
 * {code:0,data:{id:1,name:'zhufeng'}}
 */</span>
instance({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/users'</span>
}).then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(result);
}, error =&gt; {
    <span class="hljs-built_in">console</span>.error(error);
});
</code></pre>
<h4 id="t92.2.2 S 单一职责原则">2.2.2 S 单一职责原则 <a href="#t92.2.2 S 单一职责原则"> # </a></h4>
<ul>
<li>Single responsibility principle</li>
<li>一个类或者模块只负责完成一个职责,如果功能特别复杂就进行拆分</li>
<li>单一职责可以降低类的复杂性，提高代码可读性、可维护性</li>
<li>当类代码行数过多、方法过多、功能太多、职责太杂的时候就要对类进行拆分了</li>
<li><p>拆分不能过度，如果拆分过度会损失内聚性和维护性</p>
</li>
<li><p><a href="https://www.lodashjs.com/docs/latest">lodashjs</a></p>
</li>
<li><a href="https://api.jquery.com/">jquery</a></li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/product.png" alt="product"></p>
<pre><code class="lang-diff">class Product {
    public name: string;
<span class="hljs-deletion">-    public categoryName: string;</span>
<span class="hljs-deletion">-    public categoryIcon: string;</span>
<span class="hljs-addition">+     public category:Category;</span>
}
<span class="hljs-addition">+class Category {</span>
<span class="hljs-addition">+    public name: string;</span>
<span class="hljs-addition">+    public icon: string;</span>
<span class="hljs-addition">+}</span>
</code></pre>
<h4 id="t102.2.3 L 里氏替换原则">2.2.3 L 里氏替换原则 <a href="#t102.2.3 L 里氏替换原则"> # </a></h4>
<ul>
<li>Liskov Substitution Principle</li>
<li>所有引用基类的地方必须能透明地使用其子类的对象</li>
<li>子类能替换掉父类，使用者可能根本就不需要知道是父类还是子类,反之则不行</li>
<li>里氏替换原则是开闭原则的实现基础,程序设计的时候尽量使用基类定义及引用，运行时再决定使用哪个子类</li>
<li>里氏替换原则可以提高代码的复用性，提高代码的可扩展性，也增加了耦合性</li>
<li>相对于多态，这个原则是讲的是类如何设计，子类如果违反了父类的功能则表示违反了里氏替换原则</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/3.Substitution.png" alt="Substitution"></p>
<pre><code class="lang-js">abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractDrink</span> </span>{
    abstract getName(): string;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CocaCola</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractDrink</span> </span>{
    getName(): string {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'可乐'</span>;
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sprite</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractDrink</span> </span>{
    getName(): string {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'雪碧'</span>;
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fanta</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractDrink</span> </span>{
    getName(): string {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'芬达'</span>;
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Customer</span> </span>{
    drink(drink: AbstractDrink) {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'喝'</span> + drink.getName());
    }
}
<span class="hljs-keyword">let</span> customer = <span class="hljs-keyword">new</span> Customer();
<span class="hljs-keyword">let</span> cocaCola = <span class="hljs-keyword">new</span> CocaCola();
<span class="hljs-keyword">let</span> sprite = <span class="hljs-keyword">new</span> Sprite();
<span class="hljs-keyword">let</span> fanta = <span class="hljs-keyword">new</span> Fanta();
customer.drink(cocaCola);
customer.drink(sprite);
customer.drink(fanta);
</code></pre>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>App <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}
<span class="hljs-keyword">let</span> element = React.createElement(App);
ReactDOM.render(element, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'root'</span>));
</code></pre>
<pre><code class="lang-js">abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractDrink</span> </span>{
    abstract getName(): any;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CocaCola</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractDrink</span> </span>{
    getName(): any {
        <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;
    }
}
</code></pre>
<h4 id="t112.2.4 D 依赖倒置原则">2.2.4 D 依赖倒置原则 <a href="#t112.2.4 D 依赖倒置原则"> # </a></h4>
<ul>
<li>Dependence Inversion Principle</li>
<li>面向接口编程，依赖于抽象而不依赖于具体实现</li>
<li>要求我们在程序代码中传递参数时或在关联关系中，尽量引用层次高的抽象层类</li>
<li>使用方只关注接口而不关注具体类的实现</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/5.Inversion.png" alt="Inversion"></p>
<pre><code class="lang-js">abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GirlFriend</span> </span>{
    public age: number;
    public height: number;
    public abstract cook(): <span class="hljs-keyword">void</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LinZhiLing</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GirlFriend</span> </span>{
    public cook(): <span class="hljs-keyword">void</span> {

    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HanMeiMei</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GirlFriend</span> </span>{
    public cook(): <span class="hljs-keyword">void</span> {

    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingleDog</span> </span>{
    <span class="hljs-keyword">constructor</span>(public girlFriend: GirlFriend) {

    }
}
<span class="hljs-keyword">let</span> s1 = <span class="hljs-keyword">new</span> SingleDog(<span class="hljs-keyword">new</span> LinZhiLing());
<span class="hljs-keyword">let</span> s2 = <span class="hljs-keyword">new</span> SingleDog(<span class="hljs-keyword">new</span> HanMeiMei());
</code></pre>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> { createStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span>;
<span class="hljs-keyword">let</span> store = createStore(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state);
<span class="hljs-keyword">export</span> interface Action&lt;T = any&gt; {
    <span class="hljs-attr">type</span>: T
}
<span class="hljs-keyword">export</span> interface AnyAction extends Action {
    <span class="hljs-comment">// Allows any extra properties to be defined in an action.</span>
    [extraProps: string]: any
}
<span class="hljs-keyword">let</span> action: AnyAction = { <span class="hljs-attr">type</span>: <span class="hljs-string">'increment'</span>, <span class="hljs-attr">payload</span>: <span class="hljs-number">5</span> }
store.dispatch(action);
</code></pre>
<h4 id="t122.2.5  I 接口隔离原则">2.2.5  I 接口隔离原则 <a href="#t122.2.5  I 接口隔离原则"> # </a></h4>
<ul>
<li>Interface Segregation Principle</li>
<li>保持接口的单一独立，避免出现胖接口</li>
<li>客户端不应该依赖它不需要的接口，类间的依赖关系应该建立在最小的接口上</li>
<li>接口尽量细化，而且接口中的方法尽量的少</li>
<li>类似于单一职责原则，更关注接口</li>
</ul>
<pre><code class="lang-js">interface IUserManager {
    updateUserInfo(): <span class="hljs-keyword">void</span>;
    updatePassword(): <span class="hljs-keyword">void</span>;
}
interface IProductManager {
    updateProduct(): <span class="hljs-keyword">void</span>;
    updatePrice(): <span class="hljs-keyword">void</span>;
}
</code></pre>
<p><img src="http://img.zhufengpeixun.cn/play.jpg" alt="play"></p>
<pre><code class="lang-js">interface Running {
    run(): <span class="hljs-keyword">void</span>;
}
interface Flying {
    fly(): <span class="hljs-keyword">void</span>;
}
interface Swimming {
    swim(): <span class="hljs-keyword">void</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Automobile</span> <span class="hljs-title">implements</span> <span class="hljs-title">Running</span>, <span class="hljs-title">Flying</span>, <span class="hljs-title">Swimming</span> </span>{
    run() { }
    fly() { }
    swim() { }
}
</code></pre>
<h3 id="t132.3  迪米特法则">2.3  迪米特法则 <a href="#t132.3  迪米特法则"> # </a></h3>
<ul>
<li>Law of Demeter，LOD</li>
<li>有时候也叫做最少知识原则</li>
<li>一个软件实体应当尽可能少地与其它实体发生相互作用</li>
<li>迪米特法则的初衷在于降低类之间的耦合</li>
<li>类定义时尽量要实现内聚,少使用<code>public</code>修饰符，尽量使用<code>private</code>、<code>protected</code> 等</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/6.Demeter.png" alt="Demeter"></p>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Salesman</span> </span>{
    <span class="hljs-keyword">constructor</span>(public name: string) {

    }
    sale() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.name + <span class="hljs-string">' 销售中....'</span>);
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SaleManager</span> </span>{
    private salesmen: <span class="hljs-built_in">Array</span>&lt;Salesman&gt; = [<span class="hljs-keyword">new</span> Salesman(<span class="hljs-string">'张三'</span>), <span class="hljs-keyword">new</span> Salesman(<span class="hljs-string">'李四'</span>)];
    sale() {
        <span class="hljs-keyword">this</span>.salesmen.forEach(<span class="hljs-function"><span class="hljs-params">salesman</span> =&gt;</span> salesman.sale());
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CEO</span> </span>{
    private saleManager: SaleManager = <span class="hljs-keyword">new</span> SaleManager();
    sale() {
        <span class="hljs-keyword">this</span>.saleManager.sale();
    }
}
<span class="hljs-keyword">let</span> ceo = <span class="hljs-keyword">new</span> CEO();
ceo.sale();
</code></pre>
<h3 id="t142.4  合成复用原则">2.4  合成复用原则 <a href="#t142.4  合成复用原则"> # </a></h3>
<h4 id="t152.4.1 类的关系">2.4.1 类的关系 <a href="#t152.4.1 类的关系"> # </a></h4>
<ul>
<li>类之间有三种基本关系，分别是关联(聚合和组合)、泛化和依赖</li>
<li>如果一个类单向依赖另一个类,那么它们之间就是单向关联。如果彼此依赖,则为相互依赖,即双向关联</li>
<li>关联关系包括两种特例：聚合和组合<ul>
<li>聚合，用来表示整体与部分的关系或者<code>拥有</code>关系,代表部分的对象可能会被整体拥有，但并不定定会随着整体的消亡而销毁,比如班级和学生</li>
<li>合成或者说组合要比聚合关系强的多，部分和整体的生命周期是一致的,比如人和器官之间</li>
</ul>
</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/xinyuanjieyi.png" alt="xinyuanjieyi"></p>
<p><img src="http://img.zhufengpeixun.cn/7.composite.png" alt="composite"></p>
<h4 id="t162.4.2 合成复用原则">2.4.2 合成复用原则 <a href="#t162.4.2 合成复用原则"> # </a></h4>
<ul>
<li>合成复用原则是通过将已有的对象纳入新对象中，作为新对象的成员对象来实现的</li>
<li>新对象可以调用已有对象的功能，从而达到复用</li>
<li>原则是尽量首先使用组合/聚合的方式，而不是使用继承</li>
<li>专业人做专业事</li>
</ul>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cooker</span> </span>{
    cook() {

    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{
    private cooker: Cooker = <span class="hljs-keyword">new</span> Cooker();
    cook() {
        <span class="hljs-keyword">this</span>.cooker.cook();
    }
}
</code></pre>
<h3 id="t172.5 总结">2.5 总结 <a href="#t172.5 总结"> # </a></h3>
<ul>
<li>开闭原则是核心，对修改关闭对扩展开放是软件设计的基石</li>
<li>单一职责要求我们设计接口和模块功能的时候尽量保证单一性和原子性，修改一条不影响全局和其它模块</li>
<li>里氏替换原则和依赖倒置原则要求面向接口和抽象编程,不要依赖具体实现，否则实现一改，上层调用者就要对应修改</li>
</ul>
<h3 id="t182.6 如何写出好代码?">2.6 如何写出好代码? <a href="#t182.6 如何写出好代码?"> # </a></h3>
<ul>
<li>可维护性 BUG是否好改?</li>
<li>可读性 是否容易看懂?</li>
<li>可扩展性 是否可以添加新功能?</li>
<li>灵活性 添加新功能是否容易?老方法和接口是否容易复用?</li>
<li>简洁性 代码是否简单清晰?</li>
<li>可复用性 相同的代码不要写2遍?</li>
<li>可测试性 是否方便写单元测试和集成测试?</li>
</ul>
<h2 id="t193. 23种设计模式">3. 23种设计模式 <a href="#t193. 23种设计模式"> # </a></h2>
<h3 id="t203.1 创建型">3.1 创建型 <a href="#t203.1 创建型"> # </a></h3>
<ul>
<li><code>重要: 工厂模式(工厂方法模式、抽象工厂模式、简单工厂模式)、建造者模式、单例模式</code></li>
<li>不重要: 原型模式</li>
</ul>
<h3 id="t213.2 结构型模式">3.2 结构型模式 <a href="#t213.2 结构型模式"> # </a></h3>
<ul>
<li><code>重要: 代理模式、桥接模式、装饰器模式、适配器模式</code></li>
<li>不重要: 外观模式、组合模式、享元模式</li>
</ul>
<h3 id="t223.3 行为型">3.3 行为型 <a href="#t223.3 行为型"> # </a></h3>
<ul>
<li><code>重要: 观察者模式、模版方法模式、策略模式、职责链模式、迭代器模式、状态模式</code></li>
<li>不重要: 访问者模式、备忘录模式、命令模式、解释器模式、中介者模式</li>
</ul>
<h2 id="t234. 工厂模式">4. 工厂模式 <a href="#t234. 工厂模式"> # </a></h2>
<h3 id="t244.1 简单工厂模式">4.1 简单工厂模式 <a href="#t244.1 简单工厂模式"> # </a></h3>
<ul>
<li>简单工厂模式是由一个工厂对象决定创建出哪一种产品类的实例<h4 id="t254.1.1 类图">4.1.1 类图 <a href="#t254.1.1 类图"> # </a></h4>
</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/simplefatory2.png" alt="simplefatory2"></p>
<h4 id="t264.1.2 代码">4.1.2 代码 <a href="#t264.1.2 代码"> # </a></h4>
<pre><code class="lang-js">abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Coffee</span> </span>{
    <span class="hljs-keyword">constructor</span>(public name: string) {

    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AmericanoCoffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Coffee</span> </span>{
    <span class="hljs-keyword">constructor</span>(public name: string) {
        <span class="hljs-keyword">super</span>(name);
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LatteCoffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Coffee</span> </span>{
    <span class="hljs-keyword">constructor</span>(public name: string) {
        <span class="hljs-keyword">super</span>(name);
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CappuccinoCoffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Coffee</span> </span>{
    <span class="hljs-keyword">constructor</span>(public name: string) {
        <span class="hljs-keyword">super</span>(name);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Caf</span>é </span>{
    <span class="hljs-keyword">static</span> order(name: string) {
        <span class="hljs-keyword">switch</span> (name) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'Americano'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AmericanoCoffee(<span class="hljs-string">'美式咖啡'</span>);
            <span class="hljs-keyword">case</span> <span class="hljs-string">'Latte'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LatteCoffee(<span class="hljs-string">'拿铁咖啡'</span>);
            <span class="hljs-keyword">case</span> <span class="hljs-string">'Cappuccino'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LatteCoffee(<span class="hljs-string">'卡布奇诺'</span>);
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }
}
<span class="hljs-built_in">console</span>.log(Café.order(<span class="hljs-string">'Americano'</span>));
<span class="hljs-built_in">console</span>.log(Café.order(<span class="hljs-string">'Latte'</span>));
<span class="hljs-built_in">console</span>.log(Café.order(<span class="hljs-string">'Cappuccino'</span>));

</code></pre>
<h3 id="t274.1.3 缺点">4.1.3 缺点 <a href="#t274.1.3 缺点"> # </a></h3>
<ul>
<li>如果产品的种类非常多<code>switch case</code>的判断会变得非常多</li>
<li>不符合开放—封闭原则,如果要增加或删除一个产品种类，就要修改<code>switch case</code>的判断代码</li>
</ul>
<h4 id="t284.1.3 前端应用场景">4.1.3 前端应用场景 <a href="#t284.1.3 前端应用场景"> # </a></h4>
<h5 id="t294.1.3.1 jQuery">4.1.3.1 jQuery <a href="#t294.1.3.1 jQuery"> # </a></h5>
<ul>
<li><a href="https://github.com/jquery/jquery/blob/c1ee33aded44051b8f1288b59d2efdc68d0413cc/src/core.js#L24-L29">jQuery</a></li>
</ul>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">jQuery</span></span>{
    <span class="hljs-keyword">constructor</span>(selector){
        <span class="hljs-keyword">let</span> elements = <span class="hljs-built_in">Array</span>.from(<span class="hljs-built_in">document</span>.querySelectorAll(selector));
        <span class="hljs-keyword">let</span> length = elements?elements.length:<span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>;i&lt;length;i++){
            <span class="hljs-keyword">this</span>[i]=elements[i];
        }
        <span class="hljs-keyword">this</span>.length = length;
    }
    html(html){
        <span class="hljs-keyword">if</span>(html){
           <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>].innerHTML=html;
        }<span class="hljs-keyword">else</span>{
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>].innerHTML;
        }
    }
}
<span class="hljs-built_in">window</span>.$ = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">selector</span>)</span>{
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> jQuery(selector);
}
</code></pre>
<h5 id="t304.1.3.2 React">4.1.3.2 React <a href="#t304.1.3.2 React"> # </a></h5>
<ul>
<li><a href="https://github.com/facebook/react/blob/master/packages/react/src/ReactElement.js#L313-L395">createElement</a></li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createElement</span>(<span class="hljs-params">type, config, children</span>) </span>{
    <span class="hljs-keyword">return</span> ReactElement(
        type,
        key,
        ref,
        self,
        source,
        ReactCurrentOwner.current,
        props,
    );
}
</code></pre>
<h3 id="t314.2 工厂方法模式">4.2 工厂方法模式 <a href="#t314.2 工厂方法模式"> # </a></h3>
<ul>
<li>工厂方法模式<code>Factory Method</code>,又称多态性工厂模式。</li>
<li>在工厂方法模式中,核心的工厂类不再负责所有的产品的创建，而是将具体创建的工作交给工厂子类去做。</li>
</ul>
<h4 id="t324.2.1 类图">4.2.1 类图 <a href="#t324.2.1 类图"> # </a></h4>
<p><img src="http://img.zhufengpeixun.cn/factorymethod.png" alt="factorymethod"></p>
<h4 id="t334.2.2 代码">4.2.2 代码 <a href="#t334.2.2 代码"> # </a></h4>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> { }
abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Coffee</span> </span>{
    <span class="hljs-keyword">constructor</span>(public name: string) {

    }
}
abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Factory</span> </span>{
    abstract createCoffee(): Coffee;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AmericanoCoffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Coffee</span> </span>{
    <span class="hljs-keyword">constructor</span>(public name: string) {
        <span class="hljs-keyword">super</span>(name);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AmericanoCoffeeFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Factory</span> </span>{
    createCoffee() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AmericanoCoffee(<span class="hljs-string">'美式咖啡'</span>)
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LatteCoffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Coffee</span> </span>{
    <span class="hljs-keyword">constructor</span>(public name: string) {
        <span class="hljs-keyword">super</span>(name);
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LatteCoffeeFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Factory</span> </span>{
    createCoffee() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LatteCoffee(<span class="hljs-string">'拿铁咖啡'</span>)
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CappuccinoCoffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Coffee</span> </span>{
    <span class="hljs-keyword">constructor</span>(public name: string) {
        <span class="hljs-keyword">super</span>(name);
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CappuccinoFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Factory</span> </span>{
    createCoffee() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CappuccinoCoffee(<span class="hljs-string">'卡布奇诺'</span>)
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Caf</span>é </span>{
    <span class="hljs-keyword">static</span> order(name: string) {
        <span class="hljs-keyword">switch</span> (name) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'Americano'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AmericanoCoffeeFactory().createCoffee();
            <span class="hljs-keyword">case</span> <span class="hljs-string">'Latte'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LatteCoffeeFactory().createCoffee();
            <span class="hljs-keyword">case</span> <span class="hljs-string">'Cappuccino'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CappuccinoFactory().createCoffee();
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }
}
<span class="hljs-built_in">console</span>.log(Café.order(<span class="hljs-string">'Americano'</span>));
<span class="hljs-built_in">console</span>.log(Café.order(<span class="hljs-string">'Latte'</span>));
<span class="hljs-built_in">console</span>.log(Café.order(<span class="hljs-string">'Cappuccino'</span>));
</code></pre>
<h4 id="t344.2.3 应用场景">4.2.3 应用场景 <a href="#t344.2.3 应用场景"> # </a></h4>
<h5 id="t354.2.3.1 React">4.2.3.1 React <a href="#t354.2.3.1 React"> # </a></h5>
<ul>
<li><a href="https://github.com/facebook/react/blob/master/packages/react/src/ReactElement.js#L401-L409">createFactory</a></li>
</ul>
<h3 id="t364.3 抽象工厂模式">4.3 抽象工厂模式 <a href="#t364.3 抽象工厂模式"> # </a></h3>
<ul>
<li>抽象工厂模式可以向客户端提供一个接口，使客户端在不必指定产品的具体的情况下，创建多个产品族中的产品对象</li>
<li>工厂方法模式针对的是同一类或同等级产品,而抽象工厂模式针对的是多种类的产品设计</li>
<li>系统中有多个产品族，每个具体工厂负责创建同一族但属于不同产品等级(产品种类)的产品</li>
<li>产品族是一组相关或相互依赖的对象</li>
<li>系统一次只能消费某一族产品，即相同产品族的产品是一起被使用的</li>
<li>当系统需要新增一个产品族时，只需要增加新的工厂类即可，无需修改源代码；但是如果需要产品族中增加一个新种类的产品时，则所有的工厂类都需要修改</li>
</ul>
<h4 id="t374.3.1  组成角色">4.3.1  组成角色 <a href="#t374.3.1  组成角色"> # </a></h4>
<ul>
<li>抽象工厂: 提供了创建产品的接口,包含多个创建产品的方法,即包含多个类似创建产品的方法</li>
<li>具体工厂: 实现抽象工厂定义的接口,完成某个具体产品的创建</li>
<li>抽象产品: 抽象产品定义,一般有多少抽象产品,抽象工厂中就包含多少个创建产品的方法</li>
<li>具体产品: 抽象产品的实现类</li>
</ul>
<h4 id="t384.3.1 类图">4.3.1 类图 <a href="#t384.3.1 类图"> # </a></h4>
<p><img src="http://img.zhufengpeixun.cn/abstractfactory3.png" alt="abstractfactory3"></p>
<p><img src="http://img.zhufengpeixun.cn/abstractfactory2.png" alt="abstractfactory2"></p>
<h4 id="t394.3.2 代码">4.3.2 代码 <a href="#t394.3.2 代码"> # </a></h4>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> { };
abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AmericanoCoffee</span> </span>{ }
abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LatteCoffee</span> </span>{ }
abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CappuccinoCoffee</span> </span>{ }

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StarbucksAmericanoCoffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AmericanoCoffee</span> </span>{ }
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StarbucksLatteCoffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LatteCoffee</span> </span>{ }
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StarbucksCappuccinoCoffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CappuccinoCoffee</span> </span>{ }

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LuckinAmericanoCoffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AmericanoCoffee</span> </span>{ }
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LuckinLatteCoffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LatteCoffee</span> </span>{ }
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LuckinCappuccinoCoffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CappuccinoCoffee</span> </span>{ }

abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CafeFactory</span> </span>{
    abstract createAmericanoCoffee(): AmericanoCoffee;
    abstract createLatteCoffee(): LatteCoffee;
    abstract createCappuccinoCoffee(): CappuccinoCoffee;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StarbucksCafeFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CafeFactory</span> </span>{
    createAmericanoCoffee() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> StarbucksAmericanoCoffee();
    }
    createLatteCoffee() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> StarbucksLatteCoffee();
    }
    createCappuccinoCoffee() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> StarbucksCappuccinoCoffee();
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LuckinCafeFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CafeFactory</span> </span>{
    createAmericanoCoffee() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LuckinAmericanoCoffee();
    }
    createLatteCoffee() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LuckinLatteCoffee();
    }
    createCappuccinoCoffee() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LuckinCappuccinoCoffee();
    }
}

<span class="hljs-keyword">let</span> starbucksCafeFactory = <span class="hljs-keyword">new</span> StarbucksCafeFactory();
<span class="hljs-built_in">console</span>.log(starbucksCafeFactory.createAmericanoCoffee());
<span class="hljs-built_in">console</span>.log(starbucksCafeFactory.createCappuccinoCoffee());
<span class="hljs-built_in">console</span>.log(starbucksCafeFactory.createLatteCoffee());

<span class="hljs-keyword">let</span> luckinCafeFactory = <span class="hljs-keyword">new</span> LuckinCafeFactory();
<span class="hljs-built_in">console</span>.log(luckinCafeFactory.createAmericanoCoffee());
<span class="hljs-built_in">console</span>.log(luckinCafeFactory.createCappuccinoCoffee());
<span class="hljs-built_in">console</span>.log(luckinCafeFactory.createLatteCoffee());
</code></pre>
<h2 id="t405.单例模式">5.单例模式 <a href="#t405.单例模式"> # </a></h2>
<h4 id="t415.1 类图">5.1 类图 <a href="#t415.1 类图"> # </a></h4>
<p><img src="http://img.zhufengpeixun.cn/singleobject.jpg" alt="singleobject"></p>
<h4 id="t425.2 代码">5.2 代码 <a href="#t425.2 代码"> # </a></h4>
<h5 id="t435.2.1 单例模式">5.2.1 单例模式 <a href="#t435.2.1 单例模式"> # </a></h5>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> { };
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Window</span> </span>{
    private <span class="hljs-keyword">static</span> instance: Window;
    private <span class="hljs-keyword">constructor</span>() { }
    <span class="hljs-keyword">static</span> getInstance() {
        <span class="hljs-keyword">if</span> (!Window.instance) {
            Window.instance = <span class="hljs-keyword">new</span> Window();
        }
        <span class="hljs-keyword">return</span> Window.instance;
    }
}
<span class="hljs-comment">//new Window();</span>
<span class="hljs-keyword">var</span> w1 = Window.getInstance();
<span class="hljs-keyword">var</span> w2 = Window.getInstance();
<span class="hljs-built_in">console</span>.log(w1 === w2);
</code></pre>
<h5 id="t445.2.2 ES5单例模式">5.2.2 ES5单例模式 <a href="#t445.2.2 ES5单例模式"> # </a></h5>
<pre><code class="lang-js">interface Window {
    <span class="hljs-attr">hello</span>: any
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Window</span>(<span class="hljs-params"></span>) </span>{ }
Window.prototype.hello = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'hello'</span>);
}
Window.getInstance = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">let</span> <span class="hljs-built_in">window</span>: Window;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">window</span>)
            <span class="hljs-built_in">window</span> = <span class="hljs-keyword">new</span> (Window <span class="hljs-keyword">as</span> any)();
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>;
    }
})();
<span class="hljs-keyword">let</span> <span class="hljs-built_in">window</span> = Window.getInstance();
<span class="hljs-built_in">window</span>.hello();
</code></pre>
<h5 id="t455.2.3 透明单例">5.2.3 透明单例 <a href="#t455.2.3 透明单例"> # </a></h5>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> Window = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">let</span> <span class="hljs-built_in">window</span>: Window;
    <span class="hljs-keyword">let</span> Window = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">this: Window</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> (<span class="hljs-built_in">window</span> = <span class="hljs-keyword">this</span>);
        }
    }
    Window.prototype.hello = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'hello'</span>);
    }
    <span class="hljs-keyword">return</span> Window;
})();

<span class="hljs-keyword">let</span> window1 = <span class="hljs-keyword">new</span> (Window <span class="hljs-keyword">as</span> any)();
<span class="hljs-keyword">let</span> window2 = <span class="hljs-keyword">new</span> (Window <span class="hljs-keyword">as</span> any)();
window1.hello();
<span class="hljs-built_in">console</span>.log(window1 === window2)
</code></pre>
<h5 id="t465.2.4 单例与构建分离">5.2.4 单例与构建分离 <a href="#t465.2.4 单例与构建分离"> # </a></h5>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> { }
interface Window {
    <span class="hljs-attr">hello</span>: any
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Window</span>(<span class="hljs-params"></span>) </span>{
}
Window.prototype.hello = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'hello'</span>);
}

<span class="hljs-keyword">let</span> createInstance = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">let</span> instance: Window;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (!instance) {
            instance = <span class="hljs-keyword">new</span> (Window <span class="hljs-keyword">as</span> any)();
        }
        <span class="hljs-keyword">return</span> instance;
    }
})();

<span class="hljs-keyword">let</span> window1 = createInstance();
<span class="hljs-keyword">let</span> window2 = createInstance();
window1.hello();
<span class="hljs-built_in">console</span>.log(window1 === window2)
</code></pre>
<h5 id="t475.2.5 封装变化">5.2.5 封装变化 <a href="#t475.2.5 封装变化"> # </a></h5>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> { }
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Window</span>(<span class="hljs-params"></span>) </span>{

}
Window.prototype.hello = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'hello'</span>);
}

<span class="hljs-keyword">let</span> createInstance = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">Constructor: any</span>) </span>{
    <span class="hljs-keyword">let</span> instance: any;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">this: any</span>) </span>{
        <span class="hljs-keyword">if</span> (!instance) {
            Constructor.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
            <span class="hljs-built_in">Object</span>.setPrototypeOf(<span class="hljs-keyword">this</span>, Constructor.prototype)
            instance = <span class="hljs-keyword">this</span>;
        }
        <span class="hljs-keyword">return</span> instance;
    }
};
<span class="hljs-keyword">let</span> CreateWindow: any = createInstance(Window);
<span class="hljs-keyword">let</span> window1 = <span class="hljs-keyword">new</span> CreateWindow();
<span class="hljs-keyword">let</span> window2 = <span class="hljs-keyword">new</span> CreateWindow();
window1.hello();
<span class="hljs-built_in">console</span>.log(window1 === window2)
</code></pre>
<h4 id="t485.3 场景">5.3 场景 <a href="#t485.3 场景"> # </a></h4>
<h5 id="t495.3.2 commonjs">5.3.2 commonjs <a href="#t495.3.2 commonjs"> # </a></h5>
<ul>
<li><a href="https://github.com/webpack/webpack/blob/8070bcd333cd1d07ce13fe5e91530c80779d51c6/lib/hmr/HotModuleReplacement.runtime.js#L55">HotModuleReplacement</a></li>
</ul>
<pre><code class="lang-js">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">modules</span>) </span>{
  <span class="hljs-comment">// webpack的启动函数</span>
  <span class="hljs-comment">//模块的缓存</span>
  <span class="hljs-keyword">var</span> installedModules = {};
  <span class="hljs-comment">//定义在浏览器中使用的require方法</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__webpack_require__</span>(<span class="hljs-params">moduleId</span>) </span>{
    <span class="hljs-comment">//检查模块是否在缓存中</span>
    <span class="hljs-keyword">if</span> (installedModules[moduleId]) {
      <span class="hljs-keyword">return</span> installedModules[moduleId].exports;
    }
    <span class="hljs-comment">//创建一个新的模块并且放到模块的缓存中</span>
    <span class="hljs-keyword">var</span> <span class="hljs-built_in">module</span> = (installedModules[moduleId] = {
      <span class="hljs-attr">i</span>: moduleId,
      <span class="hljs-attr">l</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">exports</span>: {}
    });

    <span class="hljs-comment">//执行模块函数</span>
    modules[moduleId].call(
      <span class="hljs-built_in">module</span>.exports,
      <span class="hljs-built_in">module</span>,
      <span class="hljs-built_in">module</span>.exports,
      __webpack_require__
    );

    <span class="hljs-comment">//把模块设置为已经加载</span>
    <span class="hljs-built_in">module</span>.l = <span class="hljs-literal">true</span>;

    <span class="hljs-comment">//返回模块的导出对象</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">module</span>.exports;
  }
}
</code></pre>
<h5 id="t505.3.2 jQuery">5.3.2 jQuery <a href="#t505.3.2 jQuery"> # </a></h5>
<ul>
<li><a href="https://code.jquery.com/jquery-3.4.1.js">jquery</a></li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">if</span>(<span class="hljs-built_in">window</span>.jQuery!=<span class="hljs-literal">null</span>){
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>.jQuery;
}<span class="hljs-keyword">else</span>{
    <span class="hljs-comment">//init~~~~~~~</span>
}
</code></pre>
<h5 id="t515.3.3 模态窗口">5.3.3 模态窗口 <a href="#t515.3.3 模态窗口"> # </a></h5>
<ul>
<li><a href="https://github.com/twbs/bootstrap/blob/master/js/src/modal.js">bootstrap modal.js</a></li>
</ul>
<pre><code class="lang-js">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="ie=edge"&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;button id="show-button"&gt;显示模态窗口&lt;/button&gt;
    &lt;button id="hide-button"&gt;隐藏模态窗口&lt;/button&gt;
    &lt;script&gt;
        class Login {
            constructor() {
                this.element = document.createElement('div');
                this.element.innerHTML = (
                    `
            用户名 &lt;input type="text"/&gt;
            &lt;button&gt;登录&lt;/button&gt;
            `
                );
                this.element.style.cssText = 'width: 100px; height: 100px; position: absolute; left: 50%; top: 50%; display: block;';
                document.body.appendChild(this.element);
            }
            show() {
                this.element.style.display = 'block';
            }
            hide() {
                this.element.style.display = 'none';
            }
        }
        Login.getInstance = (function () {
            let instance;
            return function () {
                if (!instance) {
                    instance = new Login();
                }
                return instance;
            }
        })();

        document.getElementById('show-button').addEventListener('click', function (event) {
            Login.getInstance().show();
        });
        document.getElementById('hide-button').addEventListener('click', function (event) {
            Login.getInstance().hide();
        });
    &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre>
<h5 id="t525.3.4 store">5.3.4 store <a href="#t525.3.4 store"> # </a></h5>
<ul>
<li><a href="https://github.com/reduxjs/redux/blob/master/src/createStore.ts">createStore.ts</a></li>
</ul>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createStore</span>(<span class="hljs-params">reducer: any</span>) </span>{
    <span class="hljs-keyword">let</span> state: any;
    <span class="hljs-keyword">let</span> listeners: any[] = [];
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getState</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> state;
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dispatch</span>(<span class="hljs-params">action: any</span>) </span>{
        state = reducer(state, action);
        listeners.forEach(<span class="hljs-function"><span class="hljs-params">l</span> =&gt;</span> l());
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subscribe</span>(<span class="hljs-params">listener: any</span>) </span>{
        listeners.push(listener);
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            listeners = listeners.filter(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item != listener);
            <span class="hljs-built_in">console</span>.log(listeners);
        }
    }
    dispatch({});
    <span class="hljs-keyword">return</span> {
        getState,
        dispatch,
        subscribe
    }
}
<span class="hljs-keyword">let</span> store = createStore(<span class="hljs-function">(<span class="hljs-params">state: any, action: any</span>) =&gt;</span> state);
</code></pre>
<h5 id="t535.3.5 缓存">5.3.5 缓存 <a href="#t535.3.5 缓存"> # </a></h5>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">let</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">let</span> cache: Record&lt;any, any&gt; = {};
<span class="hljs-keyword">let</span> app = express();
app.get(<span class="hljs-string">'/user/:id'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req: any, res: any</span>) </span>{
    <span class="hljs-keyword">let</span> id = req.params.id;
    <span class="hljs-keyword">let</span> user = cache.get(id);
    <span class="hljs-keyword">if</span> (user) {
        res.json(user);
    } <span class="hljs-keyword">else</span> {
        fs.readFile(<span class="hljs-string">`./users/<span class="hljs-subst">${id}</span>.json`</span>, <span class="hljs-string">'utf8'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err: any, data: any</span>) </span>{
            <span class="hljs-keyword">let</span> user = <span class="hljs-built_in">JSON</span>.parse(data);
            cache.put(id, user);
            res.json(user);
        });
    }
});
app.listen(<span class="hljs-number">3000</span>);
</code></pre>
<h2 id="t546. 适配器模式">6. 适配器模式 <a href="#t546. 适配器模式"> # </a></h2>
<ul>
<li>适配器模式又称包装器模式,将一个类的接口转化为用户需要的另一个接口,解决类(对象)之间接口不兼容的问题</li>
<li>旧的接口和使用者不兼容</li>
<li>中间加一个适配器转换接口</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/myadapor.jpg" alt="myadapor"></p>
<h4 id="t556.1 类图">6.1 类图 <a href="#t556.1 类图"> # </a></h4>
<p><img src="http://img.zhufengpeixun.cn/poweradaptor4.png" alt="poweradaptor4"></p>
<p><img src="http://img.zhufengpeixun.cn/myadapters.png" alt="myadapters"></p>
<h4 id="t566.2 代码">6.2 代码 <a href="#t566.2 代码"> # </a></h4>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Socket</span> </span>{
    output() {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'输出220V'</span>;
    }
}

abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Power</span> </span>{
    abstract charge(): string;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PowerAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Power</span> </span>{
    <span class="hljs-keyword">constructor</span>(public socket: Socket) {
        <span class="hljs-keyword">super</span>();
    }
    <span class="hljs-comment">//转换后的接口和转换前不一样</span>
    charge() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.socket.output() + <span class="hljs-string">' 经过转换 输出24V'</span>;
    }
}
<span class="hljs-keyword">let</span> powerAdapter = <span class="hljs-keyword">new</span> PowerAdapter(<span class="hljs-keyword">new</span> Socket());
<span class="hljs-built_in">console</span>.log(powerAdapter.charge());
</code></pre>
<h4 id="t576.3 场景">6.3 场景 <a href="#t576.3 场景"> # </a></h4>
<h5 id="t586.2.1 axios">6.2.1 axios <a href="#t586.2.1 axios"> # </a></h5>
<ul>
<li><a href="https://github.com/axios/axios/blob/master/lib/core/Axios.js#L6">Axios</a></li>
<li><a href="https://github.com/axios/axios/blob/master/lib/core/dispatchRequest.js#L50-L79">dispatchRequest</a></li>
<li><a href="https://github.com/axios/axios/blob/master/lib/defaults.js#L16-L26">defaults</a></li>
<li><a href="https://github.com/axios/axios/blob/dc4bc49673943e35280e5df831f5c3d0347a9393/lib/adapters/xhr.js">xhr</a></li>
<li><a href="https://github.com/axios/axios/blob/dc4bc49673943e35280e5df831f5c3d0347a9393/lib/adapters/http.js">http</a></li>
<li>适配器的入参都是<code>config</code>,返回的都是<code>promise</code></li>
</ul>
<pre><code class="lang-js"><span class="hljs-comment">//let axios = require('axios');</span>
<span class="hljs-keyword">let</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">axios</span>(<span class="hljs-params">config: any</span>): <span class="hljs-title">any</span> </span>{
    <span class="hljs-keyword">let</span> adaptor = getDefaultAdapter();
    <span class="hljs-keyword">return</span> adaptor(config);
}
axios({
    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
    <span class="hljs-attr">url</span>: <span class="hljs-string">'http://localhost:8080/api/user?id=1'</span>
}).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response: any</span>) </span>{
    <span class="hljs-built_in">console</span>.log(response);
}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error: any</span>) </span>{
    <span class="hljs-built_in">console</span>.log(error);
})

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">xhr</span>(<span class="hljs-params">config: any</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>{
        <span class="hljs-keyword">var</span> request = <span class="hljs-keyword">new</span> XMLHttpRequest();
        request.open(config.method, config.url, <span class="hljs-literal">true</span>);
        request.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (request.readyState == <span class="hljs-number">4</span>) {
                <span class="hljs-keyword">if</span> (request.status == <span class="hljs-number">200</span>) {
                    resolve(request.response);
                } <span class="hljs-keyword">else</span> {
                    reject(<span class="hljs-string">'请求失败'</span>);
                }
            }
        }
    })
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">http</span>(<span class="hljs-params">config: any</span>) </span>{
    <span class="hljs-keyword">let</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
    <span class="hljs-keyword">let</span> urlObject = url.parse(config.url);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>{
        <span class="hljs-keyword">const</span> options = {
            <span class="hljs-attr">hostname</span>: urlObject.hostname,
            <span class="hljs-attr">port</span>: urlObject.port,
            <span class="hljs-attr">path</span>: urlObject.pathname,
            <span class="hljs-attr">method</span>: config.method
        };
        <span class="hljs-keyword">var</span> req = http.request(options, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res: any</span>) </span>{
            <span class="hljs-keyword">let</span> chunks: any[] = [];
            res.on(<span class="hljs-string">'data'</span>, (chunk: any) =&gt; {
                chunks.push(chunk);
            });
            res.on(<span class="hljs-string">'end'</span>, () =&gt; {
                resolve(Buffer.concat(chunks).toString());
            });
        });
        req.on(<span class="hljs-string">'error'</span>, (err: any) =&gt; {
            reject(err);
        });
        req.end();
    })
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDefaultAdapter</span>(<span class="hljs-params"></span>): <span class="hljs-title">any</span> </span>{
    <span class="hljs-keyword">var</span> adapter;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> XMLHttpRequest !== <span class="hljs-string">'undefined'</span>) {
        adapter = xhr;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> process !== <span class="hljs-string">'undefined'</span>) {
        adapter = http;
    }
    <span class="hljs-keyword">return</span> adapter;
}
</code></pre>
<p>server.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">let</span> app = express();
app.get(<span class="hljs-string">'/api/user'</span>, (req, res) =&gt; {
    res.json({ <span class="hljs-attr">id</span>: req.query.id, <span class="hljs-attr">name</span>: <span class="hljs-string">'zhufeng'</span> });
});
app.listen(<span class="hljs-number">8080</span>);
</code></pre>
<h5 id="t596.2.2 toAxiosAdapter">6.2.2 toAxiosAdapter <a href="#t596.2.2 toAxiosAdapter"> # </a></h5>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toAxiosAdapter</span>(<span class="hljs-params">options: any</span>) </span>{
    <span class="hljs-keyword">return</span> axios({
        <span class="hljs-attr">url</span>: options.url,
        <span class="hljs-attr">method</span>: options.type
    }).then(options.success)
        .catch(options.error)
}


$.ajax = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">options: any</span>) </span>{
    <span class="hljs-keyword">return</span> toAxiosAdapter(options)
}

$.ajax({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/user'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'GET'</span>,
    <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data: any</span>) </span>{
        <span class="hljs-built_in">console</span>.log(data)
    },
    <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err: any</span>) </span>{
        <span class="hljs-built_in">console</span>.error(err);
    }
})
</code></pre>
<h5 id="t606.2.3 promisify">6.2.3 promisify <a href="#t606.2.3 promisify"> # </a></h5>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">var</span> Bluebird = <span class="hljs-built_in">require</span>(<span class="hljs-string">"bluebird"</span>);
<span class="hljs-keyword">let</span> readFile = Bluebird.promisify(fs.readFile);

(<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">let</span> content = <span class="hljs-keyword">await</span> readFile(<span class="hljs-string">'./1.txt'</span>, <span class="hljs-string">'utf8'</span>);
    <span class="hljs-built_in">console</span>.log(content);
})()
</code></pre>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">promisify</span>(<span class="hljs-params">readFile: any</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">filename: any, encoding: any</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>{
            readFile(filename, encoding, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err: any, data: any</span>) </span>{
                <span class="hljs-keyword">if</span> (err)
                    reject(err);
                <span class="hljs-keyword">else</span>
                    resolve(data);
            })
        });
    }
}
</code></pre>
<h5 id="t616.2.4 computed">6.2.4 computed <a href="#t616.2.4 computed"> # </a></h5>
<pre><code class="lang-js">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="ie=edge"&gt;
    &lt;script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"&gt;&lt;/script&gt;
    &lt;title&gt;vue&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id="root"&gt;
&lt;p&gt;{{name}}&lt;/p&gt;
&lt;p&gt;{{upperName}}&lt;/p&gt;
&lt;/div&gt;    
&lt;script&gt;
let vm=new Vue({
    el: '#root',
    data: {
        name:'zfpx'
    },
    computed: {
        upperName() {
            return this.name.toUpperCase();
        }
    }
});
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h5 id="t626.2.5 tree">6.2.5 tree <a href="#t626.2.5 tree"> # </a></h5>
<ul>
<li>树型结构数据在下拉框中显示</li>
</ul>
<pre><code class="lang-js">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="ie=edge"&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;select id="users"&gt;&lt;/select&gt;
    &lt;script&gt;
        let tree = [{
            name: '父亲',
            key: '1',
            children: [
                {
                    name: '儿子',
                    key: '1-1',
                    children: [
                        {
                            name: '孙子',
                            key: '1-1-1'
                        }
                    ]
                }
            ]
        }]
        function flattenAdapter(tree, flattenArray) {
            tree.forEach((item) =&gt; {
                if (item.children) {
                    flattenAdapter(item.children, flattenArray)
                }
                flattenArray.push({ name: item.name, key: item.key })
            })
            return flattenArray
        }
        let array = [];
        flattenAdapter(tree, array);
        array.reverse();
        let users = document.getElementById('users');
        let options = array.map(item =&gt; `&lt;option value="${item.key}"&gt;${item.name}&lt;/option&gt;`).join('');
        users.innerHTML = options;
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h5 id="t636.2.6 Sequelize">6.2.6 Sequelize <a href="#t636.2.6 Sequelize"> # </a></h5>
<ul>
<li><a href="https://github.com/demopark/sequelize-docs-Zh-CN/tree/master">sequelize</a></li>
</ul>
<pre><code class="lang-js"><span class="hljs-comment">//cnpm i sequelize sqlite3 -S</span>
<span class="hljs-keyword">const</span> { Sequelize, Model, DataTypes } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sequelize'</span>);
<span class="hljs-keyword">const</span> sequelize = <span class="hljs-keyword">new</span> Sequelize(<span class="hljs-string">'sqlite::memory:'</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span> </span>{ }
User.init({
    <span class="hljs-attr">username</span>: DataTypes.STRING
}, { sequelize, <span class="hljs-attr">modelName</span>: <span class="hljs-string">'user'</span> });

sequelize.sync()
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> User.create({
        <span class="hljs-attr">username</span>: <span class="hljs-string">'zhufeng'</span>
    }))
    .then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(result.toJSON());
    });
</code></pre>
<h2 id="t647.装饰器模式">7.装饰器模式 <a href="#t647.装饰器模式"> # </a></h2>
<ul>
<li>在不改变其原有的结构和功能为对象添加新功能的模式其实就叫做装饰器模式</li>
<li>最直观地就是我们买房后的装修</li>
<li>装饰比继承更加灵活,可以实现装饰者和被装饰者之间松耦合</li>
<li>被装饰者可以使用装饰者动态地增加和撤销功能</li>
</ul>
<h4 id="t657.1 类图">7.1 类图 <a href="#t657.1 类图"> # </a></h4>
<p><img src="http://img.zhufengpeixun.cn/shapedecorator.png" alt="shapedecorator"></p>
<h4 id="t667.2 代码">7.2 代码 <a href="#t667.2 代码"> # </a></h4>
<pre><code class="lang-js">
abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shape</span> </span>{
    abstract draw(): <span class="hljs-keyword">void</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Shape</span> </span>{
    draw() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'绘制圆形'</span>);
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rectangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Shape</span> </span>{
    draw() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'绘制矩形'</span>);
    }
}

abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ColorfulShape</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Shape</span> </span>{
    public <span class="hljs-keyword">constructor</span>(public shape: Shape) {
        <span class="hljs-keyword">super</span>();
    }
    abstract draw(): <span class="hljs-keyword">void</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedColorfulShape</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ColorfulShape</span> </span>{
    draw() {
        <span class="hljs-keyword">this</span>.shape.draw();
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'把边框涂成红色'</span>);
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GreenColorfulShape</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ColorfulShape</span> </span>{
    draw() {
        <span class="hljs-keyword">this</span>.shape.draw();
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'把边框涂成绿色'</span>);
    }
}

<span class="hljs-keyword">let</span> circle = <span class="hljs-keyword">new</span> Circle();
<span class="hljs-keyword">let</span> redColorfulShape = <span class="hljs-keyword">new</span> RedColorfulShape(circle);
redColorfulShape.draw();

<span class="hljs-keyword">let</span> rectangle = <span class="hljs-keyword">new</span> Rectangle();
<span class="hljs-keyword">let</span> greenColorfulShape = <span class="hljs-keyword">new</span> GreenColorfulShape(rectangle);
greenColorfulShape.draw();
</code></pre>
<h4 id="t677.3 应用场景">7.3 应用场景 <a href="#t677.3 应用场景"> # </a></h4>
<h5 id="t687.3.1  装饰器">7.3.1  装饰器 <a href="#t687.3.1  装饰器"> # </a></h5>
<ul>
<li>装饰器是一种特殊类型的声明，它能够被附加到类声明、方法、属性或参数上，可以修改类的行为</li>
<li>常见的装饰器有类装饰器、属性装饰器、方法装饰器和参数装饰器</li>
<li>装饰器的写法分为普通装饰器和装饰器工厂</li>
</ul>
<h6 id="t697.3.1.1 类装饰器">7.3.1.1 类装饰器 <a href="#t697.3.1.1 类装饰器"> # </a></h6>
<ul>
<li>类装饰器在类声明之前声明，用来监控、修改或替换类定义</li>
<li>参数是类的定义或者说构造函数</li>
<li><a href="https://babeljs.io/docs/en/babel-plugin-proposal-decorators">babel-plugin-proposal-decorators</a></li>
</ul>
<p>decorator</p>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> { }
namespace decorator {
    interface Animal {
        <span class="hljs-attr">swings</span>: string;
        fly: any
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">flyable</span>(<span class="hljs-params">target: any</span>) </span>{
        <span class="hljs-built_in">console</span>.log(target);

        target.prototype.swings = <span class="hljs-number">2</span>;
        target.prototype.fly = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'I can fly'</span>);
        }
    }
    @flyable
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span> </span>{
        <span class="hljs-keyword">constructor</span>() { }
    }
    <span class="hljs-keyword">let</span> animal: Animal = <span class="hljs-keyword">new</span> Animal();
    <span class="hljs-built_in">console</span>.log(animal.swings);
    animal.fly();
}
</code></pre>
<p>decorator_factory</p>
<pre><code class="lang-js">namespace decorator_factory {
    interface Animal {
        <span class="hljs-attr">swings</span>: string;
        fly: any
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">flyable</span>(<span class="hljs-params">swings: number</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">flyable</span>(<span class="hljs-params">target: any</span>) </span>{
            <span class="hljs-built_in">console</span>.log(target);

            target.prototype.swings = swings;
            target.prototype.fly = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'I can fly'</span>);
            }
        }
    }

    @flyable(<span class="hljs-number">2</span>)
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span> </span>{
        <span class="hljs-keyword">constructor</span>() { }
    }
    <span class="hljs-keyword">let</span> animal: Animal = <span class="hljs-keyword">new</span> Animal();
    <span class="hljs-built_in">console</span>.log(animal.swings);
    animal.fly();
}
</code></pre>
<h6 id="t707.3.1.2  属性装饰器">7.3.1.2  属性装饰器 <a href="#t707.3.1.2  属性装饰器"> # </a></h6>
<ul>
<li>属性装饰器表达式会在运行时当作函数被调用</li>
<li>属性分为实例属性和类属性</li>
<li>方法分为实例方法和类方法</li>
</ul>
<pre><code class="lang-js">namespace property_namespace {
    <span class="hljs-comment">//实例属性target是类的原型对象,key是属性名称</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">instancePropertyDecorator</span>(<span class="hljs-params">target: any, key: string</span>) </span>{
    }
    <span class="hljs-comment">//类属性target是的构造函数</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">classPropertyDecorator</span>(<span class="hljs-params">target: any, key: string</span>) </span>{
    }
    <span class="hljs-comment">//实例方法装饰器target是原型对象,key方法名,descriptor是方法描述符</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">instanceMethodDecorator</span>(<span class="hljs-params">target: any, key: string, descriptor: PropertyDescriptor</span>) </span>{
    }
    <span class="hljs-comment">//类方法装饰器target是类的构造函数</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">classMethodDecorator</span>(<span class="hljs-params">target: any, key: string, descriptor: PropertyDescriptor</span>) </span>{
    }
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{
        @instancePropertyDecorator
        <span class="hljs-attr">instanceProperty</span>: string;
        @classPropertyDecorator
        public <span class="hljs-keyword">static</span> classProperty: string;
        @instanceMethodDecorator
        instanceMethod() {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'instanceMethod'</span>);
        }
        @classMethodDecorator
        classMethod() {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'classMethod'</span>);
        }
    }
}
</code></pre>
<h6 id="t717.3.1.3 core-decorator">7.3.1.3 core-decorator <a href="#t717.3.1.3 core-decorator"> # </a></h6>
<ul>
<li><a href="https://github.com/jayphelps/core-decorators">core-decorator</a></li>
<li><a href="https://github.com/jayphelps/core-decorators#deprecate-alias-deprecated">deprecate-alias-deprecated</a></li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> { readonly } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'core-decorators'</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deprecate</span>(<span class="hljs-params">msg: string, options: any</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">target: any, attr: any, descriptor: any</span>) </span>{
        <span class="hljs-comment">//DEPRECATION Calculator#add: This function will be removed in future versions.</span>
        <span class="hljs-keyword">let</span> oldVal = descriptor.value;
        descriptor.value = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">...args: any[]</span>) </span>{
            <span class="hljs-keyword">let</span> message = msg ? msg : <span class="hljs-string">`DEPRECATION <span class="hljs-subst">${target.constructor.name}</span>#<span class="hljs-subst">${attr}</span>: This function will be removed in future versions.`</span>;
            <span class="hljs-keyword">let</span> see = options &amp;&amp; options.url ? <span class="hljs-string">`see <span class="hljs-subst">${options.url}</span>`</span> : <span class="hljs-string">``</span>;
            <span class="hljs-built_in">console</span>.warn(message + <span class="hljs-string">'\r\n'</span> + see);
            <span class="hljs-keyword">return</span> oldVal(...args);
        }
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Calculator</span> </span>{
    @deprecate(<span class="hljs-string">'stop using this'</span>, { <span class="hljs-attr">url</span>: <span class="hljs-string">'http://www.baidu.com'</span> })
    add(a: number, <span class="hljs-attr">b</span>: number) {
        <span class="hljs-keyword">return</span> a + b;
    }
}
<span class="hljs-keyword">let</span> calculator = <span class="hljs-keyword">new</span> Calculator();
calculator.add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
</code></pre>
<h5 id="t727.3.2  AOP概念">7.3.2  AOP概念 <a href="#t727.3.2  AOP概念"> # </a></h5>
<ul>
<li>在软件业，AOP为<code>Aspect Oriented Programming</code>的缩写,意为面向切面编程</li>
<li>可以通过预编译方式和运行期动态代理实现在不修改源代码的情况下给程序动态统一添加功能的一种技术</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/springaop2.jpeg" alt="springaop"></p>
<p><img src="http://img.zhufengpeixun.cn/apoprogram.jpg" alt="apoprogram"></p>
<h5 id="t737.3.3 埋点">7.3.3 埋点 <a href="#t737.3.3 埋点"> # </a></h5>
<ul>
<li>埋点分析: 是网站分析的一种常用的数据采集方法</li>
<li>无痕埋点: 通过技术手段，完成对用户行为数据无差别的统计上传的工作,后期数据分析处理的时候通过技术手段筛选出合适的数据进行统计分析</li>
</ul>
<h6 id="t747.3.3.1 项目配置">7.3.3.1 项目配置 <a href="#t747.3.3.1 项目配置"> # </a></h6>
<ol>
<li>创建项目</li>
</ol>
<pre><code class="lang-js">create-react-app zhufeng_tract
yarn add customize-cra react-app-rewired --dev
</code></pre>
<ol start="2">
<li><p>config-overrides.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> {
 override,
 addDecoratorsLegacy,
} = <span class="hljs-built_in">require</span>(<span class="hljs-string">"customize-cra"</span>);
<span class="hljs-built_in">module</span>.exports = override(
 addDecoratorsLegacy(),
);
</code></pre>
</li>
<li><p>jsconfig.json</p>
<pre><code class="lang-js">{
 <span class="hljs-string">"compilerOptions"</span>: {
     <span class="hljs-string">"experimentalDecorators"</span>: <span class="hljs-literal">true</span>
 }
}
</code></pre>
</li>
</ol>
<h6 id="t757.3.3.2 index.js">7.3.3.2 index.js <a href="#t757.3.3.2 index.js"> # </a></h6>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { render } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;
<span class="hljs-keyword">import</span> { before, after } <span class="hljs-keyword">from</span> <span class="hljs-string">'./track'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    @before(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'点击方法执行前'</span>))
    onClickBeforeButton() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'beforeClick'</span>);
    }

    @after(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'点击方法执行后'</span>))
    onClickAfterButton() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'afterClick'</span>);
    }

    @after(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> fetch(<span class="hljs-string">'/api/report'</span>))
    onClickAjaxButton() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ajaxClick'</span>);
    }

    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.onClickBeforeButton}</span>&gt;</span>beforeClick<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.onClickAfterButton}</span>&gt;</span>afterClick<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.onClickAjaxButton}</span>&gt;</span>ajaxClick<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}
render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'root'</span>));
</code></pre>
<h6 id="t767.3.3.3 track.js">7.3.3.3 track.js <a href="#t767.3.3.3 track.js"> # </a></h6>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> before = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">beforeFn</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">target, methodName, descriptor</span>) </span>{
        <span class="hljs-keyword">let</span> oldMethod = descriptor.value;
        descriptor.value = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            beforeFn.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
            <span class="hljs-keyword">return</span> oldMethod.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
        }
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> after = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">afterFn</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">target, methodName, descriptor</span>) </span>{
        <span class="hljs-keyword">let</span> oldMethod = descriptor.value;
        descriptor.value = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            oldMethod.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
            afterFn.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
        }
    }
}
</code></pre>
<h5 id="t777.3.4 表单校验">7.3.4 表单校验 <a href="#t777.3.4 表单校验"> # </a></h5>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>用户注册<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">""</span>&gt;</span>
        用户名<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"username"</span>&gt;</span>
        密码<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"password"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"submit-btn"</span>&gt;</span>注册<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-built_in">Function</span>.prototype.before = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">beforeFn</span>) </span>{
            <span class="hljs-keyword">let</span> _this = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">let</span> ret = beforeFn.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
                <span class="hljs-keyword">if</span> (ret)
                    _this.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
            }
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">submit</span>(<span class="hljs-params"></span>) </span>{
            alert(<span class="hljs-string">'提交表单'</span>);
        }
        submit = submit.before(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">let</span> username = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'username'</span>).value;
            <span class="hljs-keyword">if</span> (username.length &lt; <span class="hljs-number">6</span>) {
                <span class="hljs-keyword">return</span> alert(<span class="hljs-string">'用户名不能少于6位'</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        });
        submit = submit.before(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">let</span> username = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'username'</span>).value;
            <span class="hljs-keyword">if</span> (!username) {
                <span class="hljs-keyword">return</span> alert(<span class="hljs-string">'用户名不能为空'</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        });
        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'submit-btn'</span>).addEventListener(<span class="hljs-string">'click'</span>, submit);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 id="t788.代理模式">8.代理模式 <a href="#t788.代理模式"> # </a></h2>
<ul>
<li>由于一个对象不能直接引用另外一个对象，所以需要通过代理对象在这两个对象之间起到中介作用</li>
<li>代理模式就是为目标对象创造一个代理对象，以实现对目标对象的访问</li>
<li>这样就可以在代理对象里增加一些逻辑判断、调用前或调用后执行一些操作，从而实现了扩展目标的功能</li>
<li>火车票代购、房产中介、律师、海外代购、明星经纪人</li>
</ul>
<h4 id="t798.1 类图">8.1 类图 <a href="#t798.1 类图"> # </a></h4>
<ul>
<li>Target 目标对象，也就是被代理的对象，是具体业务的执行者</li>
<li>Proxy 代理对象，里面会包含一个目标对象的引用，可以实现对访问的扩展和额外处理</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/proxystar.png" alt="proxystar"></p>
<h4 id="t808.2 代码">8.2 代码 <a href="#t808.2 代码"> # </a></h4>
<pre><code class="lang-js">abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Star</span> </span>{
    abstract answerPhone(): <span class="hljs-keyword">void</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Angelababy</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Star</span> </span>{
    public available: boolean = <span class="hljs-literal">true</span>;
    answerPhone(): <span class="hljs-keyword">void</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'你好,我是Angelababy.'</span>);
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AngelababyAgent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Star</span> </span>{
    <span class="hljs-keyword">constructor</span>(private angelababy: Angelababy) {
        <span class="hljs-keyword">super</span>();
    }
    answerPhone(): <span class="hljs-keyword">void</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'你好,我是Angelababy的经纪人.'</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.angelababy.available) {
            <span class="hljs-keyword">this</span>.angelababy.answerPhone();
        }
    }
}
<span class="hljs-keyword">let</span> angelababyAgent = <span class="hljs-keyword">new</span> AngelababyAgent(<span class="hljs-keyword">new</span> Angelababy());
angelababyAgent.answerPhone();
</code></pre>
<h4 id="t818.3 场景">8.3 场景 <a href="#t818.3 场景"> # </a></h4>
<h5 id="t828.3.1 事件委托代理">8.3.1 事件委托代理 <a href="#t828.3.1 事件委托代理"> # </a></h5>
<ul>
<li>事件捕获指的是从document到触发事件的那个节点，即自上而下的去触发事件</li>
<li>事件冒泡是自下而上的去触发事件</li>
<li>绑定事件方法的第三个参数，就是控制事件触发顺序是否为事件捕获。true为事件捕获；false为事件冒泡,默认false。</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/captureevent.jpg" alt="captureevent"></p>
<pre><code class="lang-js">&lt;body&gt;
    &lt;ul id="list"&gt;
        &lt;li&gt;1&lt;/li&gt;
        &lt;li&gt;2&lt;/li&gt;
        &lt;li&gt;3&lt;/li&gt;
    &lt;/ul&gt;
&lt;script&gt;
  let list = document.querySelector('#list');
  list.addEventListener('click',event=&gt;{
       alert(event.target.innerHTML);
  });     
&lt;/script&gt;    
&lt;/body&gt;
</code></pre>
<h5 id="t838.3.2 虚拟代理(图片预加载)">8.3.2 虚拟代理(图片预加载) <a href="#t838.3.2 虚拟代理(图片预加载)"> # </a></h5>
<ul>
<li><a href="http://img.zhufengpeixun.cn/bg-images.zip">bg-images</a></li>
</ul>
<h6 id="t848.3.2.1 app.js">8.3.2.1 app.js <a href="#t848.3.2.1 app.js"> # </a></h6>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> express=<span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">let</span> path=<span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">let</span> app=express();
app.get(<span class="hljs-string">'/images/loading.gif'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req,res</span>) </span>{
    res.sendFile(path.join(__dirname,req.path));
});
app.get(<span class="hljs-string">'/images/:name'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req,res</span>) </span>{
    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        res.sendFile(path.join(__dirname,req.path));
    }, <span class="hljs-number">2000</span>);
});
app.get(<span class="hljs-string">'/'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req,res</span>) </span>{
    res.sendFile(path.resolve(<span class="hljs-string">'index.html'</span>));
});
app.listen(<span class="hljs-number">8080</span>);
</code></pre>
<h6 id="t858.3.2.2 index.html">8.3.2.2 index.html <a href="#t858.3.2.2 index.html"> # </a></h6>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.bg-container</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">600px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">100px</span> auto;
        }

        <span class="hljs-selector-class">.bg-container</span> <span class="hljs-selector-id">#bg-image</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"background"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">data-src</span>=<span class="hljs-string">"/images/bg1.jpg"</span>&gt;</span>背景1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">data-src</span>=<span class="hljs-string">"/images/bg2.jpg"</span>&gt;</span>背景2<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bg-image"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/images/bg1.jpg"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">let</span> container = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#background'</span>);

        <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BackgroundImage</span> </span>{
            <span class="hljs-keyword">constructor</span>() {
                <span class="hljs-keyword">this</span>.bgImage = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#bg-image'</span>);
            }
            setSrc(src) {
                <span class="hljs-keyword">this</span>.bgImage.src = src;
            }
        }
        <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoadingBackgroundImage</span> </span>{ 
             <span class="hljs-keyword">static</span> LOADING_URL= <span class="hljs-string">`/images/loading.gif`</span>;
            <span class="hljs-keyword">constructor</span>() {
                <span class="hljs-keyword">this</span>.backgroundImage = <span class="hljs-keyword">new</span> BackgroundImage();
            }
            setSrc(src) {
                <span class="hljs-keyword">this</span>.backgroundImage.setSrc(LoadingBackgroundImage.LOADING_URL);
                <span class="hljs-keyword">let</span> img = <span class="hljs-keyword">new</span> Image();
                img.onload = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                    <span class="hljs-keyword">this</span>.backgroundImage.setSrc(src);
                }
                img.src = src;
            }
        }
        <span class="hljs-keyword">let</span> loadingBackgroundImage = <span class="hljs-keyword">new</span> LoadingBackgroundImage();
        container.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
            <span class="hljs-keyword">let</span> src = event.target.dataset.src;
            loadingBackgroundImage.setSrc(src + <span class="hljs-string">'?ts='</span> + <span class="hljs-built_in">Date</span>.now());
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h5 id="t868.3.3 虚拟代理(图片懒加载)">8.3.3 虚拟代理(图片懒加载) <a href="#t868.3.3 虚拟代理(图片懒加载)"> # </a></h5>
<ul>
<li>当前可视区域的高度 <code>window.innerHeight || document.documentElement.clientHeight</code></li>
<li>元素距离可视区域顶部的高度 <code>getBoundingClientRect().top</code></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect">getBoundingClientRect</a></li>
<li>DOMRect 对象包含了一组用于描述边框的只读属性——left、top、right 和 bottom，单位为像素。除了 width 和 height 外的属性都是相对于视口的左上角位置而言的</li>
</ul>
<h6 id="t878.3.3.1 index.html">8.3.3.1 index.html <a href="#t878.3.3.1 index.html"> # </a></h6>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Lazy-Load<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.image</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#CCC</span>;
        }

        <span class="hljs-selector-class">.image</span> <span class="hljs-selector-tag">img</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">data-src</span>=<span class="hljs-string">"/images/bg1.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">data-src</span>=<span class="hljs-string">"/images/bg2.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">data-src</span>=<span class="hljs-string">"/images/bg1.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">data-src</span>=<span class="hljs-string">"/images/bg2.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">data-src</span>=<span class="hljs-string">"/images/bg1.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">data-src</span>=<span class="hljs-string">"/images/bg2.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">data-src</span>=<span class="hljs-string">"/images/bg1.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">data-src</span>=<span class="hljs-string">"/images/bg2.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">data-src</span>=<span class="hljs-string">"/images/bg1.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">data-src</span>=<span class="hljs-string">"/images/bg2.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> imgs = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'img'</span>);
    <span class="hljs-keyword">const</span> clientHeight = <span class="hljs-built_in">window</span>.innerHeight || <span class="hljs-built_in">document</span>.documentElement.clientHeight;
    <span class="hljs-keyword">let</span> loadedIndex = <span class="hljs-number">0</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lazyload</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = loadedIndex; i &lt; imgs.length; i++) {
            <span class="hljs-keyword">if</span> (clientHeight - imgs[i].getBoundingClientRect().top &gt; <span class="hljs-number">0</span>) {
                imgs[i].src = imgs[i].dataset.src;
                loadedIndex = i + <span class="hljs-number">1</span>;
            }
        }
    }
    lazyload();
    <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'scroll'</span>, lazyload, <span class="hljs-literal">false</span>);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h5 id="t888.3.4 缓存代理">8.3.4 缓存代理 <a href="#t888.3.4 缓存代理"> # </a></h5>
<ul>
<li>有些时候可以用空间换时间</li>
<li>一个正整数的阶乘（factorial）是所有小于及等于该数的正整数的积，并且0的阶乘为1</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> factorial = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span>(<span class="hljs-params">num</span>) </span>{
    <span class="hljs-keyword">if</span> (num === <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> (num * f(num - <span class="hljs-number">1</span>));
    }
}

<span class="hljs-keyword">const</span> proxy = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">const</span> cache = {};  <span class="hljs-comment">// 缓存对象</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">num</span>) </span>{
        <span class="hljs-keyword">if</span> (num <span class="hljs-keyword">in</span> cache) {
            <span class="hljs-keyword">return</span> cache[num];   <span class="hljs-comment">// 使用缓存代理</span>
        }
        <span class="hljs-keyword">return</span> cache[num] = fn.call(<span class="hljs-keyword">this</span>, num);
    }
}

<span class="hljs-keyword">const</span> proxyFactorial = proxy(factorial);
<span class="hljs-built_in">console</span>.log(proxyFactorial(<span class="hljs-number">5</span>));
<span class="hljs-built_in">console</span>.log(proxyFactorial(<span class="hljs-number">5</span>));
<span class="hljs-built_in">console</span>.log(proxyFactorial(<span class="hljs-number">5</span>));
</code></pre>
<ul>
<li>斐波那契数列(Fibonacci sequence)指的是这样一个数列：1、1、2、3、5、8、13、21、34。在数学上，斐波那契数列以如下被以递推的方法定义：F(1)=1,F(2)=1,F(n)=F(n-1)+F(n-2)（n&gt;=3，n∈N*）</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fib</span>(<span class="hljs-params">n</span>) </span>{
    count++;
    <span class="hljs-keyword">return</span> n &lt;= <span class="hljs-number">2</span> ? <span class="hljs-number">1</span> : fib(n - <span class="hljs-number">1</span>) + fib(n - <span class="hljs-number">2</span>);
}
<span class="hljs-keyword">var</span> result = fib(<span class="hljs-number">10</span>);
<span class="hljs-built_in">console</span>.log(result, count);<span class="hljs-comment">//55 110</span>
</code></pre>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> fibWithCache = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">let</span> cache = {};
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fib</span>(<span class="hljs-params">n</span>) </span>{
        count++;
        <span class="hljs-keyword">if</span> (cache[n]) {
            <span class="hljs-keyword">return</span> cache[n];
        }
        <span class="hljs-keyword">let</span> result = n &lt;= <span class="hljs-number">2</span> ? <span class="hljs-number">1</span> : fib(n - <span class="hljs-number">1</span>) + fib(n - <span class="hljs-number">2</span>);
        cache[n] = result;
        <span class="hljs-keyword">return</span> result;
    }
    <span class="hljs-keyword">return</span> fib;
})();
<span class="hljs-keyword">var</span> result = fibWithCache(<span class="hljs-number">10</span>);
<span class="hljs-built_in">console</span>.log(result, count);<span class="hljs-comment">//55 17</span>
</code></pre>
<h5 id="t898.3.5 防抖代理">8.3.5 防抖代理 <a href="#t898.3.5 防抖代理"> # </a></h5>
<ul>
<li>通过防抖代理优化可以把多次请求合并为一次，提高性能</li>
<li>节流与防抖都是为了减少频繁触发事件回调</li>
<li>节流(Throttle)是在某段时间内不管触发了多少次回调都只认第一个，并在第一次结束后执行回调</li>
<li>防抖(Debounce)就是在某段时间不管触发了多少回调都只看最后一个</li>
</ul>
<h6 id="t908.3.5.1 节流">8.3.5.1 节流 <a href="#t908.3.5.1 节流"> # </a></h6>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-id">#container</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid red;
            <span class="hljs-attribute">overflow</span>: auto;
        }

        <span class="hljs-selector-id">#container</span> <span class="hljs-selector-class">.content</span> {
            <span class="hljs-attribute">height</span>: <span class="hljs-number">4000px</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">throttle</span>(<span class="hljs-params">callback, interval</span>) </span>{
            <span class="hljs-keyword">let</span> last;
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">let</span> context = <span class="hljs-keyword">this</span>;
                <span class="hljs-keyword">let</span> args = <span class="hljs-built_in">arguments</span>;
                <span class="hljs-keyword">let</span> now = <span class="hljs-built_in">Date</span>.now();
                <span class="hljs-keyword">if</span> (last) {
                    <span class="hljs-keyword">if</span> (now - last &gt;= interval) {
                        last = now;
                        callback.apply(context, args);
                    }
                } <span class="hljs-keyword">else</span> {
                    callback.apply(context, args);
                    last = now;
                }

            }
        }
        <span class="hljs-keyword">let</span> lastTime = <span class="hljs-built_in">Date</span>.now();
        <span class="hljs-keyword">const</span> throttle_scroll = throttle(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'触发了滚动事件'</span>, (<span class="hljs-built_in">Date</span>.now() - lastTime) / <span class="hljs-number">1000</span>);
        }, <span class="hljs-number">1000</span>);
        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'container'</span>).addEventListener(<span class="hljs-string">'scroll'</span>, throttle_scroll);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h6 id="t918.3.5.2 防抖">8.3.5.2 防抖 <a href="#t918.3.5.2 防抖"> # </a></h6>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-id">#container</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid red;
            <span class="hljs-attribute">overflow</span>: auto;
        }

        <span class="hljs-selector-id">#container</span> <span class="hljs-selector-class">.content</span> {
            <span class="hljs-attribute">height</span>: <span class="hljs-number">4000px</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">throttle</span>(<span class="hljs-params">callback, delay</span>) </span>{
            <span class="hljs-keyword">let</span> timer;
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">let</span> context = <span class="hljs-keyword">this</span>;
                <span class="hljs-keyword">let</span> args = <span class="hljs-built_in">arguments</span>;
                <span class="hljs-keyword">if</span> (timer)
                    clearTimeout(timer);
                timer = setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                    callback.apply(context, args);
                }, delay);
            }
        }
        <span class="hljs-keyword">let</span> lastTime = <span class="hljs-built_in">Date</span>.now();
        <span class="hljs-keyword">const</span> throttle_scroll = throttle(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'触发了滚动事件'</span>, (<span class="hljs-built_in">Date</span>.now() - lastTime) / <span class="hljs-number">1000</span>);
        }, <span class="hljs-number">1000</span>);
        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'container'</span>).addEventListener(<span class="hljs-string">'scroll'</span>, throttle_scroll);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h6 id="t928.3.5.3 未防抖">8.3.5.3 未防抖 <a href="#t928.3.5.3 未防抖"> # </a></h6>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"todos"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">let</span> todos = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#todos'</span>);
    <span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        fetch(<span class="hljs-string">'/todos'</span>).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>res.json()).then(<span class="hljs-function"><span class="hljs-params">response</span>=&gt;</span>{
            todos.innerHTML = response.map(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span><span class="hljs-string">`&lt;li "&gt;&lt;input value="<span class="hljs-subst">${item.id}</span>" type="checkbox" <span class="hljs-subst">${item.completed?<span class="hljs-string">"checked"</span>:<span class="hljs-string">""</span>}</span>/&gt;<span class="hljs-subst">${item.text}</span>&lt;/li&gt;`</span>).join(<span class="hljs-string">''</span>);
        });
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toggle</span>(<span class="hljs-params">id</span>)</span>{
       fetch(<span class="hljs-string">`/toggle/<span class="hljs-subst">${id}</span>`</span>).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>res.json()).then(<span class="hljs-function"><span class="hljs-params">response</span>=&gt;</span>{
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'response'</span>,response);
        });
    }
    todos.addEventListener(<span class="hljs-string">'click'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>)</span>{
        <span class="hljs-keyword">let</span> checkbox = event.target;
        <span class="hljs-keyword">let</span> id = checkbox.value;
        toggle(id);
    });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p>app.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> express=<span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">let</span> app=express();
app.use(express.static(__dirname));
<span class="hljs-keyword">let</span> todos=[
    {<span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,<span class="hljs-attr">text</span>: <span class="hljs-string">'a'</span>,<span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>},
    {<span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,<span class="hljs-attr">text</span>: <span class="hljs-string">'b'</span>,<span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>},
    {<span class="hljs-attr">id</span>: <span class="hljs-number">3</span>,<span class="hljs-attr">text</span>: <span class="hljs-string">'c'</span>,<span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>},
];
app.get(<span class="hljs-string">'/todos'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req,res</span>) </span>{
    res.json(todos);
});
app.get(<span class="hljs-string">'/toggle/:id'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req,res</span>) </span>{
    <span class="hljs-keyword">let</span> id=req.params.id;
    todos = todos.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (item.id==id) {
            item.completed=!item.completed;
        }
        <span class="hljs-keyword">return</span> item;
    });
    res.json({<span class="hljs-attr">code</span>:<span class="hljs-number">0</span>});
});
app.listen(<span class="hljs-number">8080</span>);
</code></pre>
<h6 id="t938.3.5.4 防抖">8.3.5.4 防抖 <a href="#t938.3.5.4 防抖"> # </a></h6>
<p>todos.html</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"todos"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">let</span> todos = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#todos'</span>);
    <span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        fetch(<span class="hljs-string">'/todos'</span>).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>res.json()).then(<span class="hljs-function"><span class="hljs-params">response</span>=&gt;</span>{
            todos.innerHTML = response.map(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span><span class="hljs-string">`&lt;li "&gt;&lt;input value="<span class="hljs-subst">${item.id}</span>" type="checkbox" <span class="hljs-subst">${item.completed?<span class="hljs-string">"checked"</span>:<span class="hljs-string">""</span>}</span>/&gt;<span class="hljs-subst">${item.text}</span>&lt;/li&gt;`</span>).join(<span class="hljs-string">''</span>);
        });
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toggle</span>(<span class="hljs-params">id</span>)</span>{
       fetch(<span class="hljs-string">`/toggle/<span class="hljs-subst">${id}</span>`</span>).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>res.json()).then(<span class="hljs-function"><span class="hljs-params">response</span>=&gt;</span>{
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'response'</span>,response);
        });
    }
    <span class="hljs-keyword">let</span> LazyToggle = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>)</span>{
        <span class="hljs-keyword">let</span> ids = [];
        <span class="hljs-keyword">let</span> timer;
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>)</span>{
            ids.push(id);
            <span class="hljs-keyword">if</span>(timer){
               clearTimeout(timer);
            }
            timer = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
                toggle(ids.join(<span class="hljs-string">','</span>));
                ids = <span class="hljs-literal">null</span>;
                clearTimeout(timer);
                timer = <span class="hljs-literal">null</span>;
            },<span class="hljs-number">2000</span>);
        }
    })();
    todos.addEventListener(<span class="hljs-string">'click'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>)</span>{
        <span class="hljs-keyword">let</span> checkbox = event.target;
        <span class="hljs-keyword">let</span> id = checkbox.value;
        LazyToggle(id);
    });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>app.js</p>
<pre><code class="lang-js">app.get(<span class="hljs-string">'/toggle/:ids'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req,res</span>) </span>{
    <span class="hljs-keyword">let</span> ids=req.params.ids;
    ids=ids.split(<span class="hljs-string">','</span>).map(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span><span class="hljs-built_in">parseInt</span>(item));
    todos = todos.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (ids.includes(item.id)) {
            item.completed=!item.completed;
        }
        <span class="hljs-keyword">return</span> item;
    });
    res.json({<span class="hljs-attr">code</span>:<span class="hljs-number">0</span>});
});
</code></pre>
<h5 id="t948.3.6 代理跨域">8.3.6 代理跨域 <a href="#t948.3.6 代理跨域"> # </a></h5>
<h6 id="t958.3.6.1 正向代理和反向代理">8.3.6.1 正向代理和反向代理 <a href="#t958.3.6.1 正向代理和反向代理"> # </a></h6>
<ul>
<li>正向代理的对象是客户端,服务器端看不到真正的客户端</li>
<li>通过公司代理服务器上网</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/positiveproxy.jpg" alt="positiveproxy"></p>
<ul>
<li>反向代理的对象的服务端,客户端看不到真正的服务端</li>
<li>nginx代理应用服务器</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/fanproxy.jpg" alt="fanproxy"></p>
<p>proxy-server.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> httpProxy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http-proxy'</span>);
<span class="hljs-comment">//创建一个代理服务</span>
<span class="hljs-keyword">const</span> proxy = httpProxy.createProxyServer();
<span class="hljs-comment">//创建http服务器并监听8888端口</span>
<span class="hljs-keyword">let</span> server = http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
    <span class="hljs-comment">//将用户的请求转发到本地9999端口上</span>
    proxy.web(req, res, {
        <span class="hljs-attr">target</span>: <span class="hljs-string">'http://127.0.0.1:9999'</span>
    });
    <span class="hljs-comment">//监听代理服务错误</span>
    proxy.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        <span class="hljs-built_in">console</span>.log(err);
    });
});
server.listen(<span class="hljs-number">8888</span>, <span class="hljs-string">'0.0.0.0'</span>);
</code></pre>
<p>real-server.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">let</span> server = http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
    res.end(<span class="hljs-string">'9999'</span>);
});
server.listen(<span class="hljs-number">9999</span>, <span class="hljs-string">'0.0.0.0'</span>);
</code></pre>
<h6 id="t968.3.6.2 代理跨域">8.3.6.2 代理跨域 <a href="#t968.3.6.2 代理跨域"> # </a></h6>
<ul>
<li>nginx代理跨域</li>
<li><code>webpack-dev-server</code>代理跨域</li>
<li>客户端代理跨域</li>
<li>当前的服务启动在origin(3000端口)上，但是调用的接口在target(4000端口)上</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage">postMessage</a>方法可以安全地实现跨源通信<ul>
<li><code>otherWindow</code>:其他窗口的一个引用 message:将要发送到其他window的数据  </li>
<li><code>message</code> 将要发送到其他window的数据  </li>
<li><code>targetOrigin</code>通过窗口的origin属性来指定哪些窗口能接收到消息事件，其值可以是字符串"*"（表示无限制）或者一个URI</li>
</ul>
</li>
</ul>
<pre><code class="lang-js">otherWindow.postMessage(message, targetOrigin, [transfer]);
</code></pre>
<ul>
<li>data 从其他<code>window</code>中传递过来的对象</li>
<li>origin 调用<code>postMessage</code>时消息发送方窗口的<code>origin</code></li>
<li>source 对发送消息的窗口对象的引用</li>
</ul>
<pre><code class="lang-js"><span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">"message"</span>, receiveMessage, <span class="hljs-literal">false</span>);
</code></pre>
<p>origin.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> express=<span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">let</span> app=express();
app.use(express.static(__dirname));
app.listen(<span class="hljs-number">3000</span>);
</code></pre>
<p>target.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">let</span> app = express();
<span class="hljs-keyword">let</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'body-parser'</span>);
app.use(bodyParser.urlencoded({ <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span> }));
app.use(express.static(__dirname));
<span class="hljs-keyword">let</span> users = [];
app.post(<span class="hljs-string">'/register'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
    <span class="hljs-keyword">let</span> body = req.body;
    <span class="hljs-keyword">let</span> target = body.target;
    <span class="hljs-keyword">let</span> callback = body.callback;
    <span class="hljs-keyword">let</span> username = body.username;
    <span class="hljs-keyword">let</span> password = body.password;
    <span class="hljs-keyword">let</span> user = { username, password };
    <span class="hljs-keyword">let</span> id = users.length == <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : users[users.length - <span class="hljs-number">1</span>].id + <span class="hljs-number">1</span>;
    user.id = id;
    users.push(user);
    res.status(<span class="hljs-number">302</span>);
    res.header(<span class="hljs-string">'Location'</span>, <span class="hljs-string">`<span class="hljs-subst">${target}</span>?callback=<span class="hljs-subst">${callback}</span>&amp;args=<span class="hljs-subst">${id}</span>`</span>);
    res.end();
});
app.listen(<span class="hljs-number">4000</span>);
</code></pre>
<p>reg.html</p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="javascript">
        <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
            <span class="hljs-built_in">console</span>.log(event.data);

            <span class="hljs-keyword">if</span> (event.data.receiveId) {
                alert(<span class="hljs-string">'用户ID='</span> + event.data.receiveId);
            }
        })
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"proxyIframe"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"proxyIframe"</span> <span class="hljs-attr">frameborder</span>=<span class="hljs-string">"0"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"http://localhost:4000/register"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"POST"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"proxyIframe"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"hidden"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"callback"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"receiveId"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"hidden"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"target"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"http://localhost:3000/target.html"</span>&gt;</span>
        用户名<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> /&gt;</span>
        密码<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"提交"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>target.html</p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> query = location.search.substr(<span class="hljs-number">1</span>).split(<span class="hljs-string">'&amp;'</span>);
            <span class="hljs-keyword">let</span> callback, args;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, len = query.length; i &lt; len; i++) {
                <span class="hljs-keyword">let</span> item = query[i].split(<span class="hljs-string">'='</span>);
                <span class="hljs-keyword">if</span> (item[<span class="hljs-number">0</span>] == <span class="hljs-string">'callback'</span>) {
                    callback = item[<span class="hljs-number">1</span>];
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item[<span class="hljs-number">0</span>] == <span class="hljs-string">'args'</span>) {
                    args = item[<span class="hljs-number">1</span>];
                }
            }
            <span class="hljs-keyword">try</span> {
                <span class="hljs-built_in">window</span>.parent.postMessage({ [callback]: args }, <span class="hljs-string">'*'</span>);
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-built_in">console</span>.log(error);
            }
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h5 id="t978.3.7 $.proxy">8.3.7 $.proxy <a href="#t978.3.7 $.proxy"> # </a></h5>
<ul>
<li>接受一个函数，然后返回一个新函数，并且这个新函数始终保持了特定的上下文语境。</li>
<li><code>jQuery.proxy( function, context )</code> function为执行的函数，content为函数的上下文this值会被设置成这个object对象</li>
</ul>
<pre><code class="lang-js">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="ie=edge"&gt;
    &lt;title&gt;jquery proxy&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;button id="btn"&gt;点我变红&lt;/button&gt;
    &lt;script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script&gt;
        let btn = document.getElementById('btn');
        btn.addEventListener('click', function () {
            setTimeout($.proxy((function () {
                $(this).css('color', 'red');
            }), this), 1000);
        });    
    &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">proxy</span>(<span class="hljs-params">fn, context</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
       <span class="hljs-keyword">return</span> fn.call(context, <span class="hljs-built_in">arguments</span>);
    }
}
</code></pre>
<h5 id="t988.3.8 Proxy">8.3.8 Proxy <a href="#t988.3.8 Proxy"> # </a></h5>
<ul>
<li>Proxy 用于修改某些操作的默认行为</li>
<li>Proxy 可以理解成，在目标对象之前架设一层<code>拦截</code>,外界对该对象的访问，都必须先通过这层拦截，因此提供了一种机制，可以对外界的访问进行过滤和改写。</li>
<li>Proxy 这个词的原意是代理，用在这里表示由它来<code>代理</code>某些操作，可以译为<code>代理器</code></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">defineProperty</a></li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> wang={
    <span class="hljs-attr">name</span>: <span class="hljs-string">'wanglaoshi'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">29</span>,
    <span class="hljs-attr">height</span>:<span class="hljs-number">165</span>
}
<span class="hljs-keyword">let</span> wangMama=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Proxy</span>(wang,{
    <span class="hljs-keyword">get</span>(target,key) {
        <span class="hljs-keyword">if</span> (key == <span class="hljs-string">'age'</span>) {
            <span class="hljs-keyword">return</span> wang.age<span class="hljs-number">-1</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key == <span class="hljs-string">'height'</span>) {
            <span class="hljs-keyword">return</span> wang.height<span class="hljs-number">-5</span>;
        }
        <span class="hljs-keyword">return</span> target[key];
    },
    <span class="hljs-keyword">set</span>(target,key,val) {
        <span class="hljs-keyword">if</span> (key == <span class="hljs-string">'boyfriend'</span>) {
            <span class="hljs-keyword">let</span> boyfriend=val;
            <span class="hljs-keyword">if</span> (boyfriend.age&gt;<span class="hljs-number">40</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'太老'</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (boyfriend.salary&lt;<span class="hljs-number">20000</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'太穷'</span>);
            } <span class="hljs-keyword">else</span> {
                target[key]=val;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        }
    }
});
<span class="hljs-built_in">console</span>.log(wangMama.age);
<span class="hljs-built_in">console</span>.log(wangMama.height);
wangMama.boyfriend={
    <span class="hljs-attr">age</span>: <span class="hljs-number">41</span>,
    <span class="hljs-attr">salary</span>:<span class="hljs-number">3000</span>
}
</code></pre>
<h5 id="t998.3.9 Vue2和Vue3">8.3.9 Vue2和Vue3 <a href="#t998.3.9 Vue2和Vue3"> # </a></h5>
<ul>
<li>Vue2 中的变化侦测实现对 Object 及 Array 分别进行了不同的处理,Object 使用了
<code>Object.defineProperty API</code>,<code>Array</code>使用了拦截器对 <code>Array</code> 原型上的能够改变数据的方法进行拦截。虽然也实现了数据的变化侦测，但存在很多局限 ，比如对象新增属性无法被侦测，以及通过数组下边修改数组内容，也因此在 Vue2 中经常会使用到 <code>$set</code> 这个方法对数据修改，以保证依赖更新。</li>
<li>Vue3 中使用了 es6 的 <code>Proxy API</code>对数据代理，没有像 <code>Vue2</code> 中对原数据进行修改，只是加了代理包装，因此首先性能上会有所改善。其次解决了 <code>Vue2</code> 中变化侦测的局限性，可以不使用 <code>$set</code> 新增的对象属性及通过下标修改数组都能被侦测到。</li>
</ul>
<h5 id="t1008.3.10">8.3.10 <a href="#t1008.3.10"> # </a></h5>
<ul>
<li>代理模式 VS 适配器模式 适配器提供不同接口，代理模式提供一模一样的接口</li>
<li>代理模式 VS 装饰器模式 装饰器模式原来的功能不变还可以使用，代理模式改变原来的功能</li>
</ul>
<h2 id="t1019.观察者模式">9.观察者模式 <a href="#t1019.观察者模式"> # </a></h2>
<ul>
<li>观察者模式定义了一种一对多的依赖关系，让多个观察者对象同时监听某一个目标对象，当这个目标对象的状态发生变化时，会通知所有观察者对象，使它们能够自动更新</li>
<li>双十一加入购物车</li>
</ul>
<h4 id="t1029.1 类图">9.1 类图 <a href="#t1029.1 类图"> # </a></h4>
<ul>
<li>主题对象(Subject) 该角色又称为被观察者,可以增加和删除观察者对象,它将有关状态存入具体观察者对象，在具体主题的内部状态改变时，给所有登记过(关联了观察关系)的观察者发出通知</li>
<li>观察者(Observer)角色：定义一个接收通知的接口(update),在得到主题的通知时更新自己</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/teacherobserver.png" alt="teacherobserver"></p>
<h4 id="t1039.2 代码">9.2 代码 <a href="#t1039.2 代码"> # </a></h4>
<pre><code class="lang-js">abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>{
    <span class="hljs-keyword">constructor</span>(public teacher: Teacher) { }
    public abstract update();
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Xueba</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Student</span> </span>{
    public update() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.teacher.getState() + <span class="hljs-string">',学霸抬头举手'</span>);
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Xuezha</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Student</span> </span>{
    public update() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.teacher.getState() + <span class="hljs-string">',学渣低头祈祷'</span>);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Teacher</span> </span>{
    private students: Student[] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>&lt;Student&gt;();
    public state: string = <span class="hljs-string">'老师讲课'</span>
    getState() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.state;
    }
    public askQuestion() {
        <span class="hljs-keyword">this</span>.state = <span class="hljs-string">'老师提问'</span>;
        <span class="hljs-keyword">this</span>.notifyAllStudents();
    }
    attach(student: Student) {
        <span class="hljs-keyword">this</span>.students.push(student);
    }
    notifyAllStudents() {
        <span class="hljs-keyword">this</span>.students.forEach(<span class="hljs-function"><span class="hljs-params">student</span> =&gt;</span> student.update());
    }
}
<span class="hljs-keyword">let</span> teacher = <span class="hljs-keyword">new</span> Teacher();
teacher.attach(<span class="hljs-keyword">new</span> Xueba(teacher));
teacher.attach(<span class="hljs-keyword">new</span> Xueza(teacher));
teacher.askQuestion();
</code></pre>
<h4 id="t1049.3 场景">9.3 场景 <a href="#t1049.3 场景"> # </a></h4>
<h5 id="t1059.3.1 DOM事件绑定">9.3.1 DOM事件绑定 <a href="#t1059.3.1 DOM事件绑定"> # </a></h5>
<p>原生</p>
<pre><code class="lang-js">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="ie=edge"&gt;
    &lt;title&gt;观察者模式&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;button id="btn"&gt;click&lt;/button&gt;
    &lt;script&gt;
        let btn = document.getElementById('btn');
        const handler1 = () =&gt; { console.log(1); }
        const handler2 = () =&gt; { console.log(2); }
        const handler3 = () =&gt; { console.log(3); }
        btn.addEventListener('click', handler1);
        btn.addEventListener('click',handler2);
        btn.addEventListener('click', handler3);
    &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre>
<p>jquery</p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>观察者模式<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://libs.baidu.com/jquery/2.0.0/jquery.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"btn"</span>&gt;</span>click<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> handler1 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { <span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>); }
        <span class="hljs-keyword">const</span> handler2 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { <span class="hljs-built_in">console</span>.log(<span class="hljs-number">2</span>); }
        <span class="hljs-keyword">const</span> handler3 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { <span class="hljs-built_in">console</span>.log(<span class="hljs-number">3</span>); }
        $(<span class="hljs-string">'#btn'</span>).on(<span class="hljs-string">'clickMe'</span>, handler1);
        $(<span class="hljs-string">'#btn'</span>).on(<span class="hljs-string">'clickMe'</span>, handler2);
        $(<span class="hljs-string">'#btn'</span>).on(<span class="hljs-string">'clickMe'</span>, handler3);
        $(<span class="hljs-string">'#btn'</span>).trigger(<span class="hljs-string">'clickMe'</span>);
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'================================='</span>);
        $(<span class="hljs-string">'#btn'</span>).off(<span class="hljs-string">'clickMe'</span>, handler2);
        $(<span class="hljs-string">'#btn'</span>).trigger(<span class="hljs-string">'clickMe'</span>);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h5 id="t1069.3.2 Promise">9.3.2 Promise <a href="#t1069.3.2 Promise"> # </a></h5>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Promise</span> </span>{
    private callbacks: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">Function</span>&gt; = []
    <span class="hljs-keyword">constructor</span>(fn) {
        <span class="hljs-keyword">let</span> resolve = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            <span class="hljs-keyword">this</span>.callbacks.forEach(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> callback())
        };
        fn(resolve);
    }
    then(callback) {
        <span class="hljs-keyword">this</span>.callbacks.push(callback);
    }
}
<span class="hljs-keyword">let</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve</span>) </span>{
    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        resolve(<span class="hljs-number">100</span>);
    }, <span class="hljs-number">1000</span>);
});
promise.then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>));
promise.then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-number">2</span>));
</code></pre>
<h5 id="t1079.3.3 callbacks">9.3.3 callbacks <a href="#t1079.3.3 callbacks"> # </a></h5>
<ul>
<li><code>JQuery.Callbacks</code>是jQuery1.7+之后引入的，用来进行函数队列的add、remove、fire、lock等操作</li>
<li>Callbacks对象其实就是一个函数队列，获得Callbacks对象之后 ，就可以向这个集合中增加或者删除函数。add和remove功能相反，函数参数是相同的，empty()删除回调列表中的所有函数</li>
</ul>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://libs.baidu.com/jquery/2.0.0/jquery.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">let</span> callbacks = $.Callbacks();

        <span class="hljs-keyword">let</span> a1 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> alert(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">let</span> a2 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> alert(<span class="hljs-number">2</span>);
        <span class="hljs-keyword">let</span> a3 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> alert(<span class="hljs-number">13</span>);
        callbacks.add(a1);
        callbacks.add(a2);
        callbacks.add(a3);
        callbacks.remove(a3);
        callbacks.fire();
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>Callbacks</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Callbacks</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">let</span> observers = [];
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">observer</span>) </span>{
        observers.push(observer);
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span>(<span class="hljs-params">observer</span>) </span>{
        <span class="hljs-keyword">let</span> index = observers.indexOf(observer);
        <span class="hljs-keyword">if</span> (index != <span class="hljs-number">-1</span>)
            observers.splice(index, <span class="hljs-number">1</span>);
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fire</span>(<span class="hljs-params"></span>) </span>{
        observers.forEach(<span class="hljs-function"><span class="hljs-params">observer</span> =&gt;</span> observer());
    }
    <span class="hljs-keyword">return</span> {
        add,
        remove,
        fire
    }
}
</code></pre>
<h5 id="t1089.3.4 EventEmitter">9.3.4 EventEmitter <a href="#t1089.3.4 EventEmitter"> # </a></h5>
<p>自定义事件</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> EventEmitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'events'</span>);
<span class="hljs-keyword">let</span> subject = <span class="hljs-keyword">new</span> EventEmitter();
subject.on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>, name);
});
subject.on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-number">2</span>, name);
});
subject.emit(<span class="hljs-string">'click'</span>, <span class="hljs-string">'zhufeng'</span>);
</code></pre>
<p>events.js</p>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventEmitter</span></span>{
    <span class="hljs-keyword">constructor</span>() {
        <span class="hljs-keyword">this</span>._events={};
    }
    on(type,listener) {
        <span class="hljs-keyword">let</span> listeners=<span class="hljs-keyword">this</span>._events[type];
        <span class="hljs-keyword">if</span> (listeners) {
            listeners.push(listener);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>._events[type]=[listener];
        }
    }
    emit(type) {
        <span class="hljs-keyword">let</span> listeners=<span class="hljs-keyword">this</span>._events[type];
        <span class="hljs-keyword">let</span> args=<span class="hljs-built_in">Array</span>.from(<span class="hljs-built_in">arguments</span>).slice(<span class="hljs-number">1</span>);
        listeners.forEach(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> listener(...args));
    }
}
<span class="hljs-built_in">module</span>.exports = EventEmitter;
</code></pre>
<h5 id="t1099.3.5 流">9.3.5 流 <a href="#t1099.3.5 流"> # </a></h5>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">let</span> rs = fs.createReadStream(<span class="hljs-string">'./1.txt'</span>, { <span class="hljs-attr">highWaterMark</span>: <span class="hljs-number">3</span> });
rs.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
    <span class="hljs-built_in">console</span>.log(data.toString());
});
rs.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'end'</span>);
});
</code></pre>
<h5 id="t1109.3.6 http服务器">9.3.6 http服务器 <a href="#t1109.3.6 http服务器"> # </a></h5>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">let</span> server = http.createServer();
server.on(<span class="hljs-string">'request'</span>, (req, res) =&gt; {
    res.end(<span class="hljs-string">'zhufeng'</span>);
});
server.listen(<span class="hljs-number">3000</span>);
</code></pre>
<h5 id="t1119.3.7 生命周期函数">9.3.7 生命周期函数 <a href="#t1119.3.7 生命周期函数"> # </a></h5>
<p><img src="http://img.zhufengpeixun.cn/reactlifecycles.jpg" alt="reactlifecycles"></p>
<p><img src="http://img.zhufengpeixun.cn/vuelifecycles.jpg" alt="vuelifecycles"></p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"root"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">let</span> container = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'root'</span>);
        <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Component</span> </span>{
            state = { <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> }
            componentWillMount() {
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'componentWillMount'</span>);
            }

            componentDidMount() {
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'componentDidMount'</span>);
            }
            shouldComponentUpdate() {
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'shouldComponentUpdate'</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            componentWillUpdate() {
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'componentWillUpdate'</span>);
            }

            componentDidUpdate() {
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'componentDidUpdate'</span>);
            }
            setState(newState) {
                <span class="hljs-keyword">this</span>.state = { ...this.state, ...newState }
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.shouldComponentUpdate || (<span class="hljs-keyword">this</span>.shouldComponentUpdate &amp;&amp; <span class="hljs-keyword">this</span>.shouldComponentUpdate())) {
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.componentWillUpdate)
                        <span class="hljs-keyword">this</span>.componentWillUpdate();
                    <span class="hljs-keyword">let</span> content = <span class="hljs-keyword">this</span>.render();
                    container.innerHTML = content;
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.componentDidUpdate)
                        <span class="hljs-keyword">this</span>.componentDidUpdate();
                }
            }
            render() {
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'render'</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.state.number;
            }
        }
        render(Component, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'root'</span>));
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params">Component, container</span>) </span>{

            <span class="hljs-keyword">let</span> component = <span class="hljs-keyword">new</span> Component();
            <span class="hljs-keyword">if</span> (component.componentWillMount)
                component.componentWillMount();
            <span class="hljs-keyword">let</span> content = component.render();
            container.innerHTML = content;
            <span class="hljs-keyword">if</span> (component.componentDidMount)
                component.componentDidMount();

            setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                component.setState({ <span class="hljs-attr">number</span>: <span class="hljs-number">1</span> });
            }, <span class="hljs-number">3000</span>);
        }

    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h5 id="t1129.3.8 EventBus">9.3.8 EventBus <a href="#t1129.3.8 EventBus"> # </a></h5>
<ul>
<li>如果你觉得使用<code>$on</code>、<code>$emit</code>不方便,而你又不愿意引入<code>vuex</code>,可以使用<code>EventBus</code></li>
<li>在要相互通信的兄弟组件之中，都引入一个新的vue实例，然后通过分别调用这个实例的事件触发和监听来实现通信和参数传递</li>
</ul>
<p>EventBus.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;  
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> Vue(); 
</code></pre>
<p>组件A</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> EventBus <span class="hljs-keyword">from</span> <span class="hljs-string">'./EventBus'</span>;  
EventBus.$on(<span class="hljs-string">"customEvent"</span>, name =&gt; {
    <span class="hljs-built_in">console</span>.log(name);
})
</code></pre>
<p>组件B</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> EventBus <span class="hljs-keyword">from</span> <span class="hljs-string">'./EventBus'</span>;  
EventBus.$emit(<span class="hljs-string">"customEvent"</span>, <span class="hljs-string">'zhufeng'</span>)
</code></pre>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcss.com/vue/2.5.17/vue.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">let</span> EventBus = <span class="hljs-keyword">new</span> Vue();
        EventBus.$on(<span class="hljs-string">"customEvent"</span>, name =&gt; {
            <span class="hljs-built_in">console</span>.log(name);
        })
        EventBus.$emit(<span class="hljs-string">"customEvent"</span>, <span class="hljs-string">'zhufeng'</span>)
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h5 id="t1139.3.9 Vue响应式">9.3.9 Vue响应式 <a href="#t1139.3.9 Vue响应式"> # </a></h5>
<ul>
<li>在 Vue 中，每个组件实例都有相应的 <code>watcher</code> 实例对象，它会在组件渲染的过程中把属性记录为依赖，之后当依赖项的 <code>setter</code> 被调用时，会通知 <code>watcher</code> 重新计算，从而致使它关联的组件得以更新</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/vuereactive.jpg" alt="vuereactive"></p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>vue<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"name"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"age"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">let</span> name = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'name'</span>);
        <span class="hljs-keyword">let</span> age = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'age'</span>);
        <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dep</span> </span>{
            subs = []
            addSub(sub) {
                <span class="hljs-keyword">this</span>.subs.push(sub);
            }
            notify() {
                <span class="hljs-keyword">this</span>.subs.forEach(<span class="hljs-function">(<span class="hljs-params">sub</span>) =&gt;</span> sub())
            }
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">observe</span>(<span class="hljs-params">target</span>) </span>{
            <span class="hljs-built_in">Object</span>.keys(target).forEach(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> {
                <span class="hljs-keyword">let</span> val = target[key];
                <span class="hljs-keyword">const</span> dep = <span class="hljs-keyword">new</span> Dep();
                <span class="hljs-keyword">if</span> (key == <span class="hljs-string">'name'</span>) {
                    name.innerHTML = val;
                    dep.addSub(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { name.innerHTML = val });
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key == <span class="hljs-string">'age'</span>) {
                    age.innerHTML = val;
                    dep.addSub(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { age.innerHTML = val });
                }
                <span class="hljs-built_in">Object</span>.defineProperty(target, key, {
                    <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">return</span> val;
                    },
                    <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
                        val = value;
                        dep.notify();
                    }
                });
            })
        }

        <span class="hljs-keyword">let</span> obj = { <span class="hljs-attr">name</span>: <span class="hljs-string">'名称'</span>, <span class="hljs-attr">age</span>: <span class="hljs-string">'年龄'</span> };
        observe(obj);
        setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            obj.name = <span class="hljs-string">'新名称'</span>;
        }, <span class="hljs-number">3000</span>);
        setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            obj.age = <span class="hljs-string">'新年龄'</span>;
        }, <span class="hljs-number">6000</span>);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h5 id="t1149.3.9 redux">9.3.9 redux <a href="#t1149.3.9 redux"> # </a></h5>
<ul>
<li><a href="https://github.com/reduxjs/redux/blob/master/src/createStore.js">createStore</a></li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createStore</span>(<span class="hljs-params">reducer,preloadedState,enhancer</span>) </span>{
    <span class="hljs-keyword">if</span> (enhancer) {
        <span class="hljs-keyword">return</span> enhancer(createStore)(reducer,preloadedState);
    }
    <span class="hljs-keyword">let</span> state=preloadedState;
    <span class="hljs-keyword">let</span> listeners=[];
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getState</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> state;
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subscribe</span>(<span class="hljs-params">listener</span>) </span>{
        listeners.push(listener);
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">const</span> index=listeners.indexOf(listener);
            listeners.splice(index,<span class="hljs-number">1</span>);
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dispatch</span>(<span class="hljs-params">action</span>) </span>{
        state=reducer(state,action);
        listeners.forEach(<span class="hljs-function"><span class="hljs-params">listener</span>=&gt;</span>listener())
    }
    dispatch({<span class="hljs-attr">type</span>:<span class="hljs-string">'@@redux/INIT'</span>});
    <span class="hljs-keyword">return</span> {
        dispatch,
        subscribe,
        getState
    }
}
</code></pre>
<h4 id="t1159.4 发布订阅模式">9.4 发布订阅模式 <a href="#t1159.4 发布订阅模式"> # </a></h4>
<h5 id="t1169.4.1 区别">9.4.1 区别 <a href="#t1169.4.1 区别"> # </a></h5>
<ul>
<li>订阅者把自己想订阅的事件注册到调度中心</li>
<li>当该事件触发时候，发布者发布该事件到调度中心,由调度中心统一调度订阅者注册到调度中心的处理代码。</li>
<li>虽然两种模式都存在订阅者和发布者（观察者可认为是订阅者、被观察者可认为是发布者）</li>
<li>但是观察者模式是由被观察者调度的，而发布/订阅模式是统一由调度中心调的</li>
<li>所以观察者模式的订阅者与发布者之间是存在依赖的，而发布/订阅模式则不会。</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/subscribepattern.jpg" alt="subscribepattern"></p>
<h5 id="t1179.4.2 类图">9.4.2 类图 <a href="#t1179.4.2 类图"> # </a></h5>
<p><img src="http://img.zhufengpeixun.cn/publishsubscribe.png" alt="publishsubscribe"></p>
<h5 id="t1189.4.3 代码">9.4.3 代码 <a href="#t1189.4.3 代码"> # </a></h5>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Agency</span> </span>{
    _topics = {}
    subscribe(topic, listener) {
        <span class="hljs-keyword">let</span> listeners = <span class="hljs-keyword">this</span>._topics[topic];
        <span class="hljs-keyword">if</span> (listeners) {
            listeners.push(listener);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>._topics[topic] = [listener];
        }
    }
    publish(topic, ...args) {
        <span class="hljs-keyword">let</span> listeners = <span class="hljs-keyword">this</span>._topics[topic] || [];
        listeners.forEach(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> listener(...args));
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Landlord</span> </span>{
    <span class="hljs-keyword">constructor</span>(public agent: Agency) { }
    lend(topic, area, money) {
        <span class="hljs-keyword">this</span>.agent.publish(topic, area, money);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Tenant</span> </span>{
    <span class="hljs-keyword">constructor</span>(public agent: Agency, public name: string) { }
    order(topic) {
        <span class="hljs-keyword">this</span>.agent.subscribe(topic, (area, money) =&gt; {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.name, <span class="hljs-string">`<span class="hljs-subst">${area}</span>平米, <span class="hljs-subst">${money}</span>元`</span>);
        });
    }
}
<span class="hljs-keyword">let</span> agent = <span class="hljs-keyword">new</span> Agency();
<span class="hljs-keyword">let</span> rich = <span class="hljs-keyword">new</span> Tenant(agent, <span class="hljs-string">'大款'</span>);
<span class="hljs-keyword">let</span> poor = <span class="hljs-keyword">new</span> Tenant(agent, <span class="hljs-string">'北漂'</span>);
<span class="hljs-keyword">let</span> landlord = <span class="hljs-keyword">new</span> Landlord(agent);
rich.order(<span class="hljs-string">'豪宅'</span>);
poor.order(<span class="hljs-string">'单间'</span>);
landlord.lend(<span class="hljs-string">'豪宅'</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">1000000</span>);
landlord.lend(<span class="hljs-string">'单间'</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1000</span>);
</code></pre>
<h5 id="t1199.4.4 Redis发布订阅">9.4.4 Redis发布订阅 <a href="#t1199.4.4 Redis发布订阅"> # </a></h5>
<ul>
<li>Redis 发布订阅是一种消息通信模式：发送者发送消息，订阅者接收消息，客户端可以订阅任意数量的频道。</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/redissubscribe.jpg" alt="redissubscribe"></p>
<p><img src="http://img.zhufengpeixun.cn/redispublishsubscribe.png" alt="redispublishsubscribe"></p>
<pre><code class="lang-js">SUBSCRIBE channel_a
PUBLISH channel_a zhufeng
</code></pre>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> redis = <span class="hljs-built_in">require</span>(<span class="hljs-string">'redis'</span>);
<span class="hljs-keyword">let</span> client1 = redis.createClient(<span class="hljs-number">6379</span>, <span class="hljs-string">'127.0.0.1'</span>);
<span class="hljs-keyword">let</span> client2 = redis.createClient(<span class="hljs-number">6379</span>, <span class="hljs-string">'127.0.0.1'</span>);

client1.subscribe(<span class="hljs-string">'channel_a'</span>);
client1.subscribe(<span class="hljs-string">'channel_b'</span>);
client1.on(<span class="hljs-string">'message'</span>, (channel, message) =&gt; {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'client1'</span>, channel, message);
    client1.unsubscribe(<span class="hljs-string">'channel_a'</span>);
});
client2.publish(<span class="hljs-string">'channel_a'</span>, <span class="hljs-string">'a_hello'</span>);
client2.publish(<span class="hljs-string">'channel_b'</span>, <span class="hljs-string">'b_hello'</span>);

setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    client2.publish(<span class="hljs-string">'channel_a'</span>, <span class="hljs-string">'a_world'</span>);
    client2.publish(<span class="hljs-string">'channel_b'</span>, <span class="hljs-string">'b_world'</span>);
}, <span class="hljs-number">3000</span>);
</code></pre>
<h2 id="t12010. 外观模式">10. 外观模式 <a href="#t12010. 外观模式"> # </a></h2>
<ul>
<li>外观模式(Facade Pattern)又叫门面模式，定义一个将子系统的一组接口集成在一起的高层接口，以提供一个一致的外观</li>
<li>外观模式让外界减少与子系统内多个模块的直接交互，从而减少耦合，让外界可以更轻松地使用子系统</li>
<li>该设计模式由以下角色组成<ul>
<li>门面角色：外观模式的核心。它被客户角色调用,它熟悉子系统的功能。内部根据客户角色的需求预定了几种功能的组合</li>
<li>子系统角色:实现了子系统的功能。它对客户角色和<code>Facade</code>是未知的</li>
<li>客户角色:通过调用Facede来完成要实现的功能</li>
</ul>
</li>
<li>遥控器、自动驾驶汽车、房屋中介</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/xiaomicontrol.jpg" alt="xiaomicontrol"></p>
<p><img src="http://img.zhufengpeixun.cn/facadepattern.jpeg" alt="facadepattern"></p>
<h4 id="t12110.1 计算器">10.1 计算器 <a href="#t12110.1 计算器"> # </a></h4>
<p><img src="http://img.zhufengpeixun.cn/facadepattern2.jpeg" alt="facadepattern2"></p>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sum</span> </span>{
    sum(a, b) {
        <span class="hljs-keyword">return</span> a + b;
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Minus</span> </span>{
    minus(a, b) {
        <span class="hljs-keyword">return</span> a - b;
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Multiply</span> </span>{
    multiply(a, b) {
        <span class="hljs-keyword">return</span> a * b;
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Calculator</span> </span>{
    sumObj
    minusObj
    multiplyObj
    <span class="hljs-keyword">constructor</span>() {
        <span class="hljs-keyword">this</span>.sumObj = <span class="hljs-keyword">new</span> Sum();
        <span class="hljs-keyword">this</span>.minusObj = <span class="hljs-keyword">new</span> Minus();
        <span class="hljs-keyword">this</span>.multiplyObj = <span class="hljs-keyword">new</span> Multiply();
    }
    sum(...args) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.sumObj.sum(...args);
    }
    minus(...args) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.minusObj.minus(...args);
    }
    multiply(...args) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.multiplyObj.multiply(...args);
    }
}
<span class="hljs-keyword">let</span> calculator = <span class="hljs-keyword">new</span> Calculator();
<span class="hljs-built_in">console</span>.log(calculator.sum(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));
<span class="hljs-built_in">console</span>.log(calculator.minus(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));
<span class="hljs-built_in">console</span>.log(calculator.multiply(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));
</code></pre>
<h4 id="t12210.2 计算机">10.2 计算机 <a href="#t12210.2 计算机"> # </a></h4>
<p><img src="http://img.zhufengpeixun.cn/computer2.jpg" alt="computer2"></p>
<pre><code class="lang-js">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CPU</span> </span>{
    startup() { <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'打开CPU'</span>); }
    shutdown() { <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'关闭CPU'</span>); }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Memory</span> </span>{
    startup() { <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'打开内存'</span>); }
    shutdown() { <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'关闭内存'</span>); }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Disk</span> </span>{
    startup() { <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'打开硬盘'</span>); }
    shutdown() { <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'关闭硬盘'</span>); }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Computer</span> </span>{
    cpu;
    memory;
    disk;
    <span class="hljs-keyword">constructor</span>() {
        <span class="hljs-keyword">this</span>.cpu = <span class="hljs-keyword">new</span> CPU();
        <span class="hljs-keyword">this</span>.memory = <span class="hljs-keyword">new</span> Memory();
        <span class="hljs-keyword">this</span>.disk = <span class="hljs-keyword">new</span> Disk();
    }
    startup() {
        <span class="hljs-keyword">this</span>.cpu.startup();
        <span class="hljs-keyword">this</span>.memory.startup();
        <span class="hljs-keyword">this</span>.disk.startup();
    }
    shutdown() {
        <span class="hljs-keyword">this</span>.cpu.shutdown();
        <span class="hljs-keyword">this</span>.memory.shutdown();
        <span class="hljs-keyword">this</span>.disk.shutdown();
    }
}
<span class="hljs-keyword">let</span> computer = <span class="hljs-keyword">new</span> Computer();
computer.startup();
computer.shutdown();
</code></pre>
<h4 id="t12310.3 压缩">10.3 压缩 <a href="#t12310.3 压缩"> # </a></h4>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> { }
<span class="hljs-keyword">var</span> zlib = <span class="hljs-built_in">require</span>(<span class="hljs-string">'zlib'</span>);
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">let</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open</span>(<span class="hljs-params">input</span>) </span>{
    <span class="hljs-keyword">let</span> ext = path.extname(input);
    <span class="hljs-keyword">switch</span> (ext) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'.gz'</span>:
            <span class="hljs-keyword">return</span> unZip(input);
        <span class="hljs-keyword">case</span> <span class="hljs-string">'.rar'</span>:
            <span class="hljs-keyword">return</span> unRar(input);
        <span class="hljs-keyword">case</span> <span class="hljs-string">'.7z'</span>:
            <span class="hljs-keyword">return</span> un7z(input);
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">break</span>;
    }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unZip</span>(<span class="hljs-params">src</span>) </span>{
    <span class="hljs-keyword">var</span> gunzip = zlib.createGunzip();
    <span class="hljs-keyword">var</span> inputStream = fs.createReadStream(src);
    <span class="hljs-keyword">var</span> outputStream = fs.createWriteStream(src.slice(<span class="hljs-number">0</span>, <span class="hljs-number">-3</span>));
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'outputStream'</span>);

    inputStream.pipe(gunzip).pipe(outputStream);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unRar</span>(<span class="hljs-params">src</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Rar解压后的'</span>, src);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">un7z</span>(<span class="hljs-params">src</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'7z解压后的'</span>, src);
}
open(<span class="hljs-string">'./source.txt.gz'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">zip</span>(<span class="hljs-params">src</span>) </span>{
    <span class="hljs-keyword">var</span> gzip = zlib.createGzip();<span class="hljs-comment">//创建压缩流</span>
    <span class="hljs-keyword">var</span> inputStream = fs.createReadStream(src);
    <span class="hljs-keyword">var</span> outputStream = fs.createWriteStream(src+<span class="hljs-string">'.gz'</span>);
    inputStream.pipe(gzip).pipe(outputStream);
}
zip(<span class="hljs-string">'source.txt'</span>);
</code></pre>
<h4 id="t12410.4 redux">10.4 redux <a href="#t12410.4 redux"> # </a></h4>
<ul>
<li><a href="https://github.com/reduxjs/redux/blob/v4.0.0/src/index.js">redux index.js</a></li>
</ul>
<h4 id="t12510.5 函数重载">10.5 函数重载 <a href="#t12510.5 函数重载"> # </a></h4>
<ul>
<li>为复杂的模块或子系统提供外界访问的模块</li>
<li>子系统相互独立</li>
</ul>
<h5 id="t12610.5.1 参数重载">10.5.1 参数重载 <a href="#t12610.5.1 参数重载"> # </a></h5>
<p>sum.ts</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sum</span>(<span class="hljs-params">a: number, b: string</span>);
<span class="hljs-title">function</span> <span class="hljs-title">sum</span>(<span class="hljs-params">a: string, b: number</span>);
<span class="hljs-title">function</span> <span class="hljs-title">sum</span>(<span class="hljs-params">a: any, b: any</span>) </span>{
    <span class="hljs-keyword">return</span> a + b;
}
</code></pre>
<h5 id="t12710.5.2 react createElement">10.5.2 react createElement <a href="#t12710.5.2 react createElement"> # </a></h5>
<p>-<a href="https://github.com/facebook/react/blob/master/packages/react/src/ReactElement.js#L347-L361">react create-element</a></p>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createElement</span> (<span class="hljs-params">
  context: Component,
  tag: any,
  data: any,
  children: any,
  normalizationType: any,
  alwaysNormalize: boolean
</span>): <span class="hljs-title">VNode</span> | <span class="hljs-title">Array</span>&lt;<span class="hljs-title">VNode</span>&gt; </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(data) || isPrimitive(data)) {
    normalizationType = children
    children = data
    data = <span class="hljs-literal">undefined</span>
  }
  <span class="hljs-keyword">if</span> (isTrue(alwaysNormalize)) {
    normalizationType = ALWAYS_NORMALIZE
  }
  <span class="hljs-keyword">return</span> _createElement(context, tag, data, children, normalizationType)
}
</code></pre>
<h5 id="t12810.5.3 vue createElement">10.5.3 vue createElement <a href="#t12810.5.3 vue createElement"> # </a></h5>
<p>-<a href="https://github.com/vuejs/vue/blob/v2.6.10/src/core/vdom/create-element.js#L28-L45">vue create-element</a></p>
<pre><code class="lang-js">  <span class="hljs-keyword">const</span> childrenLength = <span class="hljs-built_in">arguments</span>.length - <span class="hljs-number">2</span>;
  <span class="hljs-keyword">if</span> (childrenLength === <span class="hljs-number">1</span>) {
    props.children = children;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childrenLength &gt; <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">const</span> childArray = <span class="hljs-built_in">Array</span>(childrenLength);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; childrenLength; i++) {
      childArray[i] = <span class="hljs-built_in">arguments</span>[i + <span class="hljs-number">2</span>];
    }
    <span class="hljs-keyword">if</span> (__DEV__) {
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.freeze) {
        <span class="hljs-built_in">Object</span>.freeze(childArray);
      }
    }
    props.children = childArray;
  }
</code></pre>
<h5 id="t12910.5.4 buffer">10.5.4 buffer <a href="#t12910.5.4 buffer"> # </a></h5>
<p><a href="https://github.com/nodejs/node/blob/master/lib/buffer.js#L1082">buffer.js</a></p>
<pre><code class="lang-js">Buffer.prototype.slice = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">slice</span>(<span class="hljs-params">start, end</span>) </span>{
  <span class="hljs-keyword">const</span> srcLength = <span class="hljs-keyword">this</span>.length;
  end = end !== <span class="hljs-literal">undefined</span> ? srcLength: srcLength;
  <span class="hljs-keyword">const</span> newLength = end &gt; start ? end - start : <span class="hljs-number">0</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FastBuffer(<span class="hljs-keyword">this</span>.buffer, <span class="hljs-keyword">this</span>.byteOffset + start, newLength);
};
</code></pre>
<h5 id="t13010.5.5 createStore">10.5.5 createStore <a href="#t13010.5.5 createStore"> # </a></h5>
<ul>
<li><a href="https://github.com/reduxjs/redux/blob/e95eaf2dc2024fe99dc0f7334a8bd049b4949ed0/src/createStore.js#L31-L35">createStore</a></li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createStore</span>(<span class="hljs-params">reducer, preloadedState, enhancer</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> preloadedState === <span class="hljs-string">'function'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> enhancer === <span class="hljs-string">'undefined'</span>) {
    enhancer = preloadedState
    preloadedState = <span class="hljs-literal">undefined</span>
  }
}
</code></pre>
<h5 id="t13110.5.6 axios">10.5.6 axios <a href="#t13110.5.6 axios"> # </a></h5>
<ul>
<li><a href="https://github.com/axios/axios/blob/v0.19.0/lib/defaults.js#L16-L27">defaults</a></li>
</ul>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDefaultAdapter</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> adapter;
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> process !== <span class="hljs-string">'undefined'</span> &amp;&amp; <span class="hljs-built_in">Object</span>.prototype.toString.call(process) === <span class="hljs-string">'[object process]'</span>) {
    adapter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./adapters/http'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> XMLHttpRequest !== <span class="hljs-string">'undefined'</span>) {
    adapter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./adapters/xhr'</span>);
  }
  <span class="hljs-keyword">return</span> adapter;
}
</code></pre>
<h5 id="t13210.5.7 polyfill">10.5.7 polyfill <a href="#t13210.5.7 polyfill"> # </a></h5>
<ul>
<li>polyfill可以让我们处理浏览器兼容和屏蔽了浏览器差异</li>
<li><a href="https://github.com/jquery/jquery/blob/1.5/src/event.js#L584-L596">removeEvent</a></li>
</ul>
<pre><code class="lang-js">jQuery.removeEvent = <span class="hljs-built_in">document</span>.removeEventListener ?
    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> elem, type, handle </span>) </span>{
        <span class="hljs-keyword">if</span> ( elem.removeEventListener ) {
            elem.removeEventListener( type, handle, <span class="hljs-literal">false</span> );
        }
    } :
    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> elem, type, handle </span>) </span>{
        <span class="hljs-keyword">if</span> ( elem.detachEvent ) {
            elem.detachEvent( <span class="hljs-string">"on"</span> + type, handle );
        }
    };
</code></pre>
<h2 id="t13311. 迭代器模式">11. 迭代器模式 <a href="#t13311. 迭代器模式"> # </a></h2>
<ul>
<li>迭代器模式(Iterator Pattern)用于顺序地访问聚合对象内部的元素，又无需知道对象内部结构。使用了迭代器之后，使用者不需要关心对象的内部构造，就可以按序访问其中的每个元素。</li>
</ul>
<h3 id="t13411.1 类图">11.1 类图 <a href="#t13411.1 类图"> # </a></h3>
<p><img src="http://img.zhufengpeixun.cn/iteratorpattern.jpeg" alt="iterator"></p>
<h3 id="t13511.2 代码">11.2 代码 <a href="#t13511.2 代码"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createIterator</span>(<span class="hljs-params">arr</span>) </span>{
    <span class="hljs-keyword">let</span> index=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> {
        next() {
            <span class="hljs-keyword">return</span> index&lt;arr.length?
                {<span class="hljs-attr">value</span>: arr[index++],<span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>}:
                {<span class="hljs-attr">done</span>:<span class="hljs-literal">true</span>}
        }
    }
}
<span class="hljs-keyword">let</span> it=createIterator([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>]);
<span class="hljs-built_in">console</span>.log(it.next());
<span class="hljs-built_in">console</span>.log(it.next());
<span class="hljs-built_in">console</span>.log(it.next());
</code></pre>
<h3 id="t13611.3 场景">11.3 场景 <a href="#t13611.3 场景"> # </a></h3>
<h4 id="t13711.3.1 forEach">11.3.1 forEach <a href="#t13711.3.1 forEach"> # </a></h4>
<ul>
<li>可以使用 for 循环自己实现一个 <code>forEach</code><pre><code class="lang-js"><span class="hljs-built_in">Array</span>.prototype.forEach = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cb</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.length; i++) {
      cb.call(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>[i], i, arr);
  }
}
<span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
arr.forEach(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(item);
});
</code></pre>
</li>
</ul>
<h4 id="t13811.3.2 each">11.3.2 each <a href="#t13811.3.2 each"> # </a></h4>
<ul>
<li><a href="https://github.com/jquery/jquery/blob/3.4.1/src/core.js#L246-L265">jquery</a></li>
<li><a href="https://github.com/jashkenas/underscore/blob/1.9.1/underscore.js#L181-L195">underscore</a></li>
</ul>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://libs.baidu.com/jquery/2.0.0/jquery.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">

    $.each([<span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span>, <span class="hljs-string">'3'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index, item</span>) </span>{
        <span class="hljs-built_in">console</span>.log(index, item);
    })
    $.each({ <span class="hljs-attr">name</span>: <span class="hljs-string">'zhufeng'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">10</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index, item</span>) </span>{
        <span class="hljs-built_in">console</span>.log(index, item);
    })
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">each</span>(<span class="hljs-params">obj, callback</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(obj)) {
            <span class="hljs-keyword">let</span> length = obj.length;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {
                <span class="hljs-keyword">if</span> (callback.call(obj[i], i, obj[i]) === <span class="hljs-literal">false</span>) {
                    <span class="hljs-keyword">break</span>;
                }
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i <span class="hljs-keyword">in</span> obj) {
                <span class="hljs-keyword">if</span> (callback.call(obj[i], i, obj[i]) === <span class="hljs-literal">false</span>) {
                    <span class="hljs-keyword">break</span>;
                }
            }
        }

        <span class="hljs-keyword">return</span> obj;
    }

    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h4 id="t13911.3.3 Iterator">11.3.3 Iterator <a href="#t13911.3.3 Iterator"> # </a></h4>
<ul>
<li>在ES6中有序集合数据类型有Array、Map、Set、String、TypedArray、arguments、NodeList</li>
<li>我们需要有一个统一的遍历接口来遍历所有的数据类型</li>
<li>他们都有 [Symbol.Iterator]属性，属性是一个函数，执行函数会返回迭代器</li>
<li>迭代器就有<code>next</code>方法顺序返回子元素</li>
</ul>
<pre><code class="lang-js"><span class="hljs-built_in">Array</span>[<span class="hljs-built_in">Symbol</span>.iterator] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            <span class="hljs-keyword">return</span> index &lt; <span class="hljs-keyword">this</span>.length ?
                { <span class="hljs-attr">value</span>: <span class="hljs-keyword">this</span>[index++], <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> } :
                { <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span> }
        }
    }
}
<span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>];
<span class="hljs-keyword">let</span> it = arr[<span class="hljs-built_in">Symbol</span>.iterator]();
<span class="hljs-built_in">console</span>.log(it.next());
<span class="hljs-built_in">console</span>.log(it.next());
<span class="hljs-built_in">console</span>.log(it.next());
</code></pre>
<h4 id="t14011.3.4 yield*">11.3.4 yield* <a href="#t14011.3.4 yield*"> # </a></h4>
<ul>
<li>yield*后面跟的是一个可遍历的结构，它会调用该结构的遍历器接口</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> generator = <span class="hljs-function"><span class="hljs-keyword">function</span>* (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">yield</span> <span class="hljs-number">1</span>;
    <span class="hljs-keyword">yield</span>* [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
    <span class="hljs-keyword">yield</span> <span class="hljs-number">4</span>;
};

<span class="hljs-keyword">var</span> iterator = generator();

<span class="hljs-built_in">console</span>.log(iterator.next()); <span class="hljs-comment">// { value: 1, done: false }</span>
<span class="hljs-built_in">console</span>.log(iterator.next()); <span class="hljs-comment">// { value: 2, done: false }</span>
<span class="hljs-built_in">console</span>.log(iterator.next()); <span class="hljs-comment">// { value: 3, done: false }</span>
<span class="hljs-built_in">console</span>.log(iterator.next()); <span class="hljs-comment">// { value: 4, done: false }</span>
<span class="hljs-built_in">console</span>.log(iterator.next()); <span class="hljs-comment">// { value: undefined, done: true }</span>
</code></pre>
<h4 id="t14111.3.5 二叉树遍历">11.3.5 二叉树遍历 <a href="#t14111.3.5 二叉树遍历"> # </a></h4>
<ul>
<li>二叉树是每个结点最多有两个子树的树结构。通常子树被称作左子树和右子树</li>
<li>根据根据根节点的顺序可以把遍历分为三种前序、中序、后序<ul>
<li>先序遍历：根节点-&gt;左子树-&gt;右子树</li>
<li>中序遍历：左子树-&gt;根节点-&gt;右子树</li>
<li>后序遍历：左子树-&gt;右子树-&gt;根节点</li>
</ul>
</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/varorder.png" alt="varorder"></p>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Tree</span> </span>{
    <span class="hljs-keyword">constructor</span>(public left, public value, public right) {
    }
}
<span class="hljs-comment">//['A', 'B', 'D','E', 'C', 'F','G']</span>
<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">leftOrder</span>(<span class="hljs-params">tree</span>) </span>{
    <span class="hljs-keyword">if</span> (tree) {
        <span class="hljs-keyword">yield</span> tree.value;
        <span class="hljs-keyword">yield</span>* leftOrder(tree.left);
        <span class="hljs-keyword">yield</span>* leftOrder(tree.right);
    }
}

<span class="hljs-comment">//['D', 'B', 'E','A', 'F', 'C','G']</span>
<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">inOrder</span>(<span class="hljs-params">tree</span>) </span>{
    <span class="hljs-keyword">if</span> (tree) {
        <span class="hljs-keyword">yield</span>* inOrder(tree.left);
        <span class="hljs-keyword">yield</span> tree.value;
        <span class="hljs-keyword">yield</span>* inOrder(tree.right);
    }
}
<span class="hljs-comment">//['D', 'E', 'B','F', 'G', 'C','A']</span>
<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">rightOrder</span>(<span class="hljs-params">tree</span>) </span>{
    <span class="hljs-keyword">if</span> (tree) {
        <span class="hljs-keyword">yield</span>* rightOrder(tree.left);
        <span class="hljs-keyword">yield</span>* rightOrder(tree.right);
        <span class="hljs-keyword">yield</span> tree.value;
    }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">make</span>(<span class="hljs-params">array</span>) </span>{
    <span class="hljs-keyword">if</span> (array.length === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Tree(<span class="hljs-literal">null</span>, array[<span class="hljs-number">0</span>], <span class="hljs-literal">null</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Tree(make(array[<span class="hljs-number">0</span>]), array[<span class="hljs-number">1</span>], make(array[<span class="hljs-number">2</span>]));
}
<span class="hljs-keyword">let</span> tree = make([[[<span class="hljs-string">'D'</span>], <span class="hljs-string">'B'</span>, [<span class="hljs-string">'E'</span>]], <span class="hljs-string">'A'</span>, [[<span class="hljs-string">'F'</span>], <span class="hljs-string">'C'</span>, [<span class="hljs-string">'G'</span>]]]);
<span class="hljs-keyword">var</span> result: any[] = [];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> node <span class="hljs-keyword">of</span> rightOrder(tree)) {
    result.push(node);
}
<span class="hljs-built_in">console</span>.log(result);
</code></pre>
<blockquote>
<p> "downlevelIteration": true, /<em> Provide full support for iterables in 'for-of', spread, and destructuring when targeting 'ES5' or 'ES3'. </em>/</p>
</blockquote>

    