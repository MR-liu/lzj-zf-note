
        <h2 id="t01. 动机">1. 动机 <a href="#t01. 动机"> # </a></h2>
<ul>
<li><a href="https://webpack.js.org/concepts/module-federation/">Module Federation</a>的动机是与多个团队一起开发一个或多个应用程序</li>
<li>应用程序分为较小的应用程序部分,这些可能是前端组件，例如Header或Sidebar组件,也可能是逻辑组件，例如<code>Data Fetching Logic</code>或其他业务逻辑</li>
<li>每个部分都可以由独立的团队开发</li>
<li>应用程序或其一部分共享其他部分或库</li>
</ul>
<p><img src="https://img.zhufengpeixun.com/1608851460103" alt="1608851460103"></p>
<h2 id="t12. 模块联邦">2. 模块联邦 <a href="#t12. 模块联邦"> # </a></h2>
<ul>
<li>使用模块联邦，每个部分将是一个单独的构建， 这些构建被编译为<code>容器</code></li>
<li>容器可以被应用程序或其他容器引用</li>
<li>在这种关系中，容器是<code>远程</code>的，容器的使用者是<code>主机</code></li>
<li><code>远程</code>可以将模块公开给<code>主机</code></li>
<li><code>主机</code>可以使用此类模块,它们被称为<code>远程模块</code></li>
<li>通过使用单独的构建，我们可以获得整个系统的良好构建性能</li>
</ul>
<p><img src="https://img.zhufengpeixun.com/1608851582909" alt="1608851582909"></p>
<h2 id="t23. 模块联邦概述">3. 模块联邦概述 <a href="#t23. 模块联邦概述"> # </a></h2>
<ul>
<li>这是模块联邦的概述</li>
<li>这里显示了模块联邦的两个方面：<code>公开</code>的模块和<code>共享</code>的模块</li>
<li>容器以<code>异步</code>方式公开模块</li>
<li>您需要先让容器`加载要使用的模块，然后再从容器中使用它们</li>
<li>允许构建将每个公开的模块及其依赖项放在单独的文件中</li>
<li>这样，只需要加载使用过的模块，但是容器仍然可以将模块捆绑在一起</li>
<li>另外，这里使用webpack的代码分割技术(例如，在公开的模块中分割第三方模块或公共依赖模块的代码块)</li>
<li>这使我们可以保持较低的请求和总下载量，从而获得良好的Web性能</li>
<li>容器的使用者需要能够处理暴露模块的异步加载</li>
<li>共享模块的另一个方面也显示在这里。每一个部分，容器和应用程序都可以将共享模块与版本信息一起放入共享范围</li>
<li>他们还能够使用共享范围中的共享模块以及版本要求检查</li>
<li>共享范围将对共享模块进行重复数据删除，该方式可为各方提供版本要求内的共享模块的最高可用版本</li>
<li>还以异步方式提供和使用共享模块。因此，提供共享模块没有下载成本。仅下载使用/消耗的共享模块</li>
</ul>
<p><img src="https://img.zhufengpeixun.com/1608851802459" alt="1608851802459"></p>
<h2 id="t34. 案例">4. 案例 <a href="#t34. 案例"> # </a></h2>
<h3 id="t44.1 总览">4.1 总览 <a href="#t44.1 总览"> # </a></h3>
<ul>
<li>这里显示了一个构建应用程序。</li>
<li><code>HomePage</code>（来自团队A）使用<code>Dropdown</code>组件()来自团队B)</li>
<li><code>HomePage</code>上的<code>Login</code>链接按需加载<code>LoginModal</code>(来自团队A),<code>LoginModal</code>使用<code>Button</code>组件(来自团队B)</li>
<li>两个团队的几乎所有模块都使用<code>react</code></li>
<li>让我们将<code>Module Federation</code>应用于此应用程序...</li>
</ul>
<p><img src="https://img.zhufengpeixun.com/1608852930390" alt="1608852930390"></p>
<h3 id="t54.2 项目加载">4.2 项目加载 <a href="#t54.2 项目加载"> # </a></h3>
<ul>
<li>现在，webpack开始...</li>
<li>webpack将自动为容器生成一个<code>容器入口</code>，生成的模块将包含对所有公开和共享模块以及如何加载它们的引用</li>
<li>每个公开的模块与依赖项一起放入单独的文件中</li>
<li>每个共享模块也放入单独的文件中</li>
<li>从容器加载<code>Button</code>时，它将仅加载按钮块和<code>react</code>,加载<code>Dropdown</code>时，它将仅加载<code>Dropdown</code>和<code>react</code></li>
<li>当加载<code>Dropdown</code>时，但是另一方提供了另一个react版本(可能更高),它将加载<code>Dropdown</code>和另一方提供的react版本的块(实际上，它将加载操作委托给另一方)</li>
</ul>
<h3 id="t64.3 teamB">4.3 teamB <a href="#t64.3 teamB"> # </a></h3>
<ul>
<li>从B团队的角度来看,B团队只关心其组件</li>
<li>团队B想建立一个<code>容器</code>，因此标记其某些模块。 <code>Button</code>和<code>Dropdown</code>被标记为<code>已公开</code>，因为它们应由其他团队使用</li>
<li><code>react</code>被标记为<code>共享</code>,以便可以与其他团队共享</li>
</ul>
<p><img src="https://img.zhufengpeixun.com/1608853245251" alt="1608853245251"></p>
<p><img src="https://img.zhufengpeixun.com/1608853337262" alt="1608853337262"></p>
<h3 id="t74.4 teamA">4.4 teamA <a href="#t74.4 teamA"> # </a></h3>
<ul>
<li>这是团队A消耗团队B的容器的方式</li>
<li>它们在运行时引用容器，并且将从容器中加载模块（在运行时)</li>
<li>一个示例是<code>Login</code>链接，该链接打开<code>LoginModal</code>.单击链接时，将并行下载<code>LoginModal</code>的代码和<code>Button</code>的代码</li>
<li>共享模块也会发生类似的情况</li>
</ul>
<p><img src="https://img.zhufengpeixun.com/1608853872626" alt="6.teamaconsume.png"></p>
<h2 id="t85. 项目配置">5. 项目配置 <a href="#t85. 项目配置"> # </a></h2>
<ul>
<li>有一个<code>ModuleFederationPlugin</code>可以使用模块联邦。使用不同的属性来设置不同的部分</li>
<li>要创建容器，<code>暴露</code>属性是重要的<ul>
<li>在此指定了容器的使用者应可访问的所有模块</li>
<li>可以给他们提供一个公共名称，该名称是使用者必须使用的名称，并将其指向他们自己的代码库中的一个模块（内部请求）。支持任何模块，可能是javascript，typescript，CSS等可以在您的代码库中处理的任何模块</li>
</ul>
</li>
<li>他们使用其他容器，<code>remotes</code>属性是goto属性。 它是一个对象，其中的所有容器都应在当前版本中可用。关键是模块作用域，在该作用域中，应在自己的代码库中访问容器公开的模块。任何以此键开头的请求都将创建一个远程模块，该模块将在运行时加载。该值是容器的位置。默认情况下，脚本外部变量用作容器位置。这里将指定脚本文件的URL和全局文件。该脚本将在运行时加载，并且可以从全局访问容器。</li>
<li>要在任何一侧共享模块，应使用共享属性。对于简单的情况，可以提供模块说明符列表，这些说明符将这些模块（在代码库中使用时）标记为共享模块。它们将以当前安装的版本提供，并以使用包的package.json中指定的版本范围使用。</li>
<li>所有属性还支持高级配置选项。一个值得注意的高级选项是共享模块的<code>singleton：true</code>选项。确保在运行时仅创建模块的单个实例。对于某些库，例如。不喜欢在同一应用程序中多次实例化的react。在这种情况下，无效的版本范围只会在运行时导致警告。</li>
<li>更高级的选项允许覆盖或禁用自动推断的值，例如版本，<code>requiredVersion</code>或文件名，并允许使用库和外部的不同方式。例如用于在Node.js中使用或选择加入更严格的版本检查（当版本范围无效时，这会导致错误而不是警告）</li>
</ul>
<p><img src="https://img.zhufengpeixun.com/1608854220849" alt="7.howtouse.png"></p>
<h2 id="t91.初始化项目">1.初始化项目 <a href="#t91.初始化项目"> # </a></h2>
<h3 id="t101.创建项目">1.创建项目 <a href="#t101.创建项目"> # </a></h3>
<pre><code class="lang-js">mkdir teama
cd teama
npm init -y

mkdir teamb
cd teamb
npm init -y
</code></pre>
<h3 id="t112.安装依赖">2.安装依赖 <a href="#t112.安装依赖"> # </a></h3>
<pre><code class="lang-js">cd teama
cd teamb
npm install webpack webpack-cli webpack-dev-server html-webpack-plugin --save-dev
npm install is-array --save
</code></pre>
<h2 id="t122. 配置项目">2. 配置项目 <a href="#t122. 配置项目"> # </a></h2>
<p>配置参数</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">name</td>
<td style="text-align:left">string</td>
<td style="text-align:left">项目名称，应用的身份证，在应用分享资源的时候使用的标识,被远程引用时路径为<code>${name}/${expose}</code></td>
</tr>
<tr>
<td style="text-align:left">library</td>
<td style="text-align:left">object</td>
<td style="text-align:left">暴露项目的全局变量名 格式为 {type:'var',name:projectName}</td>
</tr>
<tr>
<td style="text-align:left">filename</td>
<td style="text-align:left">string</td>
<td style="text-align:left">构建后的文件名，也是远程引入的文件名</td>
</tr>
<tr>
<td style="text-align:left">remotes</td>
<td style="text-align:left">object</td>
<td style="text-align:left">远程引用的应用名及其别名的映射，格式为 {远程项目别名:远程引入的项目名(其它应用name字段)}</td>
</tr>
<tr>
<td style="text-align:left">exposes</td>
<td style="text-align:left">object</td>
<td style="text-align:left">被远程引用时可暴露的资源路径及其别名,格式为{别名:组件的路径}</td>
</tr>
<tr>
<td style="text-align:left">shared</td>
<td style="text-align:left">object</td>
<td style="text-align:left">与其他应用之间可以共享的第三方依赖,可以在此控制版本号</td>
</tr>
<tr>
<td style="text-align:left">title</td>
<td style="text-align:left">string</td>
<td style="text-align:left">head的标题</td>
</tr>
<tr>
<td style="text-align:left">files</td>
<td style="text-align:left">object</td>
<td style="text-align:left">远程调用项目的文件链接</td>
</tr>
</tbody>
</table>
<h3 id="t132.1 teamb">2.1 teamb <a href="#t132.1 teamb"> # </a></h3>
<h4 id="t142.1.1 Button.js">2.1.1 Button.js <a href="#t142.1.1 Button.js"> # </a></h4>
<p>teamb\src\Button.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> isArray <span class="hljs-keyword">from</span> <span class="hljs-string">'is-array'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-string">`(Button[<span class="hljs-subst">${isArray.name}</span>])`</span>;
</code></pre>
<h4 id="t152.1.2 Dropdown.js">2.1.2 Dropdown.js <a href="#t152.1.2 Dropdown.js"> # </a></h4>
<p>teamb\src\Dropdown.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> isArray <span class="hljs-keyword">from</span> <span class="hljs-string">'is-array'</span>;
<span class="hljs-keyword">import</span> ArrowIcon <span class="hljs-keyword">from</span> <span class="hljs-string">'./ArrowIcon'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-string">`(Dropdown[<span class="hljs-subst">${ArrowIcon}</span>][<span class="hljs-subst">${isArray.name}</span>])`</span>;
</code></pre>
<h4 id="t162.1.3 ArrowIcon.js">2.1.3 ArrowIcon.js <a href="#t162.1.3 ArrowIcon.js"> # </a></h4>
<p>teamb\src\ArrowIcon.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span>  <span class="hljs-string">'ArrowIcon'</span>;
</code></pre>
<h4 id="t172.1.4 bootstrap.js">2.1.4 bootstrap.js <a href="#t172.1.4 bootstrap.js"> # </a></h4>
<p>teamb\src\bootstrap.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> isArray <span class="hljs-keyword">from</span> <span class="hljs-string">'is-array'</span>;
<span class="hljs-keyword">let</span> Dropdown = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./Dropdown'</span>);
<span class="hljs-keyword">let</span> Button = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./Button'</span>);
<span class="hljs-built_in">console</span>.log(Dropdown.default); 
<span class="hljs-built_in">console</span>.log(Button.default); 
<span class="hljs-built_in">console</span>.log(isArray.name); 
</code></pre>
<h4 id="t182.1.5 index.js">2.1.5 index.js <a href="#t182.1.5 index.js"> # </a></h4>
<p>teamb\src\index.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span>(<span class="hljs-string">"./bootstrap"</span>);
</code></pre>
<h4 id="t192.1.4 teamb\webpack.config.js">2.1.4 teamb\webpack.config.js <a href="#t192.1.4 teamb\webpack.config.js"> # </a></h4>
<ul>
<li><a href="https://github.com/tc39/proposal-top-level-await">proposal-top-level-await</a>
teamb\webpack.config.js<pre><code class="lang-js"><span class="hljs-keyword">let</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"html-webpack-plugin"</span>);
<span class="hljs-keyword">const</span> ModuleFederationPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"webpack/lib/container/ModuleFederationPlugin"</span>);
<span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">mode</span>: <span class="hljs-string">"development"</span>,
  <span class="hljs-attr">devtool</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">devServer</span>: {
      <span class="hljs-attr">port</span>: <span class="hljs-number">8000</span>
  },
  <span class="hljs-attr">plugins</span>: [
      <span class="hljs-keyword">new</span> HtmlWebpackPlugin({
          <span class="hljs-attr">template</span>: <span class="hljs-string">'./public/index.html'</span>
      }),
      <span class="hljs-keyword">new</span> ModuleFederationPlugin({
          <span class="hljs-attr">name</span>: <span class="hljs-string">"teamb"</span>,
          <span class="hljs-attr">filename</span>: <span class="hljs-string">"remoteEntry.js"</span>,
          <span class="hljs-attr">library</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'var'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'teambVar'</span> },
          <span class="hljs-attr">exposes</span>: {
              <span class="hljs-string">"./Dropdown"</span>: <span class="hljs-string">"./src/Dropdown.js"</span>,
              <span class="hljs-string">"./Button"</span>: <span class="hljs-string">"./src/Button.js"</span>,
          },
          <span class="hljs-attr">shared</span>: [<span class="hljs-string">"is-array"</span>]
      })
  ],
  <span class="hljs-attr">target</span>: [<span class="hljs-string">'es6'</span>, <span class="hljs-string">'web'</span>],
  <span class="hljs-attr">experiments</span>: {
      <span class="hljs-attr">topLevelAwait</span>: <span class="hljs-literal">true</span>
  },
}
</code></pre>
</li>
</ul>
<h4 id="t202.1.5 teamb\public\index.html">2.1.5 teamb\public\index.html <a href="#t202.1.5 teamb\public\index.html"> # </a></h4>
<p>teamb\public\index.html</p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>teamb<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"root"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 id="t212.1.6 package.json">2.1.6 package.json <a href="#t212.1.6 package.json"> # </a></h4>
<pre><code class="lang-json">{
  <span class="hljs-attr">"scripts"</span>: {
    <span class="hljs-attr">"build"</span>: <span class="hljs-string">"webpack"</span>,
    <span class="hljs-attr">"start"</span>: <span class="hljs-string">"webpack serve"</span>
  },
}
</code></pre>
<h4 id="t222.1.7 启动">2.1.7 启动 <a href="#t222.1.7 启动"> # </a></h4>
<pre><code class="lang-js">npm run build
npm run start
</code></pre>
<h3 id="t232.2 teama">2.2 teama <a href="#t232.2 teama"> # </a></h3>
<h4 id="t242.2.1 LoginModal.js">2.2.1 LoginModal.js <a href="#t242.2.1 LoginModal.js"> # </a></h4>
<p>teama\src\LoginModal.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> isArray <span class="hljs-keyword">from</span> <span class="hljs-string">'is-array'</span>;
<span class="hljs-keyword">let</span> Button = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'teamb/Button'</span>);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span>  <span class="hljs-string">`(LoginModal[<span class="hljs-subst">${Button.<span class="hljs-keyword">default</span>}</span>][<span class="hljs-subst">${isArray.name}</span>])`</span>;
</code></pre>
<h4 id="t252.2.2 HomePage.js">2.2.2 HomePage.js <a href="#t252.2.2 HomePage.js"> # </a></h4>
<p>teama\src\HomePage.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> isArray <span class="hljs-keyword">from</span> <span class="hljs-string">'is-array'</span>;
<span class="hljs-keyword">let</span> Dropdown = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'teamb/Dropdown'</span>);
<span class="hljs-keyword">let</span> LoginModal = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./LoginModal'</span>);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-string">`(HomePage[<span class="hljs-subst">${Dropdown.<span class="hljs-keyword">default</span>}</span>][<span class="hljs-subst">${LoginModal.<span class="hljs-keyword">default</span>}</span>][<span class="hljs-subst">${isArray.name}</span>])`</span>
</code></pre>
<h4 id="t262.2.3 bootstrap.js">2.2.3 bootstrap.js <a href="#t262.2.3 bootstrap.js"> # </a></h4>
<p>teama\src\bootstrap.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> HomePage <span class="hljs-keyword">from</span> <span class="hljs-string">'./HomePage'</span>;
<span class="hljs-built_in">console</span>.log(HomePage);
</code></pre>
<h4 id="t272.2.4 index.js">2.2.4 index.js <a href="#t272.2.4 index.js"> # </a></h4>
<p>teama\src\index.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span>(<span class="hljs-string">"./bootstrap"</span>);
</code></pre>
<h4 id="t282.2.5 webpack.config.js">2.2.5 webpack.config.js <a href="#t282.2.5 webpack.config.js"> # </a></h4>
<p>teama\webpack.config.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">let</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"html-webpack-plugin"</span>);
<span class="hljs-keyword">const</span> ModuleFederationPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"webpack/lib/container/ModuleFederationPlugin"</span>);
<span class="hljs-built_in">module</span>.exports = {
    <span class="hljs-attr">mode</span>: <span class="hljs-string">"development"</span>,
    <span class="hljs-attr">devtool</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">publicPath</span>: <span class="hljs-string">"http://localhost:3000/"</span>
    },
    <span class="hljs-attr">target</span>: [<span class="hljs-string">'es6'</span>, <span class="hljs-string">'web'</span>],
    <span class="hljs-attr">experiments</span>: {
        <span class="hljs-attr">topLevelAwait</span>: <span class="hljs-literal">true</span>
    },
    <span class="hljs-attr">devServer</span>: {
        <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>
    },
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-keyword">new</span> HtmlWebpackPlugin({
            <span class="hljs-attr">template</span>: <span class="hljs-string">'./public/index.html'</span>
        }),
        <span class="hljs-keyword">new</span> ModuleFederationPlugin({
            <span class="hljs-attr">filename</span>: <span class="hljs-string">"remoteEntry.js"</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-string">"teama"</span>,
            <span class="hljs-attr">library</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'var'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'teamaVar'</span> },
            <span class="hljs-attr">remotes</span>: {
                <span class="hljs-attr">teamb</span>: <span class="hljs-string">"teambVar@http://localhost:8000/remoteEntry.js"</span>
            },
            <span class="hljs-attr">shared</span>: [<span class="hljs-string">"is-array"</span>]
        })
    ]
}
</code></pre>
<h2 id="t293. 运行原理">3. 运行原理 <a href="#t293. 运行原理"> # </a></h2>
<ul>
<li>下载并执行 remoteEntry.js，挂载入口点对象到<code>window.teamb</code>，他有两个函数属性，<code>init</code> 和 <code>get</code></li>
<li><code>init</code>方法用于初始化作用域对象，<code>get</code> 方法用于下载 <code>moduleMap</code> 中导出的远程模块。</li>
<li>加载 <code>teamb</code> 到本地模块</li>
<li>创建 <code>teamb.init</code> 的执行环境，收集依赖到共享作用域对象 <code>shareScope</code></li>
<li>执行 <code>teamb.init</code>，初始化作用域对象</li>
<li>用户 <code>import</code> 远程模块时调用 <code>teamb.get(moduleName)</code> 通过 <code>JSONP</code> 懒加载远程模块，然后缓存在全局对象 <code>window[‘webpackChunk’ + appName]</code></li>
<li>通过<code>webpack_require</code>方法读取缓存中的模块，执行用户回调</li>
</ul>
<p><img src="https://upload-markdown-images.oss-cn-beijing.aliyuncs.com/mo_kuai_lian_bang_1626947283369.jpg" alt="mo_kuai_lian_bang_1626947283369"></p>
<h3 id="t303.1 teamb">3.1 teamb <a href="#t303.1 teamb"> # </a></h3>
<h4 id="t313.1.1 remoteEntry.js">3.1.1 remoteEntry.js <a href="#t313.1.1 remoteEntry.js"> # </a></h4>
<pre><code class="lang-js"><span class="hljs-built_in">window</span>.teamb = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> {
    <span class="hljs-keyword">var</span> modules = ({
        <span class="hljs-string">"webpack/container/entry/teamb"</span>:
            <span class="hljs-function">(<span class="hljs-params">(<span class="hljs-built_in">module</span>, exports, <span class="hljs-built_in">require</span></span>) =&gt;</span> {
                <span class="hljs-keyword">var</span> moduleMap = {
                    <span class="hljs-string">"./Dropdown"</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all([<span class="hljs-built_in">require</span>.e(<span class="hljs-string">"webpack_sharing_consume_default_is-array_is-array"</span>), <span class="hljs-built_in">require</span>.e(<span class="hljs-string">"src_Dropdown_js"</span>)]).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">"./src/Dropdown.js"</span>));
                    },
                    <span class="hljs-string">"./Button"</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all([<span class="hljs-built_in">require</span>.e(<span class="hljs-string">"webpack_sharing_consume_default_is-array_is-array"</span>), <span class="hljs-built_in">require</span>.e(<span class="hljs-string">"src_Button_js"</span>)]).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">"./src/Button.js"</span>));
                    }
                };
                <span class="hljs-keyword">var</span> <span class="hljs-keyword">get</span> = (module) =&gt; {
                    <span class="hljs-keyword">return</span> moduleMap[<span class="hljs-built_in">module</span>]();
                };
                <span class="hljs-comment">//初始化作用域</span>
                <span class="hljs-keyword">var</span> init = <span class="hljs-function">(<span class="hljs-params">shareScope</span>) =&gt;</span> {
                    <span class="hljs-keyword">var</span> name = <span class="hljs-string">"default"</span>;
                    <span class="hljs-built_in">require</span>.S[name] = shareScope;
                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>.I(name);
                };
                <span class="hljs-built_in">require</span>.d(exports, {
                    <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">get</span>,
                    init: () =&gt; init
                });
            })
    });
    var cache = {};
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">require</span>(<span class="hljs-params">moduleId</span>) </span>{
        <span class="hljs-keyword">if</span> (cache[moduleId]) {
            <span class="hljs-keyword">return</span> cache[moduleId].exports;
        }
        <span class="hljs-keyword">var</span> <span class="hljs-built_in">module</span> = cache[moduleId] = {
            <span class="hljs-attr">exports</span>: {}
        };
        modules[moduleId](<span class="hljs-built_in">module</span>, <span class="hljs-built_in">module</span>.exports, <span class="hljs-built_in">require</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">module</span>.exports;
    }
    <span class="hljs-built_in">require</span>.n = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-built_in">module</span></span>) =&gt;</span> {
        <span class="hljs-keyword">var</span> getter = <span class="hljs-built_in">module</span> &amp;&amp; <span class="hljs-built_in">module</span>.__esModule ?
            <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">module</span>[<span class="hljs-string">'default'</span>] :
            <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">module</span>;
        <span class="hljs-keyword">return</span> getter;
    };
    <span class="hljs-built_in">require</span>.d = <span class="hljs-function">(<span class="hljs-params">exports, definition</span>) =&gt;</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> definition) {
            <span class="hljs-built_in">Object</span>.defineProperty(exports, key, { <span class="hljs-attr">get</span>: definition[key] });
        }
    };
    <span class="hljs-built_in">require</span>.f = {};
    <span class="hljs-built_in">require</span>.e = <span class="hljs-function">(<span class="hljs-params">chunkId</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all(<span class="hljs-built_in">Object</span>.keys(<span class="hljs-built_in">require</span>.f).reduce(<span class="hljs-function">(<span class="hljs-params">promises, key</span>) =&gt;</span> {
            <span class="hljs-built_in">require</span>.f[key](chunkId, promises);
            <span class="hljs-keyword">return</span> promises;
        }, []));
    };
    <span class="hljs-built_in">require</span>.u = <span class="hljs-function">(<span class="hljs-params">chunkId</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span> + chunkId + <span class="hljs-string">".js"</span>;
    };
    <span class="hljs-built_in">require</span>.o = <span class="hljs-function">(<span class="hljs-params">obj, prop</span>) =&gt;</span> <span class="hljs-built_in">Object</span>.prototype.hasOwnProperty.call(obj, prop)
    <span class="hljs-built_in">require</span>.l = <span class="hljs-function">(<span class="hljs-params">url, done</span>) =&gt;</span> {
        <span class="hljs-keyword">var</span> script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>);
        script.src = url;
        script.onload = done
        <span class="hljs-built_in">document</span>.head.appendChild(script);
    };
    <span class="hljs-built_in">require</span>.r = <span class="hljs-function">(<span class="hljs-params">exports</span>) =&gt;</span> {
        <span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-built_in">Symbol</span>.toStringTag, { <span class="hljs-attr">value</span>: <span class="hljs-string">'Module'</span> });
        <span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">'__esModule'</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
    };
    <span class="hljs-built_in">require</span>.S = {};
    <span class="hljs-built_in">require</span>.I = <span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.S[name])
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve();
    };
    <span class="hljs-built_in">require</span>.p = <span class="hljs-string">"http://localhost:8000/"</span>;
    <span class="hljs-comment">//初始化作用域</span>
    <span class="hljs-keyword">var</span> init = <span class="hljs-function">(<span class="hljs-params">fn</span>) =&gt;</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">scopeName, key, version</span>) </span>{
        <span class="hljs-comment">//先保证作用域存在</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>.I(scopeName).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            <span class="hljs-comment">//返回作用域指定版本对应的模块</span>
            <span class="hljs-keyword">return</span> fn(<span class="hljs-built_in">require</span>.S[scopeName], key, version);
        });
    };
    <span class="hljs-comment">//加载共享作用域</span>
    <span class="hljs-keyword">var</span> loadShareScope = init(<span class="hljs-function">(<span class="hljs-params">scope, key, version</span>) =&gt;</span> {
        <span class="hljs-comment">//获取版本</span>
        <span class="hljs-keyword">var</span> versions = scope[key];
        <span class="hljs-comment">//获取指定版本</span>
        <span class="hljs-keyword">var</span> entry = versions[version];
        <span class="hljs-keyword">return</span> entry.get()
    });
    <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> {
        <span class="hljs-keyword">var</span> moduleToHandlerMapping = {
            <span class="hljs-string">"webpack/sharing/consume/default/is-array/is-array"</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> loadShareScope(<span class="hljs-string">"default"</span>, <span class="hljs-string">"is-array"</span>, <span class="hljs-string">'1.0.1'</span>)
        };
        <span class="hljs-keyword">var</span> chunkMapping = {
            <span class="hljs-string">"webpack_sharing_consume_default_is-array_is-array"</span>: [
                <span class="hljs-string">"webpack/sharing/consume/default/is-array/is-array"</span>
            ]
        };
        <span class="hljs-built_in">require</span>.f.consumes = <span class="hljs-function">(<span class="hljs-params">chunkId, promises</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.o(chunkMapping, chunkId)) {
                chunkMapping[chunkId].forEach(<span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> {
                    <span class="hljs-keyword">let</span> promise = moduleToHandlerMapping[id]().then(<span class="hljs-function">(<span class="hljs-params">factory</span>) =&gt;</span> {
                        modules[id] = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-built_in">module</span></span>) =&gt;</span> {
                            <span class="hljs-built_in">module</span>.exports = factory();
                        }
                    })
                    promises.push(promise);
                });
            }
        }
    })();
    <span class="hljs-keyword">var</span> installedChunks = {
        <span class="hljs-string">"teamb"</span>: <span class="hljs-number">0</span>
    };
    <span class="hljs-built_in">require</span>.f.j = <span class="hljs-function">(<span class="hljs-params">chunkId, promises</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"webpack_sharing_consume_default_is-array_is-array"</span> != chunkId) {
            <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
                installedChunks[chunkId] = [resolve, reject];
            });
            promises.push(promise);
            <span class="hljs-keyword">var</span> url = <span class="hljs-built_in">require</span>.p + <span class="hljs-built_in">require</span>.u(chunkId);
            <span class="hljs-built_in">require</span>.l(url);
        }
    };
    <span class="hljs-keyword">var</span> webpackJsonpCallback = <span class="hljs-function">(<span class="hljs-params">parentChunkLoadingFunction, data</span>) =&gt;</span> {
        <span class="hljs-keyword">var</span> [chunkIds, moreModules, runtime] = data;
        <span class="hljs-keyword">var</span> moduleId, chunkId, i = <span class="hljs-number">0</span>, resolves = [];
        <span class="hljs-keyword">for</span> (; i &lt; chunkIds.length; i++) {
            chunkId = chunkIds[i];
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.o(installedChunks, chunkId) &amp;&amp; installedChunks[chunkId]) {
                resolves.push(installedChunks[chunkId][<span class="hljs-number">0</span>]);
            }
            installedChunks[chunkId] = <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">for</span> (moduleId <span class="hljs-keyword">in</span> moreModules) {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.o(moreModules, moduleId)) {
                modules[moduleId] = moreModules[moduleId];
            }
        }
        <span class="hljs-keyword">if</span> (runtime) runtime(<span class="hljs-built_in">require</span>);
        <span class="hljs-keyword">if</span> (parentChunkLoadingFunction) parentChunkLoadingFunction(data);
        <span class="hljs-keyword">while</span> (resolves.length) {
            resolves.shift()();
        }
    }
    <span class="hljs-keyword">var</span> chunkLoadingGlobal = self[<span class="hljs-string">"webpackChunkteamb"</span>] = self[<span class="hljs-string">"webpackChunkteamb"</span>] || [];
    chunkLoadingGlobal.forEach(webpackJsonpCallback.bind(<span class="hljs-literal">null</span>, <span class="hljs-number">0</span>));
    chunkLoadingGlobal.push = webpackJsonpCallback.bind(<span class="hljs-literal">null</span>, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">"webpack/container/entry/teamb"</span>);
})();
</code></pre>
<h4 id="t323.1.2 src_Dropdown_js.js">3.1.2 src_Dropdown_js.js <a href="#t323.1.2 src_Dropdown_js.js"> # </a></h4>
<p>teamb\dist\src_Dropdown_js.js</p>
<pre><code class="lang-js">(self[<span class="hljs-string">"webpackChunkteamb"</span>] = self[<span class="hljs-string">"webpackChunkteamb"</span>] || []).push([[<span class="hljs-string">"src_Dropdown_js"</span>], {
    <span class="hljs-string">"./src/ArrowIcon.js"</span>:
        <span class="hljs-function">(<span class="hljs-params">(<span class="hljs-built_in">module</span>, exports, <span class="hljs-built_in">require</span></span>) =&gt;</span> {
            <span class="hljs-string">"use strict"</span>;
            <span class="hljs-built_in">require</span>.r(exports);
            <span class="hljs-built_in">require</span>.d(exports, {
                <span class="hljs-string">"default"</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> DEFAULT_EXPORT
            });
            <span class="hljs-keyword">const</span> DEFAULT_EXPORT = (<span class="hljs-string">'ArrowIcon'</span>);
        }),
    <span class="hljs-string">"./src/Dropdown.js"</span>:
        <span class="hljs-function">(<span class="hljs-params">(<span class="hljs-built_in">module</span>, exports, <span class="hljs-built_in">require</span></span>) =&gt;</span> {
            <span class="hljs-string">"use strict"</span>;
            <span class="hljs-built_in">require</span>.r(exports);
            <span class="hljs-built_in">require</span>.d(exports, {
                <span class="hljs-string">"default"</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> DEFAULT_EXPORT
            });
            <span class="hljs-keyword">var</span> is_array_0__ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"webpack/sharing/consume/default/is-array/is-array"</span>);
            <span class="hljs-keyword">var</span> is_array_0___default = <span class="hljs-built_in">require</span>.n(is_array_0__);
            <span class="hljs-keyword">var</span> _ArrowIcon_1__ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./src/ArrowIcon.js"</span>);
            <span class="hljs-keyword">const</span> DEFAULT_EXPORT = (<span class="hljs-string">`(Dropdown[<span class="hljs-subst">${_ArrowIcon_1__.<span class="hljs-keyword">default</span>}</span>][<span class="hljs-subst">${(is_array_0___default().name)}</span>])`</span>);
        })
}]);
</code></pre>
<h4 id="t333.1.3 src_Button_js.js">3.1.3 src_Button_js.js <a href="#t333.1.3 src_Button_js.js"> # </a></h4>
<p>teamb\dist\src_Button_js.js</p>
<pre><code class="lang-js">(self[<span class="hljs-string">"webpackChunkteamb"</span>] = self[<span class="hljs-string">"webpackChunkteamb"</span>] || []).push([[<span class="hljs-string">"src_Button_js"</span>], {
    <span class="hljs-string">"./src/Button.js"</span>:
        <span class="hljs-function">(<span class="hljs-params">(<span class="hljs-built_in">module</span>, exports, <span class="hljs-built_in">require</span></span>) =&gt;</span> {
            <span class="hljs-built_in">require</span>.r(exports);
            <span class="hljs-built_in">require</span>.d(exports, {
                <span class="hljs-string">"default"</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> DEFAULT_EXPORT
            });
            <span class="hljs-keyword">var</span> is_array_0__ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"webpack/sharing/consume/default/is-array/is-array"</span>);
            <span class="hljs-keyword">var</span> is_array_0___default = <span class="hljs-built_in">require</span>.n(is_array_0__);
            <span class="hljs-keyword">const</span> DEFAULT_EXPORT = (<span class="hljs-string">`(Button[<span class="hljs-subst">${(is_array_0___default().name)}</span>])`</span>);
        })
}]);
<span class="hljs-comment">/**
console.log(require.cache);
./src/ArrowIcon.js: {exports: Module}
./src/Button.js: {exports: Module}
./src/Dropdown.js: {exports: Module}
webpack/container/entry/teamb: {exports: {…}}
webpack/sharing/consume/default/is-array/is-array: {exports: ƒ}
 */</span>
</code></pre>
<h3 id="t343.2 teama">3.2 teama <a href="#t343.2 teama"> # </a></h3>
<h4 id="t353.2.1 main.js">3.2.1 main.js <a href="#t353.2.1 main.js"> # </a></h4>
<p>teama\dist\main.js</p>
<pre><code class="lang-js">(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-comment">//模块定义</span>
    <span class="hljs-keyword">var</span> modules = ({
        <span class="hljs-string">"webpack/container/reference/teamb"</span>: <span class="hljs-function">(<span class="hljs-params">(<span class="hljs-built_in">module</span>, exports, <span class="hljs-built_in">require</span></span>) =&gt;</span> {
            <span class="hljs-comment">//加载远程脚本，返回 window.teamb</span>
            <span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
                <span class="hljs-built_in">require</span>.l(<span class="hljs-string">"http://localhost:8000/remoteEntry.js"</span>, resolve);
            }).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">window</span>.teamb);
        })
    });
    <span class="hljs-keyword">var</span> cache = {};
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">require</span>(<span class="hljs-params">moduleId</span>) </span>{
        <span class="hljs-keyword">if</span> (cache[moduleId]) {
            <span class="hljs-keyword">return</span> cache[moduleId].exports;
        }
        <span class="hljs-keyword">var</span> <span class="hljs-built_in">module</span> = cache[moduleId] = {
            <span class="hljs-attr">exports</span>: {}
        };
        modules[moduleId](<span class="hljs-built_in">module</span>, <span class="hljs-built_in">module</span>.exports, <span class="hljs-built_in">require</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">module</span>.exports;
    }
    <span class="hljs-comment">//如果在ES module,取default，否则取自己</span>
    <span class="hljs-built_in">require</span>.n = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-built_in">module</span></span>) =&gt;</span> {
        <span class="hljs-keyword">var</span> getter = <span class="hljs-built_in">module</span> &amp;&amp; <span class="hljs-built_in">module</span>.__esModule ?
            <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">module</span>[<span class="hljs-string">'default'</span>] :
            <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">module</span>;
        <span class="hljs-keyword">return</span> getter;
    };
    <span class="hljs-built_in">require</span>.d = <span class="hljs-function">(<span class="hljs-params">exports, definition</span>) =&gt;</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> definition) {
            <span class="hljs-built_in">Object</span>.defineProperty(exports, key, { <span class="hljs-attr">get</span>: definition[key] });
        }
    };
    <span class="hljs-built_in">require</span>.u = <span class="hljs-function">(<span class="hljs-params">chunkId</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span> + chunkId + <span class="hljs-string">".js"</span>;
    };
    <span class="hljs-built_in">require</span>.o = <span class="hljs-function">(<span class="hljs-params">obj, prop</span>) =&gt;</span> <span class="hljs-built_in">Object</span>.prototype.hasOwnProperty.call(obj, prop);
    <span class="hljs-built_in">require</span>.l = <span class="hljs-function">(<span class="hljs-params">url, done</span>) =&gt;</span> {
        <span class="hljs-keyword">var</span> script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>);
        script.src = url;
        script.onload = done
        <span class="hljs-built_in">document</span>.head.appendChild(script);
    };
    <span class="hljs-built_in">require</span>.r = <span class="hljs-function">(<span class="hljs-params">exports</span>) =&gt;</span> {
        <span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-built_in">Symbol</span>.toStringTag, { <span class="hljs-attr">value</span>: <span class="hljs-string">'Module'</span> });
        <span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">'__esModule'</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
    };
    <span class="hljs-built_in">require</span>.f = {};
    <span class="hljs-built_in">require</span>.e = <span class="hljs-function">(<span class="hljs-params">chunkId</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all(<span class="hljs-built_in">Object</span>.keys(<span class="hljs-built_in">require</span>.f).reduce(<span class="hljs-function">(<span class="hljs-params">promises, key</span>) =&gt;</span> {
            <span class="hljs-built_in">require</span>.f[key](chunkId, promises);
            <span class="hljs-keyword">return</span> promises;
        }, []));
    };
    <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> {
        <span class="hljs-comment">//远程模块的代码码映射</span>
        <span class="hljs-keyword">var</span> chunkMapping = {
            <span class="hljs-string">"webpack_container_remote_teamb_Dropdown"</span>: [
                <span class="hljs-string">"webpack/container/remote/teamb/Dropdown"</span>
            ],
            <span class="hljs-string">"webpack_container_remote_teamb_Button"</span>: [
                <span class="hljs-string">"webpack/container/remote/teamb/Button"</span>
            ]
        };
        <span class="hljs-keyword">var</span> idToExternalAndNameMapping = {
            <span class="hljs-string">"webpack/container/remote/teamb/Dropdown"</span>: [
                <span class="hljs-string">"default"</span>,<span class="hljs-comment">//命名空间</span>
                <span class="hljs-string">"./Dropdown"</span>,<span class="hljs-comment">//导出的名称</span>
                <span class="hljs-string">"webpack/container/reference/teamb"</span><span class="hljs-comment">//来自哪个外部模块</span>
            ],
            <span class="hljs-string">"webpack/container/remote/teamb/Button"</span>: [
                <span class="hljs-string">"default"</span>,
                <span class="hljs-string">"./Button"</span>,
                <span class="hljs-string">"webpack/container/reference/teamb"</span>
            ]
        };
        <span class="hljs-comment">//加载远程模块</span>
        <span class="hljs-built_in">require</span>.f.remotes = <span class="hljs-function">(<span class="hljs-params">chunkId, promises</span>) =&gt;</span> {
            <span class="hljs-comment">//如果是外部模块，则加载</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.o(chunkMapping, chunkId)) {
                <span class="hljs-comment">//获取外部模块的id</span>
                chunkMapping[chunkId].forEach(<span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> {
                    <span class="hljs-comment">//获取外部模块的名称 scopeName 作用域名称 remoteExposeName远程暴露的名称 远程ID</span>
                    <span class="hljs-keyword">var</span> [scopeName, remoteExposeName, remoteId] = idToExternalAndNameMapping[id];
                    <span class="hljs-comment">//获取外部模块的代码</span>
                    <span class="hljs-keyword">let</span> promise = <span class="hljs-built_in">require</span>(remoteId).then(<span class="hljs-function"><span class="hljs-params">external</span> =&gt;</span> {
                        <span class="hljs-comment">//获取external外部变量，初始化作用域</span>
                        <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>.I(scopeName).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                            <span class="hljs-comment">//获取远程暴露的模块定义</span>
                            <span class="hljs-keyword">return</span> external.get(remoteExposeName).then(<span class="hljs-function"><span class="hljs-params">factory</span> =&gt;</span> {
                                <span class="hljs-comment">//获取远程暴露的模块实例</span>
                                modules[id] = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-built_in">module</span></span>) =&gt;</span> {
                                    <span class="hljs-comment">//执行工厂方法，获取远程模块实例</span>
                                    <span class="hljs-built_in">module</span>.exports = factory();
                                }
                            });
                        });
                    });
                    promises.push(promise);
                });
            }
        }
    })();
    <span class="hljs-comment">//存放scope</span>
    <span class="hljs-built_in">require</span>.S = {};
    <span class="hljs-comment">//初始化scope</span>
    <span class="hljs-built_in">require</span>.I = <span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.S[name])
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve();
        <span class="hljs-keyword">var</span> scope = <span class="hljs-built_in">require</span>.S[name] = {};
        <span class="hljs-comment">//注册共享模块</span>
        <span class="hljs-keyword">var</span> register = <span class="hljs-function">(<span class="hljs-params">name, version, factory</span>) =&gt;</span> {
            <span class="hljs-keyword">var</span> currentScope = scope[name] = scope[name] || {};
            currentScope[version] = { <span class="hljs-attr">get</span>: factory };
        };
        <span class="hljs-keyword">var</span> promises = [];
        <span class="hljs-comment">//初始化远程外部模块</span>
        <span class="hljs-keyword">var</span> initExternal = <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> {
            <span class="hljs-keyword">var</span> <span class="hljs-built_in">module</span> = <span class="hljs-built_in">require</span>(id);
            <span class="hljs-keyword">let</span> promise = <span class="hljs-built_in">module</span>.then(<span class="hljs-function"><span class="hljs-params">module</span> =&gt;</span> <span class="hljs-built_in">module</span>.init(scope));
            promises.push(promise);
        }
        <span class="hljs-comment">//scope的名称</span>
        <span class="hljs-keyword">switch</span> (name) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"default"</span>: {
                register(<span class="hljs-string">"is-array"</span>, <span class="hljs-string">"1.0.1"</span>, () =&gt; <span class="hljs-built_in">require</span>.e(<span class="hljs-string">"node_modules_is-array_index_js"</span>).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">"./node_modules/is-array/index.js"</span>)));
                initExternal(<span class="hljs-string">"webpack/container/reference/teamb"</span>);
            }
                <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all(promises)
    };
    <span class="hljs-built_in">require</span>.p = <span class="hljs-string">"http://localhost:3000/"</span>;
    <span class="hljs-keyword">var</span> init = <span class="hljs-function">(<span class="hljs-params">fn</span>) =&gt;</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">scopeName, key, version</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>.I(scopeName).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            <span class="hljs-keyword">return</span> fn(<span class="hljs-built_in">require</span>.S[scopeName], key, version);
        });
    };
    <span class="hljs-keyword">var</span> loadShareScope = init(<span class="hljs-function">(<span class="hljs-params">scope, key, version</span>) =&gt;</span> {
        <span class="hljs-keyword">var</span> versions = scope[key];
        <span class="hljs-keyword">var</span> entry = versions[version];
        <span class="hljs-keyword">return</span> entry.get()
    });
    <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> {
        <span class="hljs-comment">//share scope consumed modules</span>
        <span class="hljs-keyword">var</span> moduleToHandlerMapping = {
            <span class="hljs-string">"webpack/sharing/consume/default/is-array/is-array"</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> loadShareScope(<span class="hljs-string">"default"</span>, <span class="hljs-string">"is-array"</span>, <span class="hljs-string">'1.0.1'</span>)
        };
        <span class="hljs-keyword">var</span> chunkMapping = {
            <span class="hljs-string">"src_bootstrap_js"</span>: [
                <span class="hljs-string">"webpack/sharing/consume/default/is-array/is-array"</span>
            ]
        };
        <span class="hljs-built_in">require</span>.f.consumes = <span class="hljs-function">(<span class="hljs-params">chunkId, promises</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.o(chunkMapping, chunkId)) {
                chunkMapping[chunkId].forEach(<span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> {
                    <span class="hljs-keyword">let</span> promise = moduleToHandlerMapping[id]().then(<span class="hljs-function">(<span class="hljs-params">factory</span>) =&gt;</span> {
                        modules[id] = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-built_in">module</span></span>) =&gt;</span> {
                            <span class="hljs-built_in">module</span>.exports = factory();
                        }
                    })
                    promises.push(promise);
                });
            }
        }
    })();
    <span class="hljs-keyword">var</span> installedChunks = {
        <span class="hljs-string">"main"</span>: <span class="hljs-number">0</span>
    };
    <span class="hljs-built_in">require</span>.f.j = <span class="hljs-function">(<span class="hljs-params">chunkId, promises</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^webpack_container_remote_teamb_(Button|Dropdown)$/</span>.test(chunkId)) {
            <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
                installedChunks[chunkId] = [resolve, reject];
            });
            promises.push(promise);
            <span class="hljs-keyword">var</span> url = <span class="hljs-built_in">require</span>.p + <span class="hljs-built_in">require</span>.u(chunkId);
            <span class="hljs-built_in">require</span>.l(url);
        }
    };
    <span class="hljs-keyword">var</span> webpackJsonpCallback = <span class="hljs-function">(<span class="hljs-params">parentChunkLoadingFunction, data</span>) =&gt;</span> {
        <span class="hljs-keyword">var</span> [chunkIds, moreModules] = data;
        <span class="hljs-keyword">var</span> moduleId, chunkId, i = <span class="hljs-number">0</span>, resolves = [];
        <span class="hljs-keyword">for</span> (; i &lt; chunkIds.length; i++) {
            chunkId = chunkIds[i];
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.o(installedChunks, chunkId) &amp;&amp; installedChunks[chunkId]) {
                resolves.push(installedChunks[chunkId][<span class="hljs-number">0</span>]);
            }
            installedChunks[chunkId] = <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">for</span> (moduleId <span class="hljs-keyword">in</span> moreModules) {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.o(moreModules, moduleId)) {
                modules[moduleId] = moreModules[moduleId];
            }
        }
        <span class="hljs-keyword">if</span> (parentChunkLoadingFunction) parentChunkLoadingFunction(data);
        <span class="hljs-keyword">while</span> (resolves.length) {
            resolves.shift()();
        }
    }
    <span class="hljs-keyword">var</span> chunkLoadingGlobal = self[<span class="hljs-string">"webpackChunkteama"</span>] = self[<span class="hljs-string">"webpackChunkteama"</span>] || [];
    chunkLoadingGlobal.forEach(webpackJsonpCallback.bind(<span class="hljs-literal">null</span>, <span class="hljs-number">0</span>));
    chunkLoadingGlobal.push = webpackJsonpCallback.bind(<span class="hljs-literal">null</span>, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));
    <span class="hljs-built_in">require</span>.e(<span class="hljs-string">"src_bootstrap_js"</span>).then(<span class="hljs-built_in">require</span>.bind(<span class="hljs-built_in">require</span>, <span class="hljs-string">"./src/bootstrap.js"</span>));
})();
</code></pre>
<h4 id="t363.2.2 src_bootstrap_js.js">3.2.2 src_bootstrap_js.js <a href="#t363.2.2 src_bootstrap_js.js"> # </a></h4>
<p>teama\dist\src_bootstrap_js.js</p>
<pre><code class="lang-js">(self[<span class="hljs-string">"webpackChunkteama"</span>] = self[<span class="hljs-string">"webpackChunkteama"</span>] || []).push([[<span class="hljs-string">"src_bootstrap_js"</span>], {
    <span class="hljs-string">"./src/HomePage.js"</span>:
        <span class="hljs-function">(<span class="hljs-params">(<span class="hljs-built_in">module</span>, exports, <span class="hljs-built_in">require</span></span>) =&gt;</span> {
            <span class="hljs-string">"use strict"</span>;
            <span class="hljs-built_in">module</span>.exports = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
                <span class="hljs-built_in">require</span>.r(exports);
                <span class="hljs-built_in">require</span>.d(exports, {
                    <span class="hljs-string">"default"</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> DEFAULT_EXPORT
                });
                <span class="hljs-keyword">var</span> is_array_0__ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"webpack/sharing/consume/default/is-array/is-array"</span>);
                <span class="hljs-keyword">var</span> is_array_0___default = <span class="hljs-built_in">require</span>.n(is_array_0__);
                <span class="hljs-keyword">let</span> Dropdown = <span class="hljs-keyword">await</span> <span class="hljs-built_in">require</span>.e(<span class="hljs-string">"webpack_container_remote_teamb_Dropdown"</span>).then(<span class="hljs-built_in">require</span>.bind(<span class="hljs-built_in">require</span>, <span class="hljs-string">"webpack/container/remote/teamb/Dropdown"</span>));
                <span class="hljs-keyword">let</span> LoginModal = <span class="hljs-keyword">await</span> <span class="hljs-built_in">require</span>.e(<span class="hljs-string">"src_LoginModal_js"</span>).then(<span class="hljs-built_in">require</span>.bind(<span class="hljs-built_in">require</span>, <span class="hljs-string">"./src/LoginModal.js"</span>));
                <span class="hljs-keyword">const</span> DEFAULT_EXPORT = (<span class="hljs-string">`(HomePage[<span class="hljs-subst">${Dropdown.<span class="hljs-keyword">default</span>}</span>][<span class="hljs-subst">${LoginModal.<span class="hljs-keyword">default</span>}</span>][<span class="hljs-subst">${(is_array_0___default().name)}</span>])`</span>);
                <span class="hljs-keyword">return</span> exports;
            })();
        }),
    <span class="hljs-string">"./src/bootstrap.js"</span>:
        <span class="hljs-function">(<span class="hljs-params">(<span class="hljs-built_in">module</span>, exports, <span class="hljs-built_in">require</span></span>) =&gt;</span> {
            <span class="hljs-string">"use strict"</span>;
            <span class="hljs-built_in">module</span>.exports = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
                <span class="hljs-built_in">require</span>.r(exports);
                <span class="hljs-keyword">var</span> _HomePage_0__ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./src/HomePage.js"</span>);
                _HomePage_0__ = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.resolve(_HomePage_0__);
                <span class="hljs-built_in">console</span>.log(_HomePage_0__.default);
                <span class="hljs-keyword">return</span> exports;
            })();
        })
}]);
</code></pre>
<h4 id="t373.2.3 src_LoginModal_js.js">3.2.3 src_LoginModal_js.js <a href="#t373.2.3 src_LoginModal_js.js"> # </a></h4>
<p>teama\dist\src_LoginModal_js.js</p>
<pre><code class="lang-js">(self[<span class="hljs-string">"webpackChunkteama"</span>] = self[<span class="hljs-string">"webpackChunkteama"</span>] || []).push([[<span class="hljs-string">"src_LoginModal_js"</span>], {
    <span class="hljs-string">"./src/LoginModal.js"</span>:
        <span class="hljs-function">(<span class="hljs-params">(<span class="hljs-built_in">module</span>, exports, <span class="hljs-built_in">require</span></span>) =&gt;</span> {
            <span class="hljs-string">"use strict"</span>;
            <span class="hljs-built_in">module</span>.exports = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
                <span class="hljs-built_in">require</span>.r(exports);
                <span class="hljs-built_in">require</span>.d(exports, {
                    <span class="hljs-string">"default"</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> DEFAULT_EXPORT
                });
                <span class="hljs-keyword">var</span> is_array_0__ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"webpack/sharing/consume/default/is-array/is-array"</span>);
                <span class="hljs-keyword">var</span> is_array_0___default = <span class="hljs-built_in">require</span>.n(is_array_0__);
                <span class="hljs-keyword">let</span> Button = <span class="hljs-keyword">await</span> <span class="hljs-built_in">require</span>.e(<span class="hljs-string">"webpack_container_remote_teamb_Button"</span>).then(<span class="hljs-built_in">require</span>.bind(<span class="hljs-built_in">require</span>, <span class="hljs-string">"webpack/container/remote/teamb/Button"</span>));
                <span class="hljs-keyword">const</span> DEFAULT_EXPORT = (<span class="hljs-string">`(LoginModal[<span class="hljs-subst">${Button.<span class="hljs-keyword">default</span>}</span>][<span class="hljs-subst">${(is_array_0___default().name)}</span>])`</span>);
                <span class="hljs-keyword">return</span> exports;
            })();
        })
}]);
</code></pre>
<h4 id="t383.2.4 node_modules_is-array_index_js.js">3.2.4 node_modules_is-array_index_js.js <a href="#t383.2.4 node_modules_is-array_index_js.js"> # </a></h4>
<p>teama\dist\node_modules_is-array_index_js.js</p>
<pre><code class="lang-js">(self[<span class="hljs-string">"webpackChunkteama"</span>] = self[<span class="hljs-string">"webpackChunkteama"</span>] || []).push([[<span class="hljs-string">"node_modules_is-array_index_js"</span>], {
    <span class="hljs-string">"./node_modules/is-array/index.js"</span>:
        <span class="hljs-function">(<span class="hljs-params">(<span class="hljs-built_in">module</span></span>) =&gt;</span> {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'双方共享的是teama的isArray'</span>);
            <span class="hljs-keyword">var</span> isArray = <span class="hljs-built_in">Array</span>.isArray;
            <span class="hljs-keyword">var</span> str = <span class="hljs-built_in">Object</span>.prototype.toString;
            <span class="hljs-built_in">module</span>.exports = isArray || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{
                <span class="hljs-keyword">return</span> !!val &amp;&amp; <span class="hljs-string">'[object Array]'</span> == str.call(val);
            };
        })
}]);
</code></pre>
<h2 id="t394.EMP">4.EMP <a href="#t394.EMP"> # </a></h2>
<ul>
<li><a href="https://github.com/efoxTeam/emp/blob/main/README-zh_CN.md">emp</a>是一个面向未来的，基于Webpack5 Module Federation搭建的微前端解决方案</li>
</ul>
<h2 id="t40参考">参考 <a href="#t40参考"> # </a></h2>
<ul>
<li><a href="https://github.com/sokra/slides/blob/master/content/ModuleFederationWebpack5.md">ModuleFederationWebpack5</a></li>
</ul>

    